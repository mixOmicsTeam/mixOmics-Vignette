<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="mixOmics vignette" />
<meta property="og:type" content="book" />

<meta property="og:description" content="Vignette for the R package mixOmics" />
<meta name="github-repo" content="mixOmicsTeam/mixOmics" />



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Vignette for the R package mixOmics">

<title>mixOmics vignette</title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="#preamble" id="toc-preamble">Preamble</a></li>
<li class="has-sub"><a href="#id_01" id="toc-id_01"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#id_01:datatypes" id="toc-id_01:datatypes"><span class="toc-section-number">1.1</span> Input data</a></li>
<li class="has-sub"><a href="#methods" id="toc-methods"><span class="toc-section-number">1.2</span> Methods</a>
<ul>
<li><a href="#id_01:methods" id="toc-id_01:methods"><span class="toc-section-number">1.2.1</span> Some background knowledge</a></li>
<li><a href="#id_01:overview" id="toc-id_01:overview"><span class="toc-section-number">1.2.2</span> Overview</a></li>
<li><a href="#id_01:pubs" id="toc-id_01:pubs"><span class="toc-section-number">1.2.3</span> Key publications</a></li>
</ul></li>
<li><a href="#id_01:outline" id="toc-id_01:outline"><span class="toc-section-number">1.3</span> Outline of this Vignette</a></li>
<li><a href="#other-methods-not-covered-in-this-vignette" id="toc-other-methods-not-covered-in-this-vignette"><span class="toc-section-number">1.4</span> Other methods not covered in this vignette</a></li>
</ul></li>
<li class="has-sub"><a href="#id_02" id="toc-id_02"><span class="toc-section-number">2</span> Let’s get started</a>
<ul>
<li><a href="#id_02:install" id="toc-id_02:install"><span class="toc-section-number">2.1</span> Installation</a></li>
<li><a href="#id_02:load-data" id="toc-id_02:load-data"><span class="toc-section-number">2.2</span> Load the package</a></li>
<li><a href="#upload-data" id="toc-upload-data"><span class="toc-section-number">2.3</span> Upload data</a></li>
<li><a href="#id_02:quick-start" id="toc-id_02:quick-start"><span class="toc-section-number">2.4</span> Quick start in <code>mixOmics</code></a></li>
</ul></li>
<li class="has-sub"><a href="#id_03" id="toc-id_03"><span class="toc-section-number">3</span> PCA on the <code>multidrug</code> study</a>
<ul>
<li><a href="#id_03:load-data" id="toc-id_03:load-data"><span class="toc-section-number">3.1</span> Load the data</a></li>
<li class="has-sub"><a href="#id_03:pca" id="toc-id_03:pca"><span class="toc-section-number">3.2</span> Example: PCA</a>
<ul>
<li><a href="#id_03:pca-ncomp" id="toc-id_03:pca-ncomp"><span class="toc-section-number">3.2.1</span> Choose the number of components</a></li>
<li><a href="#id_03:pca-final" id="toc-id_03:pca-final"><span class="toc-section-number">3.2.2</span> PCA with fewer components</a></li>
<li><a href="#id_03:pca-vars" id="toc-id_03:pca-vars"><span class="toc-section-number">3.2.3</span> Identify the informative variables</a></li>
<li><a href="#id_03:pca-sample-plot" id="toc-id_03:pca-sample-plot"><span class="toc-section-number">3.2.4</span> Sample plots</a></li>
<li><a href="#id_03:pca-variable-plot" id="toc-id_03:pca-variable-plot"><span class="toc-section-number">3.2.5</span> Variable plot: correlation circle plot</a></li>
<li><a href="#id_03:pca-biplot" id="toc-id_03:pca-biplot"><span class="toc-section-number">3.2.6</span> Biplot: samples and variables</a></li>
</ul></li>
<li class="has-sub"><a href="#id_03:spca" id="toc-id_03:spca"><span class="toc-section-number">3.3</span> Example: sparse PCA</a>
<ul>
<li><a href="#id_03:spca-vars" id="toc-id_03:spca-vars"><span class="toc-section-number">3.3.1</span> Choose the number of variables to select</a></li>
<li><a href="#id_03:spca-final" id="toc-id_03:spca-final"><span class="toc-section-number">3.3.2</span> Final sparse PCA</a></li>
<li><a href="#id_03:spca-plots" id="toc-id_03:spca-plots"><span class="toc-section-number">3.3.3</span> Sample and variable plots</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="#id_04" id="toc-id_04"><span class="toc-section-number">4</span> PLS on the liver toxicity study</a>
<ul>
<li><a href="#id_04:load-data" id="toc-id_04:load-data"><span class="toc-section-number">4.1</span> Load the data</a></li>
<li class="has-sub"><a href="#id_04:spls1" id="toc-id_04:spls1"><span class="toc-section-number">4.2</span> Example: sPLS1 regression</a>
<ul>
<li><a href="#id_04:spls1-ncomp" id="toc-id_04:spls1-ncomp"><span class="toc-section-number">4.2.1</span> Number of dimensions using the <span class="math inline">\(Q^2\)</span> criterion</a></li>
<li><a href="#id_04:spls1-tuning" id="toc-id_04:spls1-tuning"><span class="toc-section-number">4.2.2</span> Number of variables to select in <span class="math inline">\(\boldsymbol X\)</span></a></li>
<li><a href="#id_04:spls1-final" id="toc-id_04:spls1-final"><span class="toc-section-number">4.2.3</span> Final sPLS1 model</a></li>
<li><a href="#id_04:spls1-sample-plots" id="toc-id_04:spls1-sample-plots"><span class="toc-section-number">4.2.4</span> Sample plots</a></li>
<li><a href="#id_04:spls1-perf" id="toc-id_04:spls1-perf"><span class="toc-section-number">4.2.5</span> Performance assessment of sPLS1</a></li>
</ul></li>
<li class="has-sub"><a href="#id_04:spls2" id="toc-id_04:spls2"><span class="toc-section-number">4.3</span> Example: PLS2 regression</a>
<ul>
<li><a href="#id_04:spls2-ncomp" id="toc-id_04:spls2-ncomp"><span class="toc-section-number">4.3.1</span> Number of dimensions using the <span class="math inline">\(Q^2\)</span> criterion</a></li>
<li><a href="#id_04:spls2-tuning" id="toc-id_04:spls2-tuning"><span class="toc-section-number">4.3.2</span> Number of variables to select in both <span class="math inline">\(\boldsymbol X\)</span> and <span class="math inline">\(\boldsymbol Y\)</span></a></li>
<li><a href="#id_04:spls2-final" id="toc-id_04:spls2-final"><span class="toc-section-number">4.3.3</span> Final sPLS2 model</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="#id_05" id="toc-id_05"><span class="toc-section-number">5</span> PLS-DA on the SRBCT case study</a>
<ul>
<li><a href="#id_05:load-data" id="toc-id_05:load-data"><span class="toc-section-number">5.1</span> Load the data</a></li>
<li class="has-sub"><a href="#id_05:plsda" id="toc-id_05:plsda"><span class="toc-section-number">5.2</span> Example: PLS-DA</a>
<ul>
<li><a href="#id_05:plsda-pca" id="toc-id_05:plsda-pca"><span class="toc-section-number">5.2.1</span> Initial exploration with PCA</a></li>
<li><a href="#id_05:plsda-ncomp" id="toc-id_05:plsda-ncomp"><span class="toc-section-number">5.2.2</span> Number of components in PLS-DA</a></li>
<li><a href="#id_05:plsda-final" id="toc-id_05:plsda-final"><span class="toc-section-number">5.2.3</span> Final PLS-DA model</a></li>
<li><a href="#id_05:plsda-perf" id="toc-id_05:plsda-perf"><span class="toc-section-number">5.2.4</span> Classification performance</a></li>
<li><a href="#id_05:plsda-bgp" id="toc-id_05:plsda-bgp"><span class="toc-section-number">5.2.5</span> Background prediction</a></li>
</ul></li>
<li class="has-sub"><a href="#id_05:splsda" id="toc-id_05:splsda"><span class="toc-section-number">5.3</span> Example: sPLS-DA</a>
<ul>
<li><a href="#id_05:splsda-keepX" id="toc-id_05:splsda-keepX"><span class="toc-section-number">5.3.1</span> Number of variables to select</a></li>
<li><a href="#final-splsda-perf" id="toc-final-splsda-perf"><span class="toc-section-number">5.3.2</span> Final model and performance</a></li>
<li><a href="#id_05:stab" id="toc-id_05:stab"><span class="toc-section-number">5.3.3</span> Variable selection and stability</a></li>
<li><a href="#sample-visualisation" id="toc-sample-visualisation"><span class="toc-section-number">5.3.4</span> Sample visualisation</a></li>
<li><a href="#id_05:varplot" id="toc-id_05:varplot"><span class="toc-section-number">5.3.5</span> Variable visualisation</a></li>
</ul></li>
<li><a href="#id_05:splsda-predict" id="toc-id_05:splsda-predict"><span class="toc-section-number">5.4</span> Take a detour: prediction</a></li>
<li><a href="#id_05:splsda-auroc" id="toc-id_05:splsda-auroc"><span class="toc-section-number">5.5</span> AUROC outputs complement performance evaluation</a></li>
</ul></li>
<li class="has-sub"><a href="#id_06" id="toc-id_06"><span class="toc-section-number">6</span> N-Integration</a>
<ul>
<li><a href="#id_06:diablo" id="toc-id_06:diablo"><span class="toc-section-number">6.1</span> Block sPLS-DA on the TCGA case study</a></li>
<li><a href="#id_06:diablo-load-data" id="toc-id_06:diablo-load-data"><span class="toc-section-number">6.2</span> Load the data</a></li>
<li class="has-sub"><a href="#id_06:diablo-params" id="toc-id_06:diablo-params"><span class="toc-section-number">6.3</span> Parameter choice</a>
<ul>
<li><a href="#id_06:diablo-design" id="toc-id_06:diablo-design"><span class="toc-section-number">6.3.1</span> Design matrix</a></li>
<li><a href="#id_06:diablo-ncomp" id="toc-id_06:diablo-ncomp"><span class="toc-section-number">6.3.2</span> Number of components</a></li>
<li><a href="#id_06:diablo-tuning" id="toc-id_06:diablo-tuning"><span class="toc-section-number">6.3.3</span> Number of variables to select</a></li>
</ul></li>
<li><a href="#id_06:diablo-final" id="toc-id_06:diablo-final"><span class="toc-section-number">6.4</span> Final model</a></li>
<li class="has-sub"><a href="#id_06:diablo-sample-plots" id="toc-id_06:diablo-sample-plots"><span class="toc-section-number">6.5</span> Sample plots</a>
<ul>
<li><a href="#plotdiablo" id="toc-plotdiablo"><span class="toc-section-number">6.5.1</span> <code>plotDiablo</code></a></li>
<li><a href="#plotindiv" id="toc-plotindiv"><span class="toc-section-number">6.5.2</span> <code>plotIndiv</code></a></li>
<li><a href="#plotarrow" id="toc-plotarrow"><span class="toc-section-number">6.5.3</span> <code>plotArrow</code></a></li>
</ul></li>
<li class="has-sub"><a href="#id_06:diablo-variable-plots" id="toc-id_06:diablo-variable-plots"><span class="toc-section-number">6.6</span> Variable plots</a>
<ul>
<li><a href="#plotvar" id="toc-plotvar"><span class="toc-section-number">6.6.1</span> <code>plotVar</code></a></li>
<li><a href="#circosplot" id="toc-circosplot"><span class="toc-section-number">6.6.2</span> <code>circosPlot</code></a></li>
<li><a href="#network" id="toc-network"><span class="toc-section-number">6.6.3</span> <code>network</code></a></li>
<li><a href="#plotloadings" id="toc-plotloadings"><span class="toc-section-number">6.6.4</span> <code>plotLoadings</code></a></li>
<li><a href="#cimdiablo" id="toc-cimdiablo"><span class="toc-section-number">6.6.5</span> <code>cimDiablo</code></a></li>
</ul></li>
<li><a href="#id_06:diablo-perf" id="toc-id_06:diablo-perf"><span class="toc-section-number">6.7</span> Model performance and prediction</a></li>
</ul></li>
<li class="has-sub"><a href="#id_07" id="toc-id_07"><span class="toc-section-number">7</span> P-Integration</a>
<ul>
<li><a href="#id_07:mint" id="toc-id_07:mint"><span class="toc-section-number">7.1</span> MINT on the stem cell case study</a></li>
<li><a href="#id_07:load-data" id="toc-id_07:load-data"><span class="toc-section-number">7.2</span> Load the data</a></li>
<li><a href="#id_07:plsda" id="toc-id_07:plsda"><span class="toc-section-number">7.3</span> Example: MINT PLS-DA</a></li>
<li class="has-sub"><a href="#id_07:splsda" id="toc-id_07:splsda"><span class="toc-section-number">7.4</span> Example: MINT sPLS-DA</a>
<ul>
<li><a href="#id_07:splsda-tuning" id="toc-id_07:splsda-tuning"><span class="toc-section-number">7.4.1</span> Number of variables to select</a></li>
<li><a href="#id_07:splsda-final" id="toc-id_07:splsda-final"><span class="toc-section-number">7.4.2</span> Final MINT sPLS-DA model</a></li>
<li><a href="#id_07:splsda-sample-plots" id="toc-id_07:splsda-sample-plots"><span class="toc-section-number">7.4.3</span> Sample plots</a></li>
<li><a href="#id_07:splsda-variable-plots" id="toc-id_07:splsda-variable-plots"><span class="toc-section-number">7.4.4</span> Variable plots</a></li>
<li><a href="#id_07:splsda-perf" id="toc-id_07:splsda-perf"><span class="toc-section-number">7.4.5</span> Classification performance</a></li>
</ul></li>
<li class="has-sub"><a href="#id_07:splsda-auroc" id="toc-id_07:splsda-auroc"><span class="toc-section-number">7.5</span> Take a detour</a>
<ul>
<li><a href="#auc" id="toc-auc"><span class="toc-section-number">7.5.1</span> AUC</a></li>
<li><a href="#id_07:splsda-predict" id="toc-id_07:splsda-predict"><span class="toc-section-number">7.5.2</span> Prediction on an external study</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="#id_08" id="toc-id_08"><span class="toc-section-number">8</span> Session Information</a>
<ul>
<li><a href="#id_08:mixomics-ver" id="toc-id_08:mixomics-ver"><span class="toc-section-number">8.1</span> mixOmics version</a></li>
<li><a href="#id_08:session-info" id="toc-id_08:session-info"><span class="toc-section-number">8.2</span> Session info</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="header">
<h1 class="title">mixOmics vignette</h1>
<h4 class="author"><em>Kim-Anh Le Cao</em></h4>
<address class="author_afil">
Melbourne Integrative Genomics &amp; School of Mathematics and Statistics, The University of Melbourne, Australia<br><a class="author_email" href="mailto:#"><a href="mailto:kimanh.lecao@unimelb.edu.au" class="email">kimanh.lecao@unimelb.edu.au</a></a>
</address>
</div>
<div id="preamble" class="section level1 unnumbered">
<h1>Preamble</h1>
<p>If you are following our <a href="https://study.unimelb.edu.au/find/short-courses/mixomics-r-essentials-for-biological-data-integration/#course-specifics">online course</a>, the following vignette will be useful as a complementary learning tool. This vignette also covers the essential use cases of various methods in this package for the general <code>mixOmcis</code> user. The below methods will be covered:</p>
<ul>
<li>(s)PCA,</li>
<li>PLS1 and PLS2,</li>
<li>(s)PLS-DA,</li>
<li>N-integration (multi-block sPLS-DA, aka. “DIABLO”), and</li>
<li>P-integration (multi-group sPLS-DA, aka “MINT”).</li>
</ul>
<p>As outlined in <a href="#id_01:outline">1.3</a>, this is not an exhaustive list of all the methods found within <code>mixOmics</code>. More information can be found at <a href="http://mixomics.org/">our website</a> and you can ask questions via our <a href="https://mixomics-users.discourse.group/">discourse forum</a>.</p>
<div class="figure"><span style="display:block;" id="fig:00-analyses-diagram"></span>
<img src="InputFigures/MixOmicsAnalysesV2.png" alt="**Different types of analyses with mixOmics** [@mixomics].The biological questions, the number of data sets to integrate, and the type of response variable, whether qualitative (classification), quantitative (regression), one (PLS1) or several (PLS) responses, all drive the choice of analytical method. All methods featured in this diagram include variable selection except rCCA. In N-integration, rCCA and PLS enable the integration of two quantitative data sets, whilst the block PLS methods (that derive from the methods from @Ten11) can integrate more than two data sets. In P-integration, our method MINT is based on multi-group PLS [@Esl14b].The following activities cover some of these methods."  />
<p class="caption">
Figure 0.1: <strong>Different types of analyses with mixOmics</strong> <span class="citation">(<a href="#ref-mixomics" role="doc-biblioref">Rohart, Gautier, Singh, and Le Cao 2017</a>)</span>.The biological questions, the number of data sets to integrate, and the type of response variable, whether qualitative (classification), quantitative (regression), one (PLS1) or several (PLS) responses, all drive the choice of analytical method. All methods featured in this diagram include variable selection except rCCA. In N-integration, rCCA and PLS enable the integration of two quantitative data sets, whilst the block PLS methods (that derive from the methods from <span class="citation">Tenenhaus and Tenenhaus (<a href="#ref-Ten11" role="doc-biblioref">2011</a>)</span>) can integrate more than two data sets. In P-integration, our method MINT is based on multi-group PLS <span class="citation">(<a href="#ref-Esl14b" role="doc-biblioref">Eslami et al. 2014</a>)</span>.The following activities cover some of these methods.
</p>
</div>

</div>
<div id="id_01" class="section level1" number="1">
<h1><span class="header-section-number"> 1</span> Introduction</h1>
<p><code>mixOmics</code> is an R toolkit dedicated to the exploration and integration of biological data sets with a specific focus on variable selection. The package currently includes more than twenty multivariate methodologies, mostly developed by the <code>mixOmics</code> team (see some of our references in <a href="#id_01:pubs">1.2.3</a>). Originally, all methods were designed for omics data, however, their application is not limited to biological data only. Other applications where integration is required can be considered, but mostly for the case where the predictor variables are continuous (see also <a href="#id_01:datatypes">1.1</a>).</p>
<p>In <code>mixOmics</code>, a strong focus is given to graphical representation to better translate and understand the relationships between the different data types and visualize the correlation structure at both sample and variable levels.</p>
<div id="id_01:datatypes" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Input data</h2>
<p>Note the data pre-processing requirements before analysing data with <code>mixOmics</code>:</p>
<ul>
<li><p><strong>Types of data</strong>. Different types of biological data can be explored and integrated with <code>mixOmics</code>. Our methods can handle molecular features measured on a continuous scale (e.g. microarray, mass spectrometry-based proteomics and metabolomics) or sequenced-based count data (RNA-seq, 16S, shotgun metagenomics) that become `continuous’ data after pre-processing and normalisation.</p></li>
<li><p><strong>Normalisation</strong>. The package does not handle normalisation as it is platform-specific and we cover a too wide variety of data! Prior to the analysis, we assume the data sets have been normalised using appropriate normalisation methods and pre-processed when applicable.</p></li>
<li><p><strong>Prefiltering</strong>. While <code>mixOmics</code> methods can handle large data sets (several tens of thousands of predictors), we recommend pre-filtering the data to less than 10K predictor variables per data set, for example by using Median Absolute Deviation <span class="citation">(<a href="#ref-Ten16" role="doc-biblioref">Teng et al. 2016</a>)</span> for RNA-seq data, by removing consistently low counts in microbiome data sets <span class="citation">(<a href="#ref-Lec16" role="doc-biblioref">Lê Cao et al. 2016</a>)</span> or by removing near-zero variance predictors. Such step aims to lessen the computational time during the parameter tuning process.</p></li>
<li><p><strong>Data format</strong>.
Our methods use matrix decomposition techniques. Therefore, the numeric data matrix or data frames have <span class="math inline">\(n\)</span> observations or samples in rows and <span class="math inline">\(p\)</span> predictors or variables (e.g. genes, proteins, OTUs) in columns.</p></li>
<li><p><strong>Covariates</strong>. In the current version of <code>mixOmics</code>, covariates that may confound the analysis are not included in the methods. We recommend correcting for those covariates beforehand using appropriate univariate or multivariate methods for batch effect removal. Contact us for more details as we are currently working on this aspect.</p></li>
</ul>
</div>
<div id="methods" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Methods</h2>
<div id="id_01:methods" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Some background knowledge</h3>
<p>We list here the main methodological or theoretical concepts you need to know to be able to efficiently apply <code>mixOmics</code>:</p>
<ul>
<li><p><strong>Individuals, observations or samples</strong>: the experimental units on which information are collected, e.g. patients, cell lines, cells, faecal samples etc.</p></li>
<li><p><strong>Variables, predictors</strong>: read-out measured on each sample, e.g. gene (expression), protein or OTU (abundance), weight etc.</p></li>
<li><p><strong>Variance</strong>: measures the spread of one variable. In our methods, we estimate the variance of components rather that variable read-outs. A high variance indicates that the data points are very spread out from the mean, and from one another (scattered).</p></li>
<li><p><strong>Covariance</strong>: measures the strength of the relationship between two variables, i.e. whether they co-vary. A high covariance value indicates a strong relationship, e.g. weight and height in individuals frequently vary roughly in the same way; roughly, the heaviest are the tallest. A covariance value has no lower or upper bound.</p></li>
<li><p><strong>Correlation</strong>: a standardized version of the covariance that is bounded by -1 and 1.</p></li>
<li><p><strong>Linear combination</strong>: variables are combined by multiplying each of them by a coefficient and adding the results. A linear combination of height and weight could be <span class="math inline">\(2 * weight - 1.5 * height\)</span> with the coefficients <span class="math inline">\(2\)</span> and <span class="math inline">\(-1.5\)</span> assigned with weight and height respectively.</p></li>
<li><p><strong>Component</strong>: an artificial variable built from a linear combination of the observed variables in a given data set. Variable coefficients are optimally defined based on some statistical criterion. For example in Principal Component Analysis, the coefficients of a (principal) component are defined so as to maximise the variance of the component.</p></li>
<li><p><strong>Loadings</strong>: variable coefficients used to define a component.</p></li>
<li><p><strong>Sample plot</strong>: representation of the samples projected in a small space spanned (defined) by the components. Samples coordinates are determined by their components values or scores.</p></li>
<li><p><strong>Correlation circle plot</strong>: representation of the variables in a space spanned by the components. Each variable coordinate is defined as the correlation between the original variable value and each component. A correlation circle plot enables to visualise the correlation between variables - negative or positive correlation, defined by the cosine angle between the centre of the circle and each variable point) and the contribution of each variable to each component - defined by the absolute value of the coordinate on each component. For this interpretation, data need to be centred and scaled (by default in most of our methods except PCA). For more details on this insightful graphic, see Figure 1 in <span class="citation">(<a href="#ref-Gon12" role="doc-biblioref">González et al. 2012</a>)</span>.</p></li>
<li><p><strong>Unsupervised analysis</strong>: the method does not take into account any known sample groups and the analysis is exploratory. Examples of unsupervised methods covered in this vignette are Principal Component Analysis (PCA, Chapter <a href="#id_03">3</a>), Projection to Latent Structures (PLS, Chapter <a href="#id_04">4</a>), and also Canonical Correlation Analysis (CCA, not covered here but see <a href="http://mixomics.org/methods/rcca/">the website page</a>).</p></li>
<li><p><strong>Supervised analysis</strong>: the method includes a vector indicating the class membership of each sample. The aim is to discriminate sample groups and perform sample class prediction. Examples of supervised methods covered in this vignette are PLS Discriminant Analysis (PLS-DA, Chapter <a href="#id_05">5</a>), DIABLO (Chapter <a href="#id_06">6</a>) and also MINT (Chapter <a href="#id_07">7</a>).</p></li>
</ul>
<p>If the above descriptions were not comprehensive enough and you have some more questions, feel free to explore the <a href="http://mixomics.org/faq/glossary/">glossary</a> on our website.</p>
</div>
<div id="id_01:overview" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Overview</h3>
<p>Here is an overview of the most widely used methods in <code>mixOmics</code> that will be further detailed in this vignette, with the exception of rCCA. We depict them along with the type of data set they can handle.</p>
<img src="http://mixomics.org/wp-content/uploads/2021/12/Key-Concepts-Selecting_Your_Method.png" alt="newplot" style="max-width: 70%; display: block; margin: auto;"/>
<p style="text-align: center">
FIGURE 1: An overview of what quantity and type of dataset each method within mixOmics requires. Thin columns represent a single variable, while the larger blocks represent datasets of multiple samples and variables.
</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:01-methods-diagram"></span>
<img src="InputFigures/Methods.png" alt="List of methods in mixOmics, sparse indicates methods that perform variable selection" width="100%"  />
<p class="caption">
Figure 1.1: List of methods in mixOmics, sparse indicates methods that perform variable selection
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:01-cheatsheet"></span>
<img src="InputFigures/cheatsheet.png" alt="Main functions and parameters of each method" width="100%"  />
<p class="caption">
Figure 1.2: Main functions and parameters of each method
</p>
</div>
</div>
<div id="id_01:pubs" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Key publications</h3>
<p>The methods implemented in <code>mixOmics</code> are described in detail in the following publications. A more extensive list can be found at this <a href="http://mixomics.org/a-propos/publications/">link</a>.</p>
<ul>
<li><p><strong>Overview and recent integrative methods</strong>: Rohart F., Gautier, B, Singh, A, Le Cao, K. A. mixOmics: an <a href="http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005752">R package for ’omics feature selection and multiple data integration</a>. <em>PLoS Comput Biol</em> 13(11): e1005752.</p></li>
<li><p><strong>Graphical outputs for integrative methods</strong>: <span class="citation">(<a href="#ref-Gon12" role="doc-biblioref">González et al. 2012</a>)</span> Gonzalez I., Le Cao K.-A., Davis, M.D. and Dejean S. (2012) <a href="https://biodatamining.biomedcentral.com/articles/10.1186/1756-0381-5-19">Insightful graphical outputs to explore relationships between two omics data sets</a>. <em>BioData Mining</em> 5:19.</p></li>
<li><p><strong>DIABLO</strong>: Singh A, Gautier B, Shannon C, Vacher M, Rohart F, Tebbutt S, K-A. Le Cao. <a href="https://www.biorxiv.org/content/early/2018/03/20/067611">DIABLO - multi-omics data integration for biomarker discovery</a>.</p></li>
<li><p><strong>sparse PLS</strong>: Le Cao K.-A., Martin P.G.P, Robert-Granie C. and Besse, P. (2009) <a href="http://www.biomedcentral.com/1471-2105/10/34/">Sparse Canonical Methods for Biological Data Integration: application to a cross-platform study</a>. <em>BMC Bioinformatics</em>, 10:34.</p></li>
<li><p><strong>sparse PLS-DA</strong>: Le Cao K.-A., Boitard S. and Besse P. (2011) <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-12-253">Sparse PLS Discriminant Analysis: biologically relevant feature selection and graphical displays for multiclass problems</a>. <em>BMC Bioinformatics</em>, 22:253.</p></li>
<li><p><strong>Multilevel approach for repeated measurements</strong>: Liquet B, Le Cao K-A, Hocini H, Thiebaut R (2012). <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-13-325">A novel approach for biomarker selection and the integration of repeated measures experiments from two assays</a>. <em>BMC Bioinformatics</em>, 13:325</p></li>
<li><p><strong>sPLS-DA for microbiome data</strong>: Le Cao K-A<span class="math inline">\(^*\)</span>, Costello ME <span class="math inline">\(^*\)</span>, Lakis VA , Bartolo F, Chua XY, Brazeilles R and Rondeau P. (2016) <a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0160169">MixMC: Multivariate insights into Microbial Communities</a>.PLoS ONE 11(8): e0160169</p></li>
</ul>
</div>
</div>
<div id="id_01:outline" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Outline of this Vignette</h2>
<ul>
<li><strong><a href="#id_02">Chapter 2</a></strong>: details some practical aspects to get started</li>
<li><strong><a href="#id_03">Chapter 3</a></strong>: Principal Components Analysis (PCA)</li>
<li><strong><a href="#id_04">Chapter 4</a></strong>: Projection to Latent Structures (PLS)</li>
<li><strong><a href="#id_05">Chapter 5</a></strong>: Projection to Latent Structure - Discriminant Analysis (PLS-DA)</li>
<li><strong><a href="#id_06">Chapter 6</a></strong>: Integrative analysis for multiple data sets, across samples (namely DIABLO)</li>
<li><strong><a href="#id_07">Chapter 7</a></strong>: Integrative analysis for multiple data, across features (namely MINT)</li>
</ul>
<p>Each methods chapter has the following outline:</p>
<ol style="list-style-type: decimal">
<li>Type of biological question to be answered</li>
<li>Brief description of an illustrative data set</li>
<li>Principle of the method</li>
<li>Quick start of the method with the main functions and arguments</li>
<li>To go further: customized plots, additional graphical outputs, and tuning parameters</li>
<li>FAQ</li>
</ol>
</div>
<div id="other-methods-not-covered-in-this-vignette" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Other methods not covered in this vignette</h2>
<p>Other methods not covered in this document are described on our website and the following references:</p>
<ul>
<li><p><a href="http://www.mixOmics.org">regularised Canonical Correlation Analysis</a>, see the <strong>Methods</strong> and <strong>Case study</strong> tabs, and <span class="citation">(<a href="#ref-Gon08" role="doc-biblioref">González et al. 2008</a>)</span> that describes CCA for large data sets.</p></li>
<li><p><a href="http://www.mixOmics.org/mixmc">Microbiome (16S, shotgun metagenomics) data analysis</a>, see also <span class="citation">(<a href="#ref-Lec16" role="doc-biblioref">Lê Cao et al. 2016</a>)</span> and <a href="http://mixomics.org/mixkernel">kernel integration for microbiome data</a>. The latter is in collaboration with Drs J Mariette and Nathalie Villa-Vialaneix (INRA Toulouse, France), an example is provided for the Tara ocean metagenomics and environmental data.</p></li>
</ul>

</div>
</div>
<div id="id_02" class="section level1" number="2">
<h1><span class="header-section-number"> 2</span> Let’s get started</h1>
<div id="id_02:install" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Installation</h2>
<p>First, download the latest version from Bioconductor:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;mixOmics&quot;</span>)</span></code></pre></div>
<p>Alternatively, you can install the latest GitHub version of the package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;mixOmicsTeam/mixOmics&quot;</span>)</span></code></pre></div>
<p>The <code>mixOmics</code> package should directly import the following packages:
<code>igraph, rgl, ellipse, corpcor, RColorBrewer, plyr, parallel, dplyr, tidyr, reshape2, methods, matrixStats, rARPACK, gridExtra</code>.
<strong>For Apple mac users:</strong> if you are unable to install the imported package <code>rgl</code>, you will need to install the <a href="https://www.xquartz.org">XQuartz software</a> first.</p>
</div>
<div id="id_02:load-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Load the package</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span></code></pre></div>
<p>Check that there is no error when loading the package, especially for the <code>rgl</code> library (see above).</p>
</div>
<div id="upload-data" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Upload data</h2>
<p>The examples we give in this vignette use data that are already part of the package. To upload your own data, check first that your working directory is set, then read your data from a <code>.txt</code> or <code>.csv</code> format, either by using <strong>File &gt; Import Dataset</strong> in RStudio or via one of these command lines:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from csv file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;your_data.csv&quot;</span>, <span class="at">row.names =</span> <span class="dv">1</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># from txt file</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;your_data.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>For more details about the arguments used to modify those functions, type <code>?read.csv</code> or <code>?read.table</code> in the R console.</p>
</div>
<div id="id_02:quick-start" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Quick start in <code>mixOmics</code></h2>
<p>Each analysis should follow this workflow:</p>
<ol style="list-style-type: decimal">
<li>Run the method</li>
<li>Graphical representation of the samples</li>
<li>Graphical representation of the variables</li>
</ol>
<p>Then use your critical thinking and additional functions and visual tools to make sense of your data! (some of which are listed in <a href="#id_01:overview">1.2.2</a>) and will be described in the next Chapters.</p>
<p>For instance, for Principal Components Analysis, we first load the data:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(nutrimouse)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> nutrimouse<span class="sc">$</span>gene</span></code></pre></div>
<p>Then use the following steps:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>MyResult.pca <span class="ot">&lt;-</span> <span class="fu">pca</span>(X)  <span class="co"># 1 Run the method</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(MyResult.pca) <span class="co"># 2 Plot the samples</span></span></code></pre></div>
<p><img src="Figures/02-pca-nutrimouse-1.png" width="75%"  style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(MyResult.pca)   <span class="co"># 3 Plot the variables</span></span></code></pre></div>
<p><img src="Figures/02-pca-nutrimouse-2.png" width="75%"  style="display: block; margin: auto;" /></p>
<p>This is only a first quick-start, there will be many avenues you can take to deepen your exploratory and integrative analyses. The package proposes several methods to perform variable, or feature selection to identify the relevant information from rather large omics data sets. The sparse methods are listed in the Table in <a href="#id_01:overview">1.2.2</a>.</p>
<p>Following our example here, sparse PCA can be applied to select the top 5 variables contributing to each of the two components in PCA. The user specifies the number of variables to selected on each component, for example, here 5 variables are selected on each of the first two components (<code>keepX=c(5,5)</code>):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>MyResult.spca <span class="ot">&lt;-</span> <span class="fu">spca</span>(X, <span class="at">keepX=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>)) <span class="co"># 1 Run the method</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(MyResult.spca)               <span class="co"># 2 Plot the samples</span></span></code></pre></div>
<p><img src="Figures/02-spca-nutrimouse-1.png" width="75%"  style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(MyResult.spca)                 <span class="co"># 3 Plot the variables</span></span></code></pre></div>
<p><img src="Figures/02-spca-nutrimouse-2.png" width="75%"  style="display: block; margin: auto;" /></p>
<p>You can see know that we have considerably reduced the number of genes in the <code>plotVar</code> correlation circle plot.</p>
<p>Do not stop here! We are not done yet. You can enhance your analyses with the following:</p>
<ul>
<li><p>Have a look at our manual and each of the functions and their examples, e.g. <code>?pca</code>, <code>?plotIndiv</code>, <code>?sPCA</code>, …</p></li>
<li><p>Run the examples from the help file using the <code>example</code> function: <code>example(pca)</code>, <code>example(plotIndiv)</code>, …</p></li>
<li><p>Have a look at our <a href="http://www.mixomics.org">website</a> that features many tutorials and case studies,</p></li>
<li><p>Keep reading this vignette, this is <em>just the beginning!</em></p></li>
</ul>

</div>
</div>
<div id="id_03" class="section level1" number="3">
<h1><span class="header-section-number"> 3</span> PCA on the <code>multidrug</code> study</h1>
<p>To illustrate PCA and is variants, we will analyse the <code>multidrug</code> case study available in the package. This pharmacogenomic study investigates the patterns of drug activity in cancer cell lines <span class="citation">(<a href="#ref-Sza04" role="doc-biblioref">Szakács et al. 2004</a>)</span>. These cell lines come from the <a href="https://dtp.cancer.gov/discovery_development/nci-60/">NCI-60 Human Tumor Cell Lines</a> established by the Developmental Therapeutics Program of the National Cancer Institute (NCI) to screen for the toxicity of chemical compound repositories in diverse cancer cell lines. NCI-60 includes cell lines derived from cancers of colorectal (7 cell lines), renal (8), ovarian (6), breast (8), prostate (2), lung (9) and central nervous system origin (6), as well as leukemia (6) and melanoma (8).</p>
<p>Two separate data sets (representing two types of measurements) on the same NCI-60 cancer cell lines are available in <code>multidrug</code> (see also <code>?multidrug</code>):</p>
<ul>
<li><p><code>$ABC.trans</code>: Contains the expression of 48 human ABC transporters measured by quantitative real-time PCR (RT-PCR) for each cell line.</p></li>
<li><p><code>$compound</code>: Contains the activity of 1,429 drugs expressed as GI50, which is the drug concentration that induces 50% inhibition of cellular growth for the tested cell line.</p></li>
</ul>
<p>Additional information will also be used in the outputs:</p>
<ul>
<li><p><code>$comp.name</code>: The names of the 1,429 compounds.</p></li>
<li><p><code>$cell.line</code>: Information on the cell line names (<code>$Sample</code>) and the cell line types (<code>$Class</code>).</p></li>
</ul>
<p>In this activity, we illustrate PCA performed on the human ABC transporters <code>ABC.trans</code>, and sparse PCA on the compound data <code>compound</code>.</p>
<div id="id_03:load-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Load the data</h2>
<p>The input data matrix <span class="math inline">\(\boldsymbol{X}\)</span> is of size <span class="math inline">\(N\)</span> samples in rows and <span class="math inline">\(P\)</span> variables (e.g. genes) in columns. We start with the <code>ABC.trans</code> data.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(multidrug)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> multidrug<span class="sc">$</span>ABC.trans</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X) <span class="co"># Check dimensions of data</span></span></code></pre></div>
<pre><code>## [1] 60 48</code></pre>
</div>
<div id="id_03:pca" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Example: PCA</h2>
<div id="id_03:pca-ncomp" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Choose the number of components</h3>
<p>Contrary to the minimal code example, here we choose to also scale the variables for the reasons detailed earlier. The function <code>tune.pca()</code> calculates the cumulative proportion of explained variance for a large number of principal components (here we set <code>ncomp = 10</code>). A screeplot of the proportion of explained variance relative to the total amount of variance in the data for each principal component is output (Fig. <a href="#fig:03-screeplot">3.1</a>):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tune.pca.multi <span class="ot">&lt;-</span> <span class="fu">tune.pca</span>(X, <span class="at">ncomp =</span> <span class="dv">10</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tune.pca.multi)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-screeplot"></span>
<img src="Figures/PCA/03-screeplot-1.png" alt="Screeplot from the PCA performed on the ABC.trans data: Amount of explained variance for each principal component on the ABC transporter data." width="70%"  />
<p class="caption">
Figure 3.1: <strong>Screeplot from the PCA performed on the <code>ABC.trans</code> data</strong>: Amount of explained variance for each principal component on the ABC transporter data.
</p>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tune.pca.multidrug$cum.var       # Outputs cumulative proportion of variance</span></span></code></pre></div>

<p>From the numerical output (not shown here), we observe that the first two principal components explain 22.87% of the total variance, and the first three principal components explain 29.88% of the total variance. The rule of thumb for choosing the number of components is not so much to set a hard threshold based on the cumulative proportion of explained variance (as this is data-dependent), but to observe when a drop, or elbow, appears on the screeplot. The elbow indicates that the remaining variance is spread over many principal components and is not relevant in obtaining a low dimensional ‘snapshot’ of the data. This is an empirical way of choosing the number of principal components to retain in the analysis. In this specific example we could choose between 2 to 3 components for the final PCA, however these criteria are highly subjective and the reader must keep in mind that visualisation becomes difficult above three dimensions.</p>
</div>
<div id="id_03:pca-final" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> PCA with fewer components</h3>
<p>Based on the preliminary analysis above, we run a PCA with three components. Here we show additional input, such as whether to center or scale the variables.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>final.pca.multi <span class="ot">&lt;-</span> <span class="fu">pca</span>(X, <span class="at">ncomp =</span> <span class="dv">3</span>, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># final.pca.multi  # Lists possible outputs</span></span></code></pre></div>
<p>The output is similar to the tuning step above. Here the total variance in the data is:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>final.pca.multi<span class="sc">$</span>var.tot</span></code></pre></div>
<pre><code>## [1] 47.98305</code></pre>
<p>By summing the variance explained from all possible components, we would achieve the same amount of explained variance. The proportion of explained variance per component is:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>final.pca.multi<span class="sc">$</span>prop_expl_var<span class="sc">$</span>X</span></code></pre></div>
<pre><code>##        PC1        PC2        PC3 
## 0.12677541 0.10194929 0.07011818</code></pre>
<p>The cumulative proportion of variance explained can also be extracted (as displayed in Figure <a href="#fig:03-screeplot">3.1</a>):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>final.pca.multi<span class="sc">$</span>cum.var</span></code></pre></div>
<pre><code>##       PC1       PC2       PC3 
## 0.1267754 0.2287247 0.2988429</code></pre>
</div>
<div id="id_03:pca-vars" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Identify the informative variables</h3>
<p>To calculate components, we use the variable coefficient weights indicated in the loading vectors. Therefore, the absolute value of the coefficients in the loading vectors inform us about the importance of each variable in contributing to the definition of each component. We can extract this information through the <code>selectVar()</code> function which ranks the most important variables in decreasing order according to their absolute loading weight value for each principal component.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top variables on the first component only:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">selectVar</span>(final.pca.multi, <span class="at">comp =</span> <span class="dv">1</span>)<span class="sc">$</span>value)</span></code></pre></div>
<pre><code>##        value.var
## ABCE1  0.3242162
## ABCD3  0.2647565
## ABCF3  0.2613074
## ABCA8 -0.2609394
## ABCB7  0.2493680
## ABCF1  0.2424253</code></pre>
<p>Note:</p>
<ul>
<li><em>Here the variables are not selected (all are included), but ranked according to their importance in defining each component.</em></li>
</ul>
</div>
<div id="id_03:pca-sample-plot" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Sample plots</h3>
<p>We project the samples into the space spanned by the principal components to visualise how the samples cluster and assess for biological or technical variation in the data. We colour the samples according to the cell line information available in <code>multidrug$cell.line$Class</code> by specifying the argument <code>group</code> (Fig. <a href="#fig:03-pca-sample-plot">3.2</a>).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.pca.multi,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">comp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),   <span class="co"># Specify components to plot</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">ind.names =</span> <span class="cn">TRUE</span>, <span class="co"># Show row names of samples</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">group =</span> multidrug<span class="sc">$</span>cell.line<span class="sc">$</span>Class,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;ABC transporters, PCA comp 1 - 2&#39;</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="cn">TRUE</span>, <span class="at">legend.title =</span> <span class="st">&#39;Cell line&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-pca-sample-plot"></span>
<img src="Figures/PCA/03-pca-sample-plot-1.png" alt="Sample plot from the PCA performed on the ABC.trans data. Samples are projected into the space spanned by the first two principal components, and coloured according to cell line type. Numbers indicate the rownames of the data." width="70%"  />
<p class="caption">
Figure 3.2: <strong>Sample plot from the PCA performed on the <code>ABC.trans</code> data</strong>. Samples are projected into the space spanned by the first two principal components, and coloured according to cell line type. Numbers indicate the rownames of the data.
</p>
</div>

<p>Because we have run PCA on three components, we can examine the third component, either by plotting the samples onto the principal components 1 and 3 (PC1 and PC3) in the code above (<code>comp = c(1, 3)</code>) or by using the 3D interactive plot (code shown below). The addition of the third principal component only seems to highlight a potential outlier (sample 8, not shown). Potentially, this sample could be removed from the analysis, or, noted when doing further downstream analysis. The removal of outliers should be exercised with great caution and backed up with several other types of analyses (e.g. clustering) or graphical outputs (e.g. boxplots, heatmaps, etc).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive 3D plot will load the rgl library.</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.pca.multi, <span class="at">style =</span> <span class="st">&#39;3d&#39;</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> multidrug<span class="sc">$</span>cell.line<span class="sc">$</span>Class,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;ABC transporters, PCA comp 1 - 3&#39;</span>)</span></code></pre></div>
<p>These plots suggest that the largest source of variation explained by the first two components can be attributed to the <span style="color: #CC79A7;">melanoma</span> cell line, while the third component highlights a single outlier sample. Hence, the interpretation of the following outputs should primarily focus on the first two components.</p>
<p>Note:</p>
<ul>
<li><em>Had we not scaled the data, the separation of the melanoma cell lines would have been more obvious with the addition of the third component, while PC1 and PC2 would have also highlighted the sample outliers 4 and 8. Thus, centering and scaling are important steps to take into account in PCA.</em></li>
</ul>
</div>
<div id="id_03:pca-variable-plot" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Variable plot: correlation circle plot</h3>
<p>Correlation circle plots indicate the contribution of each variable to each component using the <code>plotVar()</code> function, as well as the correlation between variables (indicated by a ‘cluster’ of variables). Note that to interpret the latter, the variables need to be centered and scaled in PCA:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(final.pca.multi, <span class="at">comp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex =</span> <span class="dv">3</span>,         <span class="co"># To change the font size</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cutoff = 0.5,  # For further cutoff</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Multidrug transporter, PCA comp 1 - 2&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-pca-variable-plot"></span>
<img src="Figures/PCA/03-pca-variable-plot-1.png" alt="Correlation Circle plot from the PCA performed on the ABC.trans data. The plot shows groups of transporters that are highly correlated, and also contribute to PC1 - near the big circle on the right hand side of the plot (transporters grouped with those in orange), or PC1 and PC2 - top left and top bottom corner of the plot, transporters grouped with those in pink and yellow." width="70%"  />
<p class="caption">
Figure 3.3: <strong>Correlation Circle plot from the PCA performed on the <code>ABC.trans</code> data</strong>. The plot shows groups of transporters that are highly correlated, and also contribute to PC1 - near the big circle on the right hand side of the plot (transporters grouped with those in <span style="color: #F68B33;">orange</span>), or PC1 and PC2 - top left and top bottom corner of the plot, transporters grouped with those in <span style="color: #CC79A7;">pink</span> and <span style="color: #999900;">yellow</span>.
</p>
</div>

<p>The plot in Figure <a href="#fig:03-pca-variable-plot">3.3</a> highlights a group of ABC transporters that contribute to PC1: <span style="color: #F68B33;">ABCE1</span>, and to some extent the group clustered with <span style="color: #F68B33;">ABCB8</span> that contributes positively to PC1, while <span style="color: #009E73;">ABCA8</span> contributes negatively. We also observe a group of transporters that contribute to both PC1 and PC2: the group clustered with <span style="color: #CC79A7;">ABCC2</span> contributes positively to PC2 and negatively to PC1, and a cluster of <span style="color: #999900;">ABCC12</span> and <span style="color: #999900;">ABCD2</span> that contributes negatively to both PC1 and PC2. We observe that several transporters are inside the small circle. However, examining the third component (argument <code>comp = c(1, 3)</code>) does not appear to reveal further transporters that contribute to this third component. The additional argument <code>cutoff = 0.5</code> could further simplify this plot.</p>
</div>
<div id="id_03:pca-biplot" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Biplot: samples and variables</h3>
<p>A biplot allows us to display both samples and variables simultaneously to further understand their relationships. Samples are displayed as dots while variables are displayed at the tips of the arrows. Similar to correlation circle plots, data must be centered and scaled to interpret the correlation between variables (as a cosine angle between variable arrows).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(final.pca.multi, <span class="at">group =</span> multidrug<span class="sc">$</span>cell.line<span class="sc">$</span>Class, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend.title =</span> <span class="st">&#39;Cell line&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-pca-biplot"></span>
<img src="Figures/PCA/03-pca-biplot-1.png" alt="Biplot from the PCA performed on the ABS.trans data. The plot highlights which transporter expression levels may be related to specific cell lines, such as melanoma." width="70%"  />
<p class="caption">
Figure 3.4: <strong>Biplot from the PCA performed on the <code>ABS.trans</code> data</strong>. The plot highlights which transporter expression levels may be related to specific cell lines, such as <span style="color: #CC79A7;">melanoma</span>.
</p>
</div>

<p>The biplot in Figure <a href="#fig:03-pca-biplot">3.4</a> shows that the <span style="color: #CC79A7;">melanoma</span> cell lines seem to be characterised by a subset of transporters such as the cluster around <span style="color: #CC79A7;">ABCC2</span> as highlighted previously in Figure <a href="#fig:03-pca-variable-plot">3.3</a>. Further examination of the data, such as boxplots (as shown in Fig. <a href="#fig:03-pca-boxplot">3.5</a>), can further elucidate the transporter expression levels for these specific samples.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ABCC2.scale <span class="ot">&lt;-</span> <span class="fu">scale</span>(X[, <span class="st">&#39;ABCC2&#39;</span>], <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(ABCC2.scale <span class="sc">~</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        multidrug<span class="sc">$</span>cell.line<span class="sc">$</span>Class, <span class="at">col =</span> <span class="fu">color.mixo</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&#39;Cell lines&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Expression levels, scaled&#39;</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">par</span>(<span class="at">cex.axis =</span> <span class="fl">0.5</span>), <span class="co"># Font size</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&#39;ABCC2 transporter&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-pca-boxplot"></span>
<img src="Figures/PCA/03-pca-boxplot-1.png" alt="Boxplots of the transporter ABCC2 identified from the PCA correlation circle plot (Fig. 3.3) and the biplot (Fig. 3.4) show the level of ABCC2 expression related to cell line types. The expression level of ABCC2 was centered and scaled in the PCA, but similar patterns are also observed in the original data." width="70%"  />
<p class="caption">
Figure 3.5: <strong>Boxplots of the transporter <span style="color: #CC79A7;">ABCC2</span></strong> identified from the PCA correlation circle plot (Fig. <a href="#fig:03-pca-variable-plot">3.3</a>) and the biplot (Fig. <a href="#fig:03-pca-biplot">3.4</a>) show the level of <span style="color: #CC79A7;">ABCC2</span> expression related to cell line types. The expression level of <span style="color: #CC79A7;">ABCC2</span> was centered and scaled in the PCA, but similar patterns are also observed in the original data.
</p>
</div>

</div>
</div>
<div id="id_03:spca" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Example: sparse PCA</h2>
<p>In the <code>ABC.trans</code> data, there is only one missing value. Missing values can be handled by sPCA via the NIPALS algorithm . However, if the number of missing values is large, we recommend imputing them with NIPALS, as we describe in our website in www.mixOmics.org.</p>
<div id="id_03:spca-vars" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Choose the number of variables to select</h3>
<p>First, we must decide on the number of components to evaluate. The previous tuning step indicated that <code>ncomp = 3</code> was sufficient to explain most of the variation in the data, which is the value we choose in this example. We then set up a grid of <code>keepX</code> values to test, which can be thin or coarse depending on the total number of variables. We set up the grid to be thin at the start, and coarse as the number of variables increases. The <code>ABC.trans</code> data includes a sufficient number of samples to perform repeated 5-fold cross-validation to define the number of folds and repeats (leave-one-out CV is also possible if the number of samples <span class="math inline">\(N\)</span> is small by specifying <code>folds =</code> <span class="math inline">\(N\)</span>). The computation may take a while if you are not using parallelisation (see additional parameters in <code>tune.spca()</code>), here we use a small number of repeats for illustrative purposes. We then plot the output of the tuning function.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>grid.keepX <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">30</span>, <span class="dv">5</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># grid.keepX  # To see the grid</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">30</span>) <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>tune.spca.result <span class="ot">&lt;-</span> <span class="fu">tune.spca</span>(X, <span class="at">ncomp =</span> <span class="dv">3</span>, </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">folds =</span> <span class="dv">5</span>, </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">test.keepX =</span> grid.keepX, <span class="at">nrepeat =</span> <span class="dv">10</span>) </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Consider adding up to 50 repeats for more stable results</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>tune.spca.result<span class="sc">$</span>choice.keepX</span></code></pre></div>
<pre><code>## comp1 comp2 comp3 
##    10    10    15</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tune.spca.result)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-spca-tuning"></span>
<img src="Figures/PCA/03-spca-tuning-1.png" alt="Tuning the number of variables to select with sPCA on the ABC.trans data. For a grid of number of variables to select indicated on the x-axis, the average correlation between predicted and actual components based on cross-validation is calculated and shown on the y-axis for each component. The optimal number of variables to select per component is assessed via one-sided \(t-\)tests and is indicated with a diamond." width="70%"  />
<p class="caption">
Figure 3.6: <strong>Tuning the number of variables to select with sPCA on the <code>ABC.trans</code> data</strong>. For a grid of number of variables to select indicated on the x-axis, the average correlation between predicted and actual components based on cross-validation is calculated and shown on the y-axis for each component. The optimal number of variables to select per component is assessed via one-sided <span class="math inline">\(t-\)</span>tests and is indicated with a diamond.
</p>
</div>

<p>The tuning function outputs the averaged correlation between predicted and actual components per <code>keepX</code> value for each component. It indicates the optimal number of variables to select for which the averaged correlation is maximised on each component. Figure <a href="#fig:03-spca-tuning">3.6</a> shows that this is achieved when selecting 10 transporters on the first component, and 10 on the second. Given the drop in values in the averaged correlations for the third component, we decide to only retain two components.</p>
<p>Note:</p>
<ul>
<li><em>If the tuning results suggest a large number of variables to select that is close to the total number of variables, we can arbitrarily choose a much smaller selection size.</em></li>
</ul>
</div>
<div id="id_03:spca-final" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Final sparse PCA</h3>
<p>Based on the tuning above, we perform the final sPCA where the number of variables to select on each component is specified with the argument <code>keepX</code>. Arbitrary values can also be input if you would like to skip the tuning step for more exploratory analyses:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># By default center = TRUE, scale = TRUE</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>keepX.select <span class="ot">&lt;-</span> tune.spca.result<span class="sc">$</span>choice.keepX[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>final.spca.multi <span class="ot">&lt;-</span> <span class="fu">spca</span>(X, <span class="at">ncomp =</span> <span class="dv">2</span>, <span class="at">keepX =</span> keepX.select)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of explained variance:</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>final.spca.multi<span class="sc">$</span>prop_expl_var<span class="sc">$</span>X</span></code></pre></div>
<pre><code>##        PC1        PC2 
## 0.11598017 0.09619528</code></pre>
<p>Overall when considering two components, we lose approximately 1.7 % of explained variance compared to a full PCA, but the aim of this analysis is to identify key transporters driving the variation in the data, as we show below.</p>
</div>
<div id="id_03:spca-plots" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Sample and variable plots</h3>
<p>We first examine the sPCA sample plot:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.spca.multi,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">comp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),   <span class="co"># Specify components to plot</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">ind.names =</span> <span class="cn">TRUE</span>, <span class="co"># Show row names of samples</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">group =</span> multidrug<span class="sc">$</span>cell.line<span class="sc">$</span>Class,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;ABC transporters, sPCA comp 1 - 2&#39;</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="cn">TRUE</span>, <span class="at">legend.title =</span> <span class="st">&#39;Cell line&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-spca-sample-plot"></span>
<img src="Figures/PCA/03-spca-sample-plot-1.png" alt="Sample plot from the sPCA performed on the ABC.trans data. Samples are projected onto the space spanned by the first two sparse principal components that are calculated based on a subset of selected variables. Samples are coloured by cell line type and numbers indicate the sample IDs." width="70%"  />
<p class="caption">
Figure 3.7: <strong>Sample plot from the sPCA performed on the <code>ABC.trans</code> data</strong>. Samples are projected onto the space spanned by the first two sparse principal components that are calculated based on a subset of selected variables. Samples are coloured by cell line type and numbers indicate the sample IDs.
</p>
</div>

<p>In Figure <a href="#fig:03-spca-sample-plot">3.7</a>, component 2 in sPCA shows clearer separation of the <span style="color: #CC79A7;">melanoma</span> samples compared to the full PCA. Component 1 is similar to the full PCA. Overall, this sample plot shows that little information is lost compared to a full PCA.</p>
<p>A biplot can also be plotted that only shows the selected transporters (Figure <a href="#fig:03-spca-biplot">3.8</a>):</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(final.spca.multi, <span class="at">group =</span> multidrug<span class="sc">$</span>cell.line<span class="sc">$</span>Class, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span><span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-spca-biplot"></span>
<img src="Figures/PCA/03-spca-biplot-1.png" alt="Biplot from the sPCA performed on the ABS.trans data after variable selection. The plot highlights in more detail which transporter expression levels may be related to specific cell lines, such as melanoma, compared to a classical PCA." width="70%"  />
<p class="caption">
Figure 3.8: <strong>Biplot from the sPCA performed on the <code>ABS.trans</code> data after variable selection</strong>. The plot highlights in more detail which transporter expression levels may be related to specific cell lines, such as melanoma, compared to a classical PCA.
</p>
</div>

<p>The correlation circle plot highlights variables that contribute to component 1 and component 2 (Fig. <a href="#fig:03-spca-variable-plot">3.9</a>):</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(final.spca.multi, <span class="at">comp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">var.names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex =</span> <span class="dv">3</span>, <span class="co"># To change the font size </span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Multidrug transporter, sPCA comp 1 - 2&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-spca-variable-plot"></span>
<img src="Figures/PCA/03-spca-variable-plot-1.png" alt="Correlation Circle plot from the sPCA performed on the ABC.trans data. Only the transporters selected by the sPCA are shown on this plot. Transporters coloured in green are discussed in the text." width="70%"  />
<p class="caption">
Figure 3.9: <strong>Correlation Circle plot from the sPCA performed on the <code>ABC.trans</code> data</strong>. Only the transporters selected by the sPCA are shown on this plot. Transporters coloured in <span style="color: #009E73;">green</span> are discussed in the text.
</p>
</div>

<p>The transporters selected by sPCA are amongst the most important ones in PCA. Those coloured in green in Figure <a href="#fig:03-pca-variable-plot">3.3</a> (<span style="color: #009E73;">ABCA9, ABCB5, ABCC2</span> and <span style="color: #009E73;">ABCD1</span>) show an example of variables that contribute positively to component 2, but with a larger weight than in PCA. Thus, they appear as a clearer cluster in the top part of the correlation circle plot compared to PCA. As shown in the biplot in Figure <a href="#fig:03-spca-biplot">3.8</a>, they contribute in explaining the variation in the <span style="color: #CC79A7;">melanoma</span> samples.</p>
<p>We can extract the variable names and their positive or negative contribution to a given component (here 2), using the <code>selectVar()</code> function:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On the first component, just a head</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">selectVar</span>(final.spca.multi, <span class="at">comp =</span> <span class="dv">2</span>)<span class="sc">$</span>value)</span></code></pre></div>
<pre><code>##        value.var
## ABCA9  0.4855441
## ABCB5  0.4805404
## ABCC2  0.4208411
## ABCD1  0.4177948
## ABCA3 -0.3404771
## ABCD2 -0.1590031</code></pre>
<p>The loading weights can also be visualised with <code>plotLoading()</code>, where variables are ranked from the least important (top) to the most important (bottom) in Figure <a href="#fig:03-spca-loading-plot">3.10</a>). Here on component 2:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLoadings</span>(final.spca.multi, <span class="at">comp =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:03-spca-loading-plot"></span>
<img src="Figures/PCA/03-spca-loading-plot-1.png" alt="sPCA loading plot of the ABS.trans data for component 2. Only the transporters selected by sPCA on component 2 are shown, and are ranked from least important (top) to most important. Bar length indicates the loading weight in PC2." width="70%"  />
<p class="caption">
Figure 3.10: <strong>sPCA loading plot of the <code>ABS.trans</code> data for component 2</strong>. Only the transporters selected by sPCA on component 2 are shown, and are ranked from least important (top) to most important. Bar length indicates the loading weight in PC2.
</p>
</div>


</div>
</div>
</div>
<div id="id_04" class="section level1" number="4">
<h1><span class="header-section-number"> 4</span> PLS on the liver toxicity study</h1>
<p>The data come from a liver toxicity study in which 64 male rats were exposed to non-toxic (50 or 150 mg/kg), moderately toxic (1500 mg/kg) or severely toxic (2000 mg/kg) doses of acetaminophen (paracetamol) <span class="citation">(<a href="#ref-Bus07" role="doc-biblioref">Bushel, Wolfinger, and Gibson 2007</a>)</span>. Necropsy was performed at 6, 18, 24 and 48 hours after exposure and the mRNA was extracted from the liver. Ten clinical measurements of markers for liver injury are available for each subject. The microarray data contain expression levels of 3,116 genes. The data were normalised and preprocessed by <span class="citation">Bushel, Wolfinger, and Gibson (<a href="#ref-Bus07" role="doc-biblioref">2007</a>)</span>.</p>
<p><code>liver toxicity</code> contains the following:</p>
<ul>
<li><code>$gene</code>: A data frame with 64 rows (rats) and 3116 columns (gene expression levels),</li>
<li><code>$clinic</code>: A data frame with 64 rows (same rats) and 10 columns (10 clinical variables),</li>
<li><code>$treatment</code>: A data frame with 64 rows and 4 columns, describe the different treatments, such as doses of acetaminophen and times of necropsy.</li>
</ul>
<p>We can analyse these two data sets (genes and clinical measurements) using sPLS1, then sPLS2 with a regression mode to explain or predict the clinical variables with respect to the gene expression levels.</p>
<div id="id_04:load-data" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Load the data</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(liver.toxicity)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> liver.toxicity<span class="sc">$</span>gene</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> liver.toxicity<span class="sc">$</span>clinic</span></code></pre></div>
<p>As we have discussed previously for integrative analysis, we need to ensure that the samples in the two data sets are in the same order, or matching, as we are performing data integration:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(<span class="fu">rownames</span>(X), <span class="fu">rownames</span>(Y)))</span></code></pre></div>
<pre><code>##   rownames.X. rownames.Y.
## 1       ID202       ID202
## 2       ID203       ID203
## 3       ID204       ID204
## 4       ID206       ID206
## 5       ID208       ID208
## 6       ID209       ID209</code></pre>
</div>
<div id="id_04:spls1" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Example: sPLS1 regression</h2>
<p>We first start with a simple case scenario where we wish to explain one <span class="math inline">\(\boldsymbol Y\)</span> variable with a combination of selected <span class="math inline">\(\boldsymbol X\)</span> variables (transcripts). We choose the following clinical measurement which we denote as the <span class="math inline">\(\boldsymbol y\)</span> single response variable:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> liver.toxicity<span class="sc">$</span>clinic[, <span class="st">&quot;ALB.g.dL.&quot;</span>]</span></code></pre></div>
<div id="id_04:spls1-ncomp" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Number of dimensions using the <span class="math inline">\(Q^2\)</span> criterion</h3>
<p>Defining the ‘best’ number of dimensions to explain the data requires we first launch a PLS1 model with a large number of components. Some of the outputs from the PLS1 object are then retrieved in the <code>perf()</code> function to calculate the <span class="math inline">\(Q^2\)</span> criterion using repeated 10-fold cross-validation.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>tune.pls1.liver <span class="ot">&lt;-</span> <span class="fu">pls</span>(<span class="at">X =</span> X, <span class="at">Y =</span> y, <span class="at">ncomp =</span> <span class="dv">4</span>, <span class="at">mode =</span> <span class="st">&#39;regression&#39;</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">33</span>)  <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>Q2.pls1.liver <span class="ot">&lt;-</span> <span class="fu">perf</span>(tune.pls1.liver, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">folds =</span> <span class="dv">10</span>, <span class="at">nrepeat =</span> <span class="dv">5</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Q2.pls1.liver, <span class="at">criterion =</span> <span class="st">&#39;Q2&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls1-ncomp"></span>
<img src="Figures/PLS/04-spls1-ncomp-1.png" alt="\(Q^2\) criterion to choose the number of components in PLS1. For each dimension added to the PLS model, the \(Q^2\) value is shown. The horizontal line of 0.0975 indicates the threshold below which adding a dimension may not be beneficial to improve accuracy in PLS." width="70%"  />
<p class="caption">
Figure 4.1: <strong><span class="math inline">\(Q^2\)</span> criterion to choose the number of components in PLS1</strong>. For each dimension added to the PLS model, the <span class="math inline">\(Q^2\)</span> value is shown. The horizontal line of 0.0975 indicates the threshold below which adding a dimension may not be beneficial to improve accuracy in PLS.
</p>
</div>

<p>The plot in Figure <a href="#fig:04-spls1-ncomp">4.1</a> shows that the <span class="math inline">\(Q^2\)</span> value varies with the number of dimensions added to PLS1, with a decrease to negative values from 2 dimensions. Based on this plot we would choose only one dimension, but we will still add a second dimension for the graphical outputs.</p>
<p>Note:</p>
<ul>
<li><em>One dimension is not unusual given that we only include one <span class="math inline">\(\boldsymbol y\)</span> variable in PLS1.</em></li>
</ul>
</div>
<div id="id_04:spls1-tuning" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Number of variables to select in <span class="math inline">\(\boldsymbol X\)</span></h3>
<p>We now set a grid of values - thin at the start, but also restricted to a small number of genes for a parsimonious model, which we will test for each of the two components in the <code>tune.spls()</code> function, using the MAE criterion.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a grid of values: </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>list.keepX <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">5</span>))     </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># list.keepX  # Inspect the keepX grid</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">33</span>)  <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>tune.spls1.MAE <span class="ot">&lt;-</span> <span class="fu">tune.spls</span>(X, y, <span class="at">ncomp=</span> <span class="dv">2</span>, </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">test.keepX =</span> list.keepX, </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">folds =</span> <span class="dv">10</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nrepeat =</span> <span class="dv">5</span>, </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">progressBar =</span> <span class="cn">FALSE</span>, </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">measure =</span> <span class="st">&#39;MAE&#39;</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tune.spls1.MAE)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls1-tuning"></span>
<img src="Figures/PLS/04-spls1-tuning-1.png" alt="Mean Absolute Error criterion to choose the number of variables to select in PLS1, using repeated CV times for a grid of variables to select. The MAE increases with the addition of a second dimension comp 1 to 2, suggesting that only one dimension is sufficient. The optimal keepX is indicated with a diamond." width="70%"  />
<p class="caption">
Figure 4.2: <strong>Mean Absolute Error criterion to choose the number of variables to select in PLS1</strong>, using repeated CV times for a grid of variables to select. The MAE increases with the addition of a second dimension <span style="color: #F68B33;">comp 1 to 2</span>, suggesting that only one dimension is sufficient. The optimal <code>keepX</code> is indicated with a diamond.
</p>
</div>

<p>Figure <a href="#fig:04-spls1-tuning">4.2</a> confirms that one dimension is sufficient to reach minimal MAE. Based on the <code>tune.spls()</code> function we extract the final parameters:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>choice.ncomp <span class="ot">&lt;-</span> tune.spls1.MAE<span class="sc">$</span>choice.ncomp<span class="sc">$</span>ncomp</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal number of variables to select in X based on the MAE criterion</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We stop at choice.ncomp</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>choice.keepX <span class="ot">&lt;-</span> tune.spls1.MAE<span class="sc">$</span>choice.keepX[<span class="dv">1</span><span class="sc">:</span>choice.ncomp]  </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>choice.ncomp</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>choice.keepX</span></code></pre></div>
<pre><code>## comp1 
##    20</code></pre>
<p>Note:</p>
<ul>
<li><em>Other criterion could have been used and may bring different results. For example, when using <code>measure = 'MSE</code>, the optimal <code>keepX</code> was rather unstable, and is often smaller than when using the MAE criterion. As we have highlighted before, there is some back and forth in the analyses to choose the criterion and parameters that best fit our biological question and interpretation.</em></li>
</ul>
</div>
<div id="id_04:spls1-final" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Final sPLS1 model</h3>
<p>Here is our final model with the tuned parameters:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>spls1.liver <span class="ot">&lt;-</span> <span class="fu">spls</span>(X, y, <span class="at">ncomp =</span> choice.ncomp, <span class="at">keepX =</span> choice.keepX, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>)</span></code></pre></div>
<p>The list of genes selected on component 1 can be extracted with the command line (not output here):</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">selectVar</span>(spls1.liver, <span class="at">comp =</span> <span class="dv">1</span>)<span class="sc">$</span>X<span class="sc">$</span>name</span></code></pre></div>
<p>We can compare the amount of explained variance for the <span class="math inline">\(\boldsymbol X\)</span> data set based on the sPLS1 (on 1 component) versus PLS1 (that was run on 4 components during the tuning step):</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>spls1.liver<span class="sc">$</span>prop_expl_var<span class="sc">$</span>X</span></code></pre></div>
<pre><code>##      comp1 
## 0.08150917</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>tune.pls1.liver<span class="sc">$</span>prop_expl_var<span class="sc">$</span>X</span></code></pre></div>
<pre><code>##      comp1      comp2      comp3      comp4 
## 0.11079101 0.14010577 0.21714518 0.06433377</code></pre>
<p>The amount of explained variance in <span class="math inline">\(\boldsymbol X\)</span> is lower in sPLS1 than PLS1 for the first component. However, we will see in this case study that the Mean Squared Error Prediction is also lower (better) in sPLS1 compared to PLS1.</p>
</div>
<div id="id_04:spls1-sample-plots" class="section level3" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Sample plots</h3>
<p>For further graphical outputs, we need to add a second dimension in the model, which can include the same number of <code>keepX</code> variables as in the first dimension. However, the interpretation should primarily focus on the first dimension. In Figure <a href="#fig:04-spls1-sample-plot">4.3</a> we colour the samples according to the time of treatment and add symbols to represent the treatment dose. Recall however that such information was not included in the sPLS1 analysis.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>spls1.liver.c2 <span class="ot">&lt;-</span> <span class="fu">spls</span>(X, y, <span class="at">ncomp =</span> <span class="dv">2</span>, <span class="at">keepX =</span> <span class="fu">c</span>(<span class="fu">rep</span>(choice.keepX, <span class="dv">2</span>)), </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(spls1.liver.c2,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">group =</span> liver.toxicity<span class="sc">$</span>treatment<span class="sc">$</span>Time.Group,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">pch =</span> <span class="fu">as.factor</span>(liver.toxicity<span class="sc">$</span>treatment<span class="sc">$</span>Dose.Group),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="cn">TRUE</span>, <span class="at">legend.title =</span> <span class="st">&#39;Time&#39;</span>, <span class="at">legend.title.pch =</span> <span class="st">&#39;Dose&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls1-sample-plot"></span>
<img src="Figures/PLS/04-spls1-sample-plot-1.png" alt="Sample plot from the PLS1 performed on the liver.toxicity data with two dimensions. Components associated to each data set (or block) are shown. Focusing only on the projection of the sample on the first component shows that the genes selected in \(\boldsymbol X\) tend to explain the 48h length of treatment vs the earlier time points. This is somewhat in agreement with the levels of the \(\boldsymbol y\) variable. However, more insight can be obtained by plotting the first components only, as shown in Figure 4.4." width="70%"  />
<p class="caption">
Figure 4.3: <strong>Sample plot from the PLS1 performed on the <code>liver.toxicity</code> data with two dimensions</strong>. Components associated to each data set (or block) are shown. Focusing only on the projection of the sample on the first component shows that the genes selected in <span class="math inline">\(\boldsymbol X\)</span> tend to explain the <span style="color: #585858;">48h</span> length of treatment vs the earlier time points. This is somewhat in agreement with the levels of the <span class="math inline">\(\boldsymbol y\)</span> variable. However, more insight can be obtained by plotting the first components only, as shown in Figure <a href="#fig:04-spls1-sample-plot2">4.4</a>.
</p>
</div>

<p>The alternative is to plot the component associated to the <span class="math inline">\(\boldsymbol X\)</span> data set (here corresponding to a linear combination of the selected genes) vs. the component associated to the <span class="math inline">\(\boldsymbol y\)</span> variable (corresponding to the scaled <span class="math inline">\(\boldsymbol y\)</span> variable in PLS1 with one dimension), or calculate the correlation between both components:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define factors for colours matching plotIndiv above</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>time.liver <span class="ot">&lt;-</span> <span class="fu">factor</span>(liver.toxicity<span class="sc">$</span>treatment<span class="sc">$</span>Time.Group, </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;18&#39;</span>, <span class="st">&#39;24&#39;</span>, <span class="st">&#39;48&#39;</span>, <span class="st">&#39;6&#39;</span>))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>dose.liver <span class="ot">&lt;-</span> <span class="fu">factor</span>(liver.toxicity<span class="sc">$</span>treatment<span class="sc">$</span>Dose.Group, </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;50&#39;</span>, <span class="st">&#39;150&#39;</span>, <span class="st">&#39;1500&#39;</span>, <span class="st">&#39;2000&#39;</span>))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up colours and symbols</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>col.liver <span class="ot">&lt;-</span> <span class="fu">color.mixo</span>(time.liver)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>pch.liver <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dose.liver)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spls1.liver<span class="sc">$</span>variates<span class="sc">$</span>X, spls1.liver<span class="sc">$</span>variates<span class="sc">$</span>Y,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;X component&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;y component / scaled y&#39;</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> col.liver, <span class="at">pch =</span> pch.liver)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topleft&#39;</span>, <span class="at">col =</span> <span class="fu">color.mixo</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="at">legend =</span> <span class="fu">levels</span>(time.liver),</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">title =</span> <span class="st">&#39;Time&#39;</span>)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="at">legend =</span> <span class="fu">levels</span>(dose.liver), <span class="at">pch =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Dose&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls1-sample-plot2"></span>
<img src="Figures/PLS/04-spls1-sample-plot2-1.png" alt="Sample plot from the sPLS1 performed on the liver.toxicity data on one dimension. A reduced representation of the 20 genes selected and combined in the \(\boldsymbol X\) component on the \(x-\)axis with respect to the \(\boldsymbol y\) component value (equivalent to the scaled values of \(\boldsymbol y\)) on the \(y-\)axis. We observe a separation between the high doses 1500 and 2000 mg/kg (symbols \(+\) and \(\times\)) at 48h and 18h while low and medium doses cluster in the middle of the plot. High doses for 6h and 18h have high scores for both components." width="70%"  />
<p class="caption">
Figure 4.4: <strong>Sample plot from the sPLS1 performed on the <code>liver.toxicity</code> data on one dimension</strong>. A reduced representation of the 20 genes selected and combined in the <span class="math inline">\(\boldsymbol X\)</span> component on the <span class="math inline">\(x-\)</span>axis with respect to the <span class="math inline">\(\boldsymbol y\)</span> component value (equivalent to the scaled values of <span class="math inline">\(\boldsymbol y\)</span>) on the <span class="math inline">\(y-\)</span>axis. We observe a separation between the high doses 1500 and 2000 mg/kg (symbols <span class="math inline">\(+\)</span> and <span class="math inline">\(\times\)</span>) at <span style="color: #585858;">48h</span> and <span style="color: #388ECC;">18h</span> while low and medium doses cluster in the middle of the plot. High doses for <span style="color: #009E73;">6h</span> and <span style="color: #388ECC;">18h</span> have high scores for both components.
</p>
</div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(spls1.liver<span class="sc">$</span>variates<span class="sc">$</span>X, spls1.liver<span class="sc">$</span>variates<span class="sc">$</span>Y)</span></code></pre></div>
<pre><code>##           comp1
## comp1 0.7515489</code></pre>

<p>Figure <a href="#fig:04-spls1-sample-plot2">4.4</a> is a reduced representation of a multivariate regression with PLS1. It shows that PLS1 effectively models a linear relationship between <span class="math inline">\(\boldsymbol y\)</span> and the combination of the 20 genes selected in <span class="math inline">\(\boldsymbol X\)</span>.</p>
</div>
<div id="id_04:spls1-perf" class="section level3" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Performance assessment of sPLS1</h3>
<p>The performance of the final model can be assessed with the <code>perf()</code> function, using repeated cross-validation (CV). Because a single performance value has little meaning, we propose to compare the performances of a full PLS1 model (with no variable selection) with our sPLS1 model based on the MSEP (other criteria can be used):</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">33</span>)  <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># PLS1 model and performance</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>pls1.liver <span class="ot">&lt;-</span> <span class="fu">pls</span>(X, y, <span class="at">ncomp =</span> choice.ncomp, <span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>perf.pls1.liver <span class="ot">&lt;-</span> <span class="fu">perf</span>(pls1.liver, <span class="at">validation =</span> <span class="st">&quot;Mfold&quot;</span>, <span class="at">folds =</span><span class="dv">10</span>, </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrepeat =</span> <span class="dv">5</span>, <span class="at">progressBar =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>perf.pls1.liver<span class="sc">$</span>measures<span class="sc">$</span>MSEP<span class="sc">$</span>summary</span></code></pre></div>
<pre><code>##   feature comp      mean         sd
## 1       Y    1 0.7281681 0.04134627</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To extract values across all repeats:</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># perf.pls1.liver$measures$MSEP$values</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sPLS1 performance</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>perf.spls1.liver <span class="ot">&lt;-</span> <span class="fu">perf</span>(spls1.liver, <span class="at">validation =</span> <span class="st">&quot;Mfold&quot;</span>, <span class="at">folds =</span> <span class="dv">10</span>, </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrepeat =</span> <span class="dv">5</span>, <span class="at">progressBar =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>perf.spls1.liver<span class="sc">$</span>measures<span class="sc">$</span>MSEP<span class="sc">$</span>summary</span></code></pre></div>
<pre><code>##   feature comp      mean         sd
## 1       Y    1 0.5958565 0.02697727</code></pre>
<p>The MSEP is lower with sPLS1 compared to PLS1, indicating that the <span class="math inline">\(\boldsymbol{X}\)</span> variables selected (listed above with <code>selectVar()</code>) can be considered as a good linear combination of predictors to explain <span class="math inline">\(\boldsymbol y\)</span>.</p>
</div>
</div>
<div id="id_04:spls2" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Example: PLS2 regression</h2>
<p>PLS2 is a more complex problem than PLS1, as we are attempting to fit a linear combination of a subset of <span class="math inline">\(\boldsymbol{Y}\)</span> variables that are maximally covariant with a combination of <span class="math inline">\(\boldsymbol{X}\)</span> variables. The sparse variant allows for the selection of variables from both data sets.</p>
<p>As a reminder, here are the dimensions of the <span class="math inline">\(\boldsymbol{Y}\)</span> matrix that includes clinical parameters associated with liver failure.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Y)</span></code></pre></div>
<pre><code>## [1] 64 10</code></pre>
<div id="id_04:spls2-ncomp" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Number of dimensions using the <span class="math inline">\(Q^2\)</span> criterion</h3>
<p>Similar to PLS1, we first start by tuning the number of components to select by using the <code>perf()</code> function and the <span class="math inline">\(Q^2\)</span> criterion using repeated cross-validation.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tune.pls2.liver <span class="ot">&lt;-</span> <span class="fu">pls</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y, <span class="at">ncomp =</span> <span class="dv">5</span>, <span class="at">mode =</span> <span class="st">&#39;regression&#39;</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">33</span>)  <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>Q2.pls2.liver <span class="ot">&lt;-</span> <span class="fu">perf</span>(tune.pls2.liver, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, <span class="at">folds =</span> <span class="dv">10</span>, </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nrepeat =</span> <span class="dv">5</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Q2.pls2.liver, <span class="at">criterion =</span> <span class="st">&#39;Q2.total&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-ncomp"></span>
<img src="Figures/PLS/04-spls2-ncomp-1.png" alt="\(Q^2\) criterion to choose the number of components in PLS2. For each component added to the PLS2 model, the averaged \(Q^2\) across repeated cross-validation is shown, with the horizontal line of 0.0975 indicating the threshold below which the addition of a dimension may not be beneficial to improve accuracy." width="70%"  />
<p class="caption">
Figure 4.5: <strong><span class="math inline">\(Q^2\)</span> criterion to choose the number of components in PLS2</strong>. For each component added to the PLS2 model, the averaged <span class="math inline">\(Q^2\)</span> across repeated cross-validation is shown, with the horizontal line of 0.0975 indicating the threshold below which the addition of a dimension may not be beneficial to improve accuracy.
</p>
</div>

<p>Figure <a href="#fig:04-spls2-ncomp">4.5</a> shows that one dimension should be sufficient in PLS2. We will include a second dimension in the graphical outputs, whilst focusing our interpretation on the first dimension.</p>
<p>Note:</p>
<ul>
<li><em>Here we chose repeated cross-validation, however, the conclusions were similar for <code>nrepeat = 1</code>.</em></li>
</ul>
</div>
<div id="id_04:spls2-tuning" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Number of variables to select in both <span class="math inline">\(\boldsymbol X\)</span> and <span class="math inline">\(\boldsymbol Y\)</span></h3>
<p>Using the <code>tune.spls()</code> function, we can perform repeated cross-validation to obtain some indication of the number of variables to select. We show an example of code below which may take some time to run (see <code>?tune.spls()</code> to use parallel computing). We had refined the grid of tested values as the tuning function tended to favour a very small signature. Hence we decided to constrain the start of the grid to 3 for a more insightful signature. Both <code>measure = 'cor</code> and <code>RSS</code> gave similar signature sizes, but this observation might differ for other case studies.</p>
<p>The optimal parameters can be output, along with a plot showing the tuning results, as shown in Figure <a href="#fig:04-spls2-tuning">4.6</a>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code may take several min to run, parallelisation option is possible</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>list.keepX <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">50</span>, <span class="dv">5</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>list.keepY <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">33</span>)  <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>tune.spls.liver <span class="ot">&lt;-</span> <span class="fu">tune.spls</span>(X, Y, <span class="at">test.keepX =</span> list.keepX, </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">test.keepY =</span> list.keepY, <span class="at">ncomp =</span> <span class="dv">2</span>, </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nrepeat =</span> <span class="dv">1</span>, <span class="at">folds =</span> <span class="dv">10</span>, <span class="at">mode =</span> <span class="st">&#39;regression&#39;</span>, </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">measure =</span> <span class="st">&#39;cor&#39;</span>, </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#   the following uses two CPUs for faster computation</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># it can be commented out</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">BPPARAM =</span> BiocParallel<span class="sc">::</span><span class="fu">SnowParam</span>(<span class="at">workers =</span> <span class="dv">14</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tune.spls.liver)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-tuning"></span>
<img src="Figures/PLS/04-spls2-tuning-1.png" alt="Tuning plot for sPLS2. For every grid value of keepX and keepY, the averaged correlation coefficients between the \(\boldsymbol t\) and \(\boldsymbol u\) components are shown across repeated CV, with optimal values (here corresponding to the highest mean correlation) indicated in a green square for each dimension and data set." width="60%"  />
<p class="caption">
Figure 4.6: <strong>Tuning plot for sPLS2</strong>. For every grid value of <code>keepX</code> and <code>keepY</code>, the averaged correlation coefficients between the <span class="math inline">\(\boldsymbol t\)</span> and <span class="math inline">\(\boldsymbol u\)</span> components are shown across repeated CV, with optimal values (here corresponding to the highest mean correlation) indicated in a <span style="color: #009E73;">green square</span> for each dimension and data set.
</p>
</div>

</div>
<div id="id_04:spls2-final" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Final sPLS2 model</h3>
<p>Here is our final model with the tuned parameters for our sPLS2 regression analysis. Note that if you choose to not run the tuning step, you can still decide to set the parameters of your choice here.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Optimal parameters</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>choice.keepX <span class="ot">&lt;-</span> tune.spls.liver<span class="sc">$</span>choice.keepX</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>choice.keepY <span class="ot">&lt;-</span> tune.spls.liver<span class="sc">$</span>choice.keepY</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>choice.ncomp <span class="ot">&lt;-</span> <span class="fu">length</span>(choice.keepX)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>spls2.liver <span class="ot">&lt;-</span> <span class="fu">spls</span>(X, Y, <span class="at">ncomp =</span> choice.ncomp, </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">keepX =</span> choice.keepX,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">keepY =</span> choice.keepY,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>)</span></code></pre></div>
<div id="id_04:spls2-variance" class="section level4" number="4.3.3.1">
<h4><span class="header-section-number">4.3.3.1</span> Numerical outputs</h4>
<p>The amount of explained variance can be extracted for each dimension and each data set:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>spls2.liver<span class="sc">$</span>prop_expl_var</span></code></pre></div>
<pre><code>## $X
##      comp1      comp2 
## 0.18571719 0.08314578 
## 
## $Y
##     comp1     comp2 
## 0.3649885 0.2179096</code></pre>
</div>
<div id="id_04:spls2-variables" class="section level4" number="4.3.3.2">
<h4><span class="header-section-number">4.3.3.2</span> Importance variables</h4>
<p>The selected variables can be extracted from the <code>selectVar()</code> function, for example for the <span class="math inline">\(\boldsymbol X\)</span> data set, with either their <code>$name</code> or the loading <code>$value</code> (not output here):</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">selectVar</span>(spls2.liver, <span class="at">comp =</span> <span class="dv">1</span>)<span class="sc">$</span>X<span class="sc">$</span>value</span></code></pre></div>
<p>The VIP measure is exported for all variables in <span class="math inline">\(\boldsymbol X\)</span>, here we only subset those that were selected (non null loading value) for component 1:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>vip.spls2.liver <span class="ot">&lt;-</span> <span class="fu">vip</span>(spls2.liver)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># just a head</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vip.spls2.liver[<span class="fu">selectVar</span>(spls2.liver, <span class="at">comp =</span> <span class="dv">1</span>)<span class="sc">$</span>X<span class="sc">$</span>name,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## A_42_P620915  A_43_P14131 A_42_P578246  A_43_P11724 A_42_P840776 A_42_P675890 
##     32.00310     28.04314     15.89302     14.50512     12.48658     10.94458</code></pre>
<p>The (full) output shows that most <span class="math inline">\(\boldsymbol X\)</span> variables that were selected are important for explaining <span class="math inline">\(\boldsymbol Y\)</span>, since their VIP is greater than 1.</p>
<p>We can examine how frequently each variable is selected when we subsample the data using the <code>perf()</code> function to measure how stable the signature is (Table <a href="#tab:04-spls2-stab-table">4.1</a>). The same could be output for other components and the <span class="math inline">\(\boldsymbol Y\)</span> data set.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>perf.spls2.liver <span class="ot">&lt;-</span> <span class="fu">perf</span>(spls2.liver, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, <span class="at">folds =</span> <span class="dv">10</span>, <span class="at">nrepeat =</span> <span class="dv">5</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract stability</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>stab.spls2.liver.comp1 <span class="ot">&lt;-</span> perf.spls2.liver<span class="sc">$</span>features<span class="sc">$</span>stability.X<span class="sc">$</span>comp1</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Averaged stability of the X selected features across CV runs, as shown in Table</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>stab.spls2.liver.comp1[<span class="dv">1</span><span class="sc">:</span>choice.keepX[<span class="dv">1</span>]]</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We extract the stability measures of only the variables selected in spls2.liver</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>extr.stab.spls2.liver.comp1 <span class="ot">&lt;-</span> stab.spls2.liver.comp1[<span class="fu">selectVar</span>(spls2.liver, </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">comp =</span><span class="dv">1</span>)<span class="sc">$</span>X<span class="sc">$</span>name]</span></code></pre></div>
<table>
<caption>
<span id="tab:04-spls2-stab-table">Table 4.1: </span>Stability measure (occurence of selection) of the bottom 20 variables from X selected with sPLS2 across repeated 10-fold subsampling on component 1.
</caption>
<thead>
<tr>
<th style="text-align:right;">
x
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p>We recommend to mainly focus on the interpretation of the most stable selected variables (with a frequency of occurrence greater than 0.8).</p>
</div>
<div id="id_04:spls2-plots" class="section level4" number="4.3.3.3">
<h4><span class="header-section-number">4.3.3.3</span> Graphical outputs</h4>
<p>
Using the <code>plotIndiv()</code> function, we display the sample and metadata information using the arguments <code>group</code> (colour) and <code>pch</code> (symbol) to better understand the similarities between samples modelled with sPLS2.</p>
<p>The plot on the left hand side corresponds to the projection of the samples from the <span class="math inline">\(\boldsymbol X\)</span> data set (gene expression) and the plot on the right hand side the <span class="math inline">\(\boldsymbol Y\)</span> data set (clinical variables).</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(spls2.liver, <span class="at">ind.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">group =</span> liver.toxicity<span class="sc">$</span>treatment<span class="sc">$</span>Time.Group, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">pch =</span> <span class="fu">as.factor</span>(liver.toxicity<span class="sc">$</span>treatment<span class="sc">$</span>Dose.Group), </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.per.group =</span> <span class="fu">color.mixo</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="cn">TRUE</span>, <span class="at">legend.title =</span> <span class="st">&#39;Time&#39;</span>, </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title.pch =</span> <span class="st">&#39;Dose&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-sample-plot"></span>
<img src="Figures/PLS/04-spls2-sample-plot-1.png" alt="Sample plot for sPLS2 performed on the liver.toxicity data. Samples are projected into the space spanned by the components associated to each data set (or block). We observe some agreement between the data sets, and a separation of the 1500 and 2000 mg doses (\(+\) and \(\times\)) in the 18h, 24h time points, and the 48h time point." width="70%"  />
<p class="caption">
Figure 4.7: <strong>Sample plot for sPLS2 performed on the <code>liver.toxicity</code> data</strong>. Samples are projected into the space spanned by the components associated to each data set (or block). We observe some agreement between the data sets, and a separation of the 1500 and 2000 mg doses (<span class="math inline">\(+\)</span> and <span class="math inline">\(\times\)</span>) in the <span style="color: #388ECC;">18h</span>, <span style="color: #F68B33;">24h</span> time points, and the <span style="color: #585858;">48h</span> time point.
</p>
</div>

<p>From Figure <a href="#fig:04-spls2-sample-plot">4.7</a> we observe an effect of low vs. high doses of acetaminophen (component 1) as well as time of necropsy (component 2). There is some level of agreement between the two data sets, but it is not perfect!</p>
<p>If you run an sPLS with three dimensions, you can consider the 3D <code>plotIndiv()</code> by specifying <code>style = '3d</code> in the function.</p>
<p>The <code>plotArrow()</code> option is useful in this context to visualise the level of agreement between data sets. Recall that in this plot:</p>
<ul>
<li>The start of the arrow indicates the location of the sample in the <span class="math inline">\(\boldsymbol X\)</span> projection space,</li>
<li>The end of the arrow indicates the location of the (same) sample in the <span class="math inline">\(\boldsymbol Y\)</span> projection space,</li>
<li>Long arrows indicate a disagreement between the two projected spaces.</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotArrow</span>(spls2.liver, <span class="at">ind.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">group =</span> liver.toxicity<span class="sc">$</span>treatment<span class="sc">$</span>Time.Group,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.per.group =</span> <span class="fu">color.mixo</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="st">&#39;Time.Group&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-arrow-plot"></span>
<img src="Figures/PLS/04-spls2-arrow-plot-1.png" alt="Arrow plot from the sPLS2 performed on the liver.toxicity data. The start of the arrow indicates the location of a given sample in the space spanned by the components associated to the gene data set, and the tip of the arrow the location of that same sample in the space spanned by the components associated to the clinical data set. We observe large shifts for 18h, 24 and 48h samples for the high doses, however the clusters of samples remain the same, as we observed in Figure 4.7." width="70%"  />
<p class="caption">
Figure 4.8: <strong>Arrow plot from the sPLS2 performed on the <code>liver.toxicity</code> data</strong>. The start of the arrow indicates the location of a given sample in the space spanned by the components associated to the gene data set, and the tip of the arrow the location of that same sample in the space spanned by the components associated to the clinical data set. We observe large shifts for <span style="color: #388ECC;">18h</span>, <span style="color: #F68B33;">24</span> and <span style="color: #585858;">48h</span> samples for the high doses, however the clusters of samples remain the same, as we observed in Figure <a href="#fig:04-spls2-sample-plot">4.7</a>.
</p>
</div>

<p>In Figure <a href="#fig:04-spls2-arrow-plot">4.8</a> we observe that specific groups of samples seem to be located far apart from one data set to the other, indicating a potential discrepancy between the information extracted. However the groups of samples according to either dose or treatment remains similar.</p>
<p>
Correlation circle plots illustrate the correlation structure between the two types of variables. To display only the name of the variables from the <span class="math inline">\(\boldsymbol{Y}\)</span> data set, we use the argument <code>var.names = c(FALSE, TRUE)</code> where each boolean indicates whether the variable names should be output for each data set. We also modify the size of the font, as shown in Figure <a href="#fig:04-spls2-variable-plot">4.9</a>:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(spls2.liver, <span class="at">cex =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">var.names =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-variable-plot"></span>
<img src="Figures/PLS/04-spls2-variable-plot-1.png" alt="Correlation circle plot from the sPLS2 performed on the liver.toxicity data. The plot highlights correlations within selected genes (their names are not indicated here), within selected clinical parameters, and correlations between genes and clinical parameters on each dimension of sPLS2. This plot should be interpreted in relation to Figure 4.7 to better understand how the expression levels of these molecules may characterise specific sample groups." width="70%"  />
<p class="caption">
Figure 4.9: <strong>Correlation circle plot from the sPLS2 performed on the <code>liver.toxicity</code> data</strong>. The plot highlights correlations <em>within</em> selected genes (their names are not indicated here), <em>within</em> selected clinical parameters, and correlations <em>between</em> genes and clinical parameters on each dimension of sPLS2. This plot should be interpreted in relation to Figure <a href="#fig:04-spls2-sample-plot">4.7</a> to better understand how the expression levels of these molecules may characterise specific sample groups.
</p>
</div>

<p>To display variable names that are different from the original data matrix (e.g. gene ID), we set the argument <code>var.names</code> as a list for each type of label, with geneBank ID for the <span class="math inline">\(\boldsymbol X\)</span> data set, and <code>TRUE</code> for the <span class="math inline">\(\boldsymbol Y\)</span> data set:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(spls2.liver,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.names =</span> <span class="fu">list</span>(<span class="at">X.label =</span> liver.toxicity<span class="sc">$</span>gene.ID[,<span class="st">&#39;geneBank&#39;</span>],</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">Y.label =</span> <span class="cn">TRUE</span>), <span class="at">cex =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-variable-plot2"></span>
<img src="Figures/PLS/04-spls2-variable-plot2-1.png" alt="Correlation circle plot from the sPLS2 performed on the liver.toxicity data. A variant of Figure 4.9 with gene names that are available in $gene.ID (Note: some gene names are missing)." width="70%"  />
<p class="caption">
Figure 4.10: <strong>Correlation circle plot from the sPLS2 performed on the <code>liver.toxicity</code> data</strong>. A variant of Figure <a href="#fig:04-spls2-variable-plot">4.9</a> with gene names that are available in <code>$gene.ID</code> (Note: some gene names are missing).
</p>
</div>

<p>The correlation circle plots highlight the contributing variables that, together, explain the covariance between the two data sets. In addition, specific subsets of molecules can be further investigated, and in relation with the sample group they may characterise. The latter can be examined with additional plots (for example boxplots with respect to known sample groups and expression levels of specific variables, as we showed in the PCA case study previously. The next step would be to examine the validity of the biological relationship between the clusters of genes with some of the clinical variables that we observe in this plot.</p>
<p>A 3D plot is also available in <code>plotVar()</code> with the argument <code>style = '3d</code>. It requires an sPLS2 model with at least three dimensions.</p>
<p>Other plots are available to complement the information from the correlation circle plots, such as Relevance networks and Clustered Image Maps (CIMs), as described in Module 2.</p>
<p>The network in sPLS2 displays only the variables selected by sPLS, with an additional <code>cutoff</code> similarity value argument (absolute value between 0 and 1) to improve interpretation. Because Rstudio sometimes struggles with the margin size of this plot, we can either launch <code>X11()</code> prior to plotting the network, or use the arguments <code>save</code> and <code>name.save</code> as shown below:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define red and green colours for the edges</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>color.edge <span class="ot">&lt;-</span> <span class="fu">color.GreenRed</span>(<span class="dv">50</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># X11()  # To open a new window for Rstudio</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">network</span>(spls2.liver, <span class="at">comp =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">cutoff =</span> <span class="fl">0.7</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">shape.node =</span> <span class="fu">c</span>(<span class="st">&quot;rectangle&quot;</span>, <span class="st">&quot;circle&quot;</span>),</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">color.node =</span> <span class="fu">c</span>(<span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;pink&quot;</span>),</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">color.edge =</span> color.edge,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># To save the plot, unotherwise:</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># save = &#39;pdf&#39;, name.save = &#39;network_liver&#39;</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-network"></span>
<img src="Figures/PLS/04-spls2-network-1.png" alt="Network representation from the sPLS2 performed on the liver.toxicity data. The networks are bipartite, where each edge links a gene (rectangle) to a clinical variable (circle) node, according to a similarity matrix described in Module 2. Only variables selected by sPLS2 on the two dimensions are represented and are further filtered here according to a cutoff argument (optional)." width="70%"  />
<p class="caption">
Figure 4.11: <strong>Network representation from the sPLS2 performed on the <code>liver.toxicity</code> data</strong>. The networks are bipartite, where each edge links a <span style="color: black;">gene</span> (rectangle) to a <span style="color: #CC79A7;">clinical</span> variable (circle) node, according to a similarity matrix described in Module 2. Only variables selected by sPLS2 on the two dimensions are represented and are further filtered here according to a <code>cutoff</code> argument (optional).
</p>
</div>

<p>Figure <a href="#fig:04-spls2-network">4.11</a> shows two distinct groups of variables. The first cluster groups four clinical parameters that are mostly positively associated with selected genes. The second group includes one clinical parameter negatively associated with other selected genes. These observations are similar to what was observed in the correlation circle plot in Figure <a href="#fig:04-spls2-variable-plot">4.9</a>.</p>
<p>Note:</p>
<ul>
<li><em>Whilst the edges and nodes in the network do not change, the appearance might be different from one run to another as it relies on a random process to use the space as best as possible (using the <code>igraph</code> R package <span class="citation">Csardi, Nepusz, et al. (<a href="#ref-csa06" role="doc-biblioref">2006</a>)</span>).</em></li>
</ul>
<p>The Clustered Image Map also allows us to visualise correlations between variables. Here we choose to represent the variables selected on the two dimensions and we save the plot as a pdf figure.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># X11()  # To open a new window if the graphic is too large</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cim</span>(spls2.liver, <span class="at">comp =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">&quot;clinic&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;genes&quot;</span>,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To save the plot, uncomment:</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save = &#39;pdf&#39;, name.save = &#39;cim_liver&#39;</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-cim"></span>
<img src="Figures/PLS/04-spls2-cim-1.png" alt="Clustered Image Map from the sPLS2 performed on the liver.toxicity data. The plot displays the similarity values (as described in Module 2) between the \(\boldsymbol X\) and \(\boldsymbol Y\) variables selected across two dimensions, and clustered with a complete Euclidean distance method." width="70%"  />
<p class="caption">
Figure 4.12: <strong>Clustered Image Map from the sPLS2 performed on the <code>liver.toxicity</code> data</strong>. The plot displays the similarity values (as described in Module 2) between the <span class="math inline">\(\boldsymbol X\)</span> and <span class="math inline">\(\boldsymbol Y\)</span> variables selected across two dimensions, and clustered with a complete Euclidean distance method.
</p>
</div>

<p>The CIM in Figure <a href="#fig:04-spls2-cim">4.12</a> shows that the clinical variables can be separated into three clusters, each of them either positively or negatively associated with two groups of genes. This is similar to what we have observed in Figure <a href="#fig:04-spls2-variable-plot">4.9</a>. We would give a similar interpretation to the relevance network, had we also used a <code>cutoff</code> threshold in <code>cim()</code>.</p>
<p>Note:</p>
<ul>
<li><em>A biplot for PLS objects is also available.</em></li>
</ul>
</div>
<div id="id_04:spls2-perf" class="section level4" number="4.3.3.4">
<h4><span class="header-section-number">4.3.3.4</span> Performance</h4>
<p>To finish, we assess the performance of sPLS2. As an element of comparison, we consider sPLS2 and PLS2 that includes all variables, to give insights into the different methods.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparisons of final models (PLS, sPLS)</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="do">## PLS</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>pls.liver <span class="ot">&lt;-</span> <span class="fu">pls</span>(X, Y, <span class="at">mode =</span> <span class="st">&#39;regression&#39;</span>, <span class="at">ncomp =</span> <span class="dv">2</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>perf.pls.liver <span class="ot">&lt;-</span>  <span class="fu">perf</span>(pls.liver, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, <span class="at">folds =</span> <span class="dv">10</span>, </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrepeat =</span> <span class="dv">5</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Performance for the sPLS model ran earlier</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>perf.spls.liver <span class="ot">&lt;-</span>  <span class="fu">perf</span>(spls2.liver, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, <span class="at">folds =</span> <span class="dv">10</span>, </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">nrepeat =</span> <span class="dv">5</span>)</span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), perf.pls.liver<span class="sc">$</span>measures<span class="sc">$</span>cor.upred<span class="sc">$</span>summary<span class="sc">$</span>mean, </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">pch =</span> <span class="dv">16</span>, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.6</span>,<span class="dv">1</span>), <span class="at">xaxt =</span> <span class="st">&#39;n&#39;</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;Component&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;t or u Cor&#39;</span>, </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&#39;s/PLS performance based on Correlation&#39;</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)  <span class="co"># X-axis label</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(perf.pls.liver<span class="sc">$</span>measures<span class="sc">$</span>cor.tpred<span class="sc">$</span>summary<span class="sc">$</span>mean, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(perf.spls.liver<span class="sc">$</span>measures<span class="sc">$</span>cor.upred<span class="sc">$</span>summary<span class="sc">$</span>mean, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">pch =</span> <span class="dv">17</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(perf.spls.liver<span class="sc">$</span>measures<span class="sc">$</span>cor.tpred<span class="sc">$</span>summary<span class="sc">$</span>mean, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">pch =</span> <span class="dv">17</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomleft&#39;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;blue&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;red&#39;</span>), </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">17</span>), <span class="fu">c</span>(<span class="st">&#39;u PLS&#39;</span>, <span class="st">&#39;t PLS&#39;</span>, <span class="st">&#39;u sPLS&#39;</span>, <span class="st">&#39;t sPLS&#39;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:04-spls2-perf2"></span>
<img src="Figures/PLS/04-spls2-perf2-1.png" alt="Comparison of the performance of PLS2 and sPLS2, based on the correlation between the actual and predicted components \(\boldsymbol{t,u}\) associated to each data set for each component." width="70%"  />
<p class="caption">
Figure 4.13: <strong>Comparison of the performance of PLS2 and sPLS2</strong>, based on the correlation between the actual and predicted components <span class="math inline">\(\boldsymbol{t,u}\)</span> associated to each data set for each component.
</p>
</div>

<p>We extract the correlation between the actual and predicted components <span class="math inline">\(\boldsymbol{t,u}\)</span> associated to each data set in Figure <a href="#fig:04-spls2-perf2">4.13</a>. The correlation remains high on the first dimension, even when variables are selected. On the second dimension the correlation coefficients are equivalent or slightly lower in sPLS compared to PLS. Overall this performance comparison indicates that the variable selection in sPLS still retains relevant information compared to a model that includes all variables.</p>
<p>Note:</p>
<ul>
<li><em>Had we run a similar procedure but based on the RSS, we would have observed a lower RSS for sPLS compared to PLS.</em></li>
</ul>

</div>
</div>
</div>
</div>
<div id="id_05" class="section level1" number="5">
<h1><span class="header-section-number"> 5</span> PLS-DA on the SRBCT case study</h1>
<p>The Small Round Blue Cell Tumours (SRBCT) data set from <span class="citation">(<a href="#ref-Kha01" role="doc-biblioref">Khan et al. 2001</a>)</span> includes the expression levels of 2,308 genes measured on 63 samples. The samples are divided into four classes: 8 Burkitt Lymphoma (BL), 23 Ewing Sarcoma (EWS), 12 neuroblastoma (NB), and 20 rhabdomyosarcoma (RMS). The data are directly available in a processed and normalised format from the <code>mixOmics</code> package and contains the following:</p>
<ul>
<li><p><code>$gene</code>: A data frame with 63 rows and 2,308 columns. These are the expression levels of 2,308 genes in 63 subjects,</p></li>
<li><p><code>$class</code>: A vector containing the class of tumour for each individual (4 classes in total),</p></li>
<li><p><code>$gene.name</code>: A data frame with 2,308 rows and 2 columns containing further information on the genes.</p></li>
</ul>
<p>More details can be found in <code>?srbct</code>. We will illustrate PLS-DA and sPLS-DA which are suited for large biological data sets where the aim is to identify molecular signatures, as well as classify samples. We will analyse the gene expression levels of <code>srbct$gene</code> to discover which genes may best discriminate the 4 groups of tumours.</p>
<div id="id_05:load-data" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Load the data</h2>
<p>We first load the data from the package. We then set up the data so that <span class="math inline">\(\boldsymbol X\)</span> is the gene expression matrix and <span class="math inline">\(\boldsymbol y\)</span> is the factor indicating sample class membership. <span class="math inline">\(\boldsymbol y\)</span> will be transformed into a dummy matrix <span class="math inline">\(\boldsymbol Y\)</span> inside the function. We also check that the dimensions are correct and match both <span class="math inline">\(\boldsymbol X\)</span> and <span class="math inline">\(\boldsymbol y\)</span>:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(srbct)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> srbct<span class="sc">$</span>gene</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome y that will be internally coded as dummy:</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> srbct<span class="sc">$</span>class </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X); <span class="fu">length</span>(Y)</span></code></pre></div>
<pre><code>## [1]   63 2308
## [1] 63</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Y)</span></code></pre></div>
<pre><code>## EWS  BL  NB RMS 
##  23   8  12  20</code></pre>
</div>
<div id="id_05:plsda" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Example: PLS-DA</h2>
<div id="id_05:plsda-pca" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Initial exploration with PCA</h3>
<p>As covered in Module 3, PCA is a useful tool to explore the gene expression data and to assess for sample similarities between tumour types. Remember that PCA is an unsupervised approach, but we can colour the samples by their class to assist in interpreting the PCA (Figure <a href="#fig:05-plsda-pca">5.1</a>). Here we center (default argument) and scale the data:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>pca.srbct <span class="ot">&lt;-</span> <span class="fu">pca</span>(X, <span class="at">ncomp =</span> <span class="dv">3</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(pca.srbct, <span class="at">group =</span> srbct<span class="sc">$</span>class, <span class="at">ind.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="cn">TRUE</span>, </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;SRBCT, PCA comp 1 - 2&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-plsda-pca"></span>
<img src="Figures/PLSDA/05-plsda-pca-1.png" alt="Preliminary (unsupervised) analysis with PCA on the SRBCT gene expression data. Samples are projected into the space spanned by the principal components 1 and 2. The tumour types are not clustered, meaning that the major source of variation cannot be explained by tumour types. Instead, samples seem to cluster according to an unknown source of variation." width="70%"  />
<p class="caption">
Figure 5.1: <strong>Preliminary (unsupervised) analysis with PCA on the <code>SRBCT</code> gene expression data</strong>. Samples are projected into the space spanned by the principal components 1 and 2. The tumour types are not clustered, meaning that the major source of variation cannot be explained by tumour types. Instead, samples seem to cluster according to an unknown source of variation.
</p>
</div>

<p>We observe almost no separation between the different tumour types in the PCA sample plot, with perhaps the exception of the <span style="color: #585858;">NB</span> samples that tend to cluster with other samples. This preliminary exploration teaches us two important findings:</p>
<ul>
<li>The major source of variation is not attributable to tumour type, but an unknown source (we tend to observe clusters of samples but those are not explained by tumour type).</li>
<li>We need a more ‘directed’ (supervised) analysis to separate the tumour types, and we should expect that the amount of variance explained by the dimensions in PLS-DA analysis will be small.</li>
</ul>
</div>
<div id="id_05:plsda-ncomp" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Number of components in PLS-DA</h3>
<p>The <code>perf()</code> function evaluates the performance of PLS-DA - i.e., its ability to rightly classify ‘new’ samples into their tumour category using repeated cross-validation. We initially choose a large number of components (here <code>ncomp = 10</code>) and assess the model as we gradually increase the number of components. Here we use 3-fold CV repeated 10 times. In Module 2, we provided further guidelines on how to choose the <code>folds</code> and <code>nrepeat</code> parameters:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>plsda.srbct <span class="ot">&lt;-</span> <span class="fu">plsda</span>(X,Y, <span class="at">ncomp =</span> <span class="dv">10</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">30</span>) <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>perf.plsda.srbct <span class="ot">&lt;-</span> <span class="fu">perf</span>(plsda.srbct, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, <span class="at">folds =</span> <span class="dv">3</span>, </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">progressBar =</span> <span class="cn">FALSE</span>,  <span class="co"># Set to TRUE to track progress</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nrepeat =</span> <span class="dv">10</span>)         <span class="co"># We suggest nrepeat = 50</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf.plsda.srbct, <span class="at">sd =</span> <span class="cn">TRUE</span>, <span class="at">legend.position =</span> <span class="st">&#39;horizontal&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plsda-ncomp"></span>
<img src="Figures/PLSDA/plsda-ncomp-1.png" alt="Tuning the number of components in PLS-DA on the SRBCT gene expression data. For each component, repeated cross-validation (10 \(\times 3-\)fold CV) is used to evaluate the PLS-DA classification performance (overall and balanced error rate BER), for each type of prediction distance; max.dist, centroids.dist and mahalanobis.dist. Bars show the standard deviation across the repeated folds. The plot shows that the error rate reaches a minimum from 3 components." width="70%"  />
<p class="caption">
Figure 5.2: <strong>Tuning the number of components in PLS-DA on the <code>SRBCT</code> gene expression data.</strong> For each component, repeated cross-validation (10 <span class="math inline">\(\times 3-\)</span>fold CV) is used to evaluate the PLS-DA classification performance (overall and balanced error rate BER), for each type of prediction distance; <code>max.dist</code>, <code>centroids.dist</code> and <code>mahalanobis.dist</code>. Bars show the standard deviation across the repeated folds. The plot shows that the error rate reaches a minimum from 3 components.
</p>
</div>

<p>From the classification performance output presented in Figure <a href="#fig:plsda-ncomp">5.2</a>, we observe that:</p>
<ul>
<li><p>There are some slight differences between the overall and balanced error rates (BER) with BER &gt; overall, suggesting that minority classes might be ignored from the classification task when considering the overall performance (<code>summary(Y)</code> shows that BL only includes 8 samples). In general the trend is the same, however, and for further tuning with sPLS-DA we will consider the BER.</p></li>
<li><p>The error rate decreases and reaches a minimum for <code>ncomp = 3</code> for the <code>max.dist</code> distance. These parameters will be included in further analyses.</p></li>
</ul>
<p>Notes:</p>
<ul>
<li><em>PLS-DA is an iterative model, where each component is orthogonal to the previous and gradually aims to build more discrimination between sample classes. We should always regard a final PLS-DA (with specified <code>ncomp</code>) as a ‘compounding’ model (i.e. PLS-DA with component 3 includes the trained model on the previous two components).</em></li>
<li><em>We advise to use at least 50 repeats, and choose the number of folds that are appropriate for the sample size of the data set, as shown in Figure <a href="#fig:plsda-ncomp">5.2</a>).</em></li>
</ul>
<p>Additional numerical outputs from the performance results are listed and can be reported as performance measures (not output here):</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>perf.plsda.srbct</span></code></pre></div>
</div>
<div id="id_05:plsda-final" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Final PLS-DA model</h3>
<p>We now run our final PLS-DA model that includes three components:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>final.plsda.srbct <span class="ot">&lt;-</span> <span class="fu">plsda</span>(X,Y, <span class="at">ncomp =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>We output the sample plots for the dimensions of interest (up to three). By default, the samples are coloured according to their class membership. We also add confidence ellipses (<code>ellipse = TRUE</code>, confidence level set to 95% by default, see the argument <code>ellipse.level</code>) in Figure <a href="#fig:05-plsda-sample-plots">5.3</a>. A 3D plot could also be insightful (use the argument <code>type = '3D'</code>).</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.plsda.srbct, <span class="at">ind.names =</span> <span class="cn">FALSE</span>, <span class="at">legend=</span><span class="cn">TRUE</span>,</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">comp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">ellipse =</span> <span class="cn">TRUE</span>, </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;PLS-DA on SRBCT comp 1-2&#39;</span>,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">X.label =</span> <span class="st">&#39;PLS-DA comp 1&#39;</span>, <span class="at">Y.label =</span> <span class="st">&#39;PLS-DA comp 2&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.plsda.srbct, <span class="at">ind.names =</span> <span class="cn">FALSE</span>, <span class="at">legend=</span><span class="cn">TRUE</span>,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">comp=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">ellipse =</span> <span class="cn">TRUE</span>, </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;PLS-DA on SRBCT comp 2-3&#39;</span>,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">X.label =</span> <span class="st">&#39;PLS-DA comp 2&#39;</span>, <span class="at">Y.label =</span> <span class="st">&#39;PLS-DA comp 3&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-plsda-sample-plots"></span>
<img src="Figures/PLSDA/05-plsda-sample-plot-nc12-1.png" alt="Sample plots from PLS-DA performed on the SRBCT gene expression data. Samples are projected into the space spanned by the first three components. (a) Components 1 and 2 and (b) Components 1 and 3. Samples are coloured by their tumour subtypes. Component 1 discriminates RMS + EWS vs. NB + BL, component 2 discriminates RMS + NB vs. EWS + BL, while component 3 discriminates further the NB and BL groups. It is the combination of all three components that enables us to discriminate all classes." width="50%"  /><img src="Figures/PLSDA/05-plsda-sample-plot-nc13-1.png" alt="Sample plots from PLS-DA performed on the SRBCT gene expression data. Samples are projected into the space spanned by the first three components. (a) Components 1 and 2 and (b) Components 1 and 3. Samples are coloured by their tumour subtypes. Component 1 discriminates RMS + EWS vs. NB + BL, component 2 discriminates RMS + NB vs. EWS + BL, while component 3 discriminates further the NB and BL groups. It is the combination of all three components that enables us to discriminate all classes." width="50%"  />
<p class="caption">
Figure 5.3: <strong>Sample plots from PLS-DA performed on the <code>SRBCT</code> gene expression data</strong>. Samples are projected into the space spanned by the first three components. (a) Components 1 and 2 and (b) Components 1 and 3. Samples are coloured by their tumour subtypes. Component 1 discriminates <span style="color: #009E73;">RMS</span> + <span style="color: #388ECC;">EWS</span> vs. <span style="color: #585858;">NB</span> + <span style="color: #F68B33;">BL</span>, component 2 discriminates <span style="color: #009E73;">RMS</span> + <span style="color: #585858;">NB</span> vs. <span style="color: #388ECC;">EWS</span> + <span style="color: #F68B33;">BL</span>, while component 3 discriminates further the <span style="color: #585858;">NB</span> and <span style="color: #F68B33;">BL</span> groups. It is the combination of all three components that enables us to discriminate all classes.
</p>
</div>

<p>We can observe improved clustering according to tumour subtypes, compared with PCA. This is to be expected since the PLS-DA model includes the class information of each sample. We observe some discrimination between the <span style="color: #585858;">NB</span> and <span style="color: #F68B33;">BL</span> samples vs. the others on the first component (x-axis), and <span style="color: #388ECC;">EWS</span> and <span style="color: #009E73;">RMS</span> vs. the others on the second component (y-axis). From the <code>plotIndiv()</code> function, the axis labels indicate the amount of variation explained per component. However, the interpretation of this amount is <em>not as important</em> as in PCA, as PLS-DA aims to maximise the covariance between components associated to <span class="math inline">\(\boldsymbol X\)</span> and <span class="math inline">\(\boldsymbol Y\)</span>, rather than the variance <span class="math inline">\(\boldsymbol X\)</span>.</p>
</div>
<div id="id_05:plsda-perf" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Classification performance</h3>
<p>We can rerun a more extensive performance evaluation with more repeats for our final model:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">30</span>) <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>perf.final.plsda.srbct <span class="ot">&lt;-</span> <span class="fu">perf</span>(final.plsda.srbct, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">folds =</span> <span class="dv">3</span>, </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">progressBar =</span> <span class="cn">FALSE</span>, <span class="co"># TRUE to track progress</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nrepeat =</span> <span class="dv">10</span>) <span class="co"># we recommend 50 </span></span></code></pre></div>
<p>Retaining only the BER and the <code>max.dist</code>, numerical outputs of interest include the final overall performance for 3 components:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>perf.final.plsda.srbct<span class="sc">$</span>error.rate<span class="sc">$</span>BER[, <span class="st">&#39;max.dist&#39;</span>]</span></code></pre></div>
<pre><code>##      comp1      comp2      comp3 
## 0.53850543 0.25986413 0.04481884</code></pre>
<p>As well as the error rate per class across each component:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>perf.final.plsda.srbct<span class="sc">$</span>error.rate.class<span class="sc">$</span>max.dist</span></code></pre></div>
<pre><code>##         comp1      comp2      comp3
## EWS 0.2565217 0.08695652 0.08260870
## BL  0.8125000 0.51250000 0.00000000
## NB  0.3000000 0.37500000 0.04166667
## RMS 0.7850000 0.06500000 0.05500000</code></pre>
<p>From this output, we can see that the first component tends to classify EWS and NB better than the other classes. As components 2 and then 3 are added, the classification improves for all classes. However we see a slight increase in classification error in component 3 for EWS and RMS while BL is perfectly classified. A permutation test could also be conducted to conclude about the significance of the differences between sample groups, but is not currently implemented in the package.</p>
</div>
<div id="id_05:plsda-bgp" class="section level3" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Background prediction</h3>
<p>A prediction background can be added to the sample plot by calculating a background surface first, before overlaying the sample plot (Figure <a href="#fig:05-plsda-bgp">5.4</a>, see Extra Reading material, or <code>?background.predict</code>). We give an example of the code below based on the maximum prediction distance:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>background.max <span class="ot">&lt;-</span> <span class="fu">background.predict</span>(final.plsda.srbct, </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">comp.predicted =</span> <span class="dv">2</span>,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">dist =</span> <span class="st">&#39;max.dist&#39;</span>) </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.plsda.srbct, <span class="at">comp =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">group =</span> srbct<span class="sc">$</span>class,</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">ind.names =</span> <span class="cn">FALSE</span>, <span class="at">title =</span> <span class="st">&#39;Maximum distance&#39;</span>,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="cn">TRUE</span>,  <span class="at">background =</span> background.max)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-plsda-bgp"></span>
<img src="Figures/PLSDA/05-plsda-bgp-max-1.png" alt="Sample plots from PLS-DA on the SRBCT gene expression data and prediction areas based on prediction distances. From our usual sample plot, we overlay a background prediction area based on permutations from the first two PLS-DA components using the three different types of prediction distances. The outputs show how the prediction distance can influence the quality of the prediction, with samples projected into a wrong class area, and hence resulting in predicted misclassification. (Currently, the prediction area background can only be calculated for the first two components)." width="30%"  /><img src="Figures/PLSDA/05-plsda-bgp-cent-1.png" alt="Sample plots from PLS-DA on the SRBCT gene expression data and prediction areas based on prediction distances. From our usual sample plot, we overlay a background prediction area based on permutations from the first two PLS-DA components using the three different types of prediction distances. The outputs show how the prediction distance can influence the quality of the prediction, with samples projected into a wrong class area, and hence resulting in predicted misclassification. (Currently, the prediction area background can only be calculated for the first two components)." width="30%"  /><img src="Figures/PLSDA/05-plsda-bgp-mah-1.png" alt="Sample plots from PLS-DA on the SRBCT gene expression data and prediction areas based on prediction distances. From our usual sample plot, we overlay a background prediction area based on permutations from the first two PLS-DA components using the three different types of prediction distances. The outputs show how the prediction distance can influence the quality of the prediction, with samples projected into a wrong class area, and hence resulting in predicted misclassification. (Currently, the prediction area background can only be calculated for the first two components)." width="30%"  />
<p class="caption">
Figure 5.4: <strong>Sample plots from PLS-DA on the <code>SRBCT</code> gene expression data and prediction areas based on prediction distances</strong>. From our usual sample plot, we overlay a background prediction area based on permutations from the first two PLS-DA components using the three different types of prediction distances. The outputs show how the prediction distance can influence the quality of the prediction, with samples projected into a wrong class area, and hence resulting in predicted misclassification. (Currently, the prediction area background can only be calculated for the first two components).
</p>
</div>

<p>Figure <a href="#fig:05-plsda-bgp">5.4</a> shows the differences in prediction according to the prediction distance, and can be used as a further diagnostic tool for distance choice. It also highlights the characteristics of the distances. For example the <code>max.dist</code> is a linear distance, whereas both <code>centroids.dist</code> and <code>mahalanobis.dist</code> are non linear. Our experience has shown that as discrimination of the classes becomes more challenging, the complexity of the distances (from maximum to Mahalanobis distance) should increase, see details in the Extra reading material.</p>
</div>
</div>
<div id="id_05:splsda" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Example: sPLS-DA</h2>
<p>In high-throughput experiments, we expect that many of the 2308 genes in <span class="math inline">\(\boldsymbol X\)</span> are noisy or uninformative to characterise the different classes. An sPLS-DA analysis will help refine the sample clusters and select a small subset of variables relevant to discriminate each class.</p>
<div id="id_05:splsda-keepX" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Number of variables to select</h3>
<p>We estimate the classification error rate with respect to the number of selected variables in the model with the function <code>tune.splsda()</code>. The tuning is being performed one component at a time inside the function and the optimal number of variables to select is automatically retrieved after each component run, as described in Module 2.</p>
<p>Previously, we determined the number of components to be <code>ncomp = 3</code> with PLS-DA. Here we set <code>ncomp = 4</code> to further assess if this would be the case for a sparse model, and use 5-fold cross validation repeated 10 times. We also choose the maximum prediction distance.</p>
<p>Note:</p>
<ul>
<li><em>For a thorough tuning step, the following code should be repeated 10 - 50 times and the error rate is averaged across the runs. You may obtain slightly different results below for this reason.</em></li>
</ul>
<p>We first define a grid of <code>keepX</code> values. For example here, we define a fine grid at the start, and then specify a coarser, larger sequence of values:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid of possible keepX values that will be tested for each comp</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>list.keepX <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,  <span class="fu">seq</span>(<span class="dv">20</span>, <span class="dv">100</span>, <span class="dv">10</span>))</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>list.keepX</span></code></pre></div>
<pre><code>##  [1]   1   2   3   4   5   6   7   8   9  10  20  30  40  50  60  70  80  90 100</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This chunk takes ~ 2 min to run</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Some convergence issues may arise but it is ok as this is run on CV folds</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>tune.splsda.srbct <span class="ot">&lt;-</span> <span class="fu">tune.splsda</span>(X, Y, <span class="at">ncomp =</span> <span class="dv">4</span>, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">folds =</span> <span class="dv">5</span>, <span class="at">dist =</span> <span class="st">&#39;max.dist&#39;</span>, </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">test.keepX =</span> list.keepX, <span class="at">nrepeat =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>The following command line will output the mean error rate for each component and each tested <code>keepX</code> value given the past (tuned) components.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just a head of the classification error rate per keepX (in rows) and comp</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tune.splsda.srbct<span class="sc">$</span>error.rate)</span></code></pre></div>
<pre><code>##       comp1     comp2      comp3       comp4
## 1 0.5942844 0.3252355 0.07589674 0.010923913
## 2 0.5638859 0.3071830 0.05585145 0.007798913
## 3 0.5491938 0.2985507 0.04576087 0.006711957
## 4 0.5360054 0.2920743 0.03071558 0.006711957
## 5 0.5211685 0.2855707 0.02821558 0.006711957
## 6 0.5150362 0.2819837 0.02254529 0.005461957</code></pre>
<p>When we examine each individual row, this output globally shows that the classification error rate continues to decrease after the third component in sparse PLS-DA.</p>
<p>We display the mean classification error rate on each component, bearing in mind that each component is conditional on the previous components calculated with the optimal number of selected variables. The diamond in Figure <a href="#fig:05-splsda-tuning-plot">5.5</a> indicates the best <code>keepX</code> value to achieve the lowest error rate per component.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To show the error bars across the repeats:</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tune.splsda.srbct, <span class="at">sd =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-splsda-tuning-plot"></span>
<img src="Figures/PLSDA/05-splsda-tuning-plot-1.png" alt="Tuning keepX for the sPLS-DA performed on the SRBCT gene expression data. Each coloured line represents the balanced error rate (y-axis) per component across all tested keepX values (x-axis) with the standard deviation based on the repeated cross-validation folds. The diamond indicates the optimal keepX value on a particular component which achieves the lowest classification error rate as determined with a one-sided \(t-\)test. As sPLS-DA is an iterative algorithm, values represented for a given component (e.g. comp 1 to 2) include the optimal keepX value chosen for the previous component (comp 1)." width="70%"  />
<p class="caption">
Figure 5.5: <strong>Tuning <code>keepX</code> for the sPLS-DA performed on the <code>SRBCT</code> gene expression data.</strong> Each coloured line represents the balanced error rate (y-axis) per component across all tested <code>keepX</code> values (x-axis) with the standard deviation based on the repeated cross-validation folds. The diamond indicates the optimal <code>keepX</code> value on a particular component which achieves the lowest classification error rate as determined with a one-sided <span class="math inline">\(t-\)</span>test. As sPLS-DA is an iterative algorithm, values represented for a given component (e.g. <span style="color: #F68B33;">comp 1 to 2</span>) include the optimal <code>keepX</code> value chosen for the previous component (<span style="color: #388ECC;">comp 1</span>).
</p>
</div>

<p>The tuning results depend on the tuning grid <code>list.keepX</code>, as well as the values chosen for <code>folds</code> and <code>nrepeat</code>. Therefore, we recommend assessing the performance of the <em>final</em> model, as well as examining the stability of the selected variables across the different folds, as detailed in the next section.</p>
<p>Figure <a href="#fig:05-splsda-tuning-plot">5.5</a> shows that the error rate decreases when more components are included in sPLS-DA. To obtain a more reliable estimation of the error rate, the number of repeats should be increased (between 50 to 100). This type of graph helps not only to choose the ‘optimal’ number of variables to select, but also to confirm the number of components <code>ncomp</code>. From the code below, we can assess that in fact, the addition of a fourth component does not improve the classification (no statistically significant improvement according to a one-sided <span class="math inline">\(t-\)</span>test), hence we can choose <code>ncomp = 3</code>.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The optimal number of components according to our one-sided t-tests</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>tune.splsda.srbct<span class="sc">$</span>choice.ncomp<span class="sc">$</span>ncomp</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The optimal keepX parameter according to minimal error rate</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>tune.splsda.srbct<span class="sc">$</span>choice.keepX</span></code></pre></div>
<pre><code>## comp1 comp2 comp3 comp4 
##     6    30    40     6</code></pre>
</div>
<div id="final-splsda-perf" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Final model and performance</h3>
<p>Here is our final sPLS-DA model with three components and the optimal <code>keepX</code> obtained from our tuning step.</p>
<p>You can choose to skip the tuning step, and input your arbitrarily chosen parameters in the following code (simply specify your own <code>ncomp</code> and <code>keepX</code> values):</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal number of components based on t-tests on the error rate</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>ncomp <span class="ot">&lt;-</span> tune.splsda.srbct<span class="sc">$</span>choice.ncomp<span class="sc">$</span>ncomp </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>ncomp</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal number of variables to select</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>select.keepX <span class="ot">&lt;-</span> tune.splsda.srbct<span class="sc">$</span>choice.keepX[<span class="dv">1</span><span class="sc">:</span>ncomp]  </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>select.keepX</span></code></pre></div>
<pre><code>## comp1 comp2 comp3 
##     6    30    40</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>splsda.srbct <span class="ot">&lt;-</span> <span class="fu">splsda</span>(X, Y, <span class="at">ncomp =</span> ncomp, <span class="at">keepX =</span> select.keepX) </span></code></pre></div>
<p>The performance of the model with the <code>ncomp</code> and <code>keepX</code> parameters is assessed with the <code>perf()</code> function. We use 5-fold validation (<code>folds = 5</code>), repeated 10 times (<code>nrepeat = 10</code>) for illustrative purposes, but we recommend increasing to <code>nrepeat = 50</code>. Here we choose the <code>max.dist</code> prediction distance, based on our results obtained with PLS-DA.</p>
<p>The classification error rates that are output include both the overall error rate, as well as the balanced error rate (BER) when the number of samples per group is not balanced - as is the case in this study.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34</span>)  <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>perf.splsda.srbct <span class="ot">&lt;-</span> <span class="fu">perf</span>(splsda.srbct, <span class="at">folds =</span> <span class="dv">5</span>, <span class="at">validation =</span> <span class="st">&quot;Mfold&quot;</span>, </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dist =</span> <span class="st">&quot;max.dist&quot;</span>, <span class="at">progressBar =</span> <span class="cn">FALSE</span>, <span class="at">nrepeat =</span> <span class="dv">10</span>)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co"># perf.splsda.srbct  # Lists the different outputs</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>perf.splsda.srbct<span class="sc">$</span>error.rate</span></code></pre></div>
<pre><code>## $overall
##         max.dist
## comp1 0.44444444
## comp2 0.20317460
## comp3 0.01269841
## 
## $BER
##         max.dist
## comp1 0.53068841
## comp2 0.27567029
## comp3 0.01138587</code></pre>
<p>We can also examine the error rate per class:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>perf.splsda.srbct<span class="sc">$</span>error.rate.class</span></code></pre></div>
<pre><code>## $max.dist
##          comp1       comp2      comp3
## EWS 0.02608696 0.004347826 0.01304348
## BL  0.60000000 0.450000000 0.01250000
## NB  0.91666667 0.483333333 0.00000000
## RMS 0.58000000 0.165000000 0.02000000</code></pre>
<p>These results can be compared with the performance of PLS-DA and show the benefits of variable selection to not only obtain a parsimonious model, but also to improve the classification error rate (overall and per class).</p>
</div>
<div id="id_05:stab" class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Variable selection and stability</h3>
<p>During the repeated cross-validation process in <code>perf()</code> we can record how often the same variables are selected across the folds. This information is important to answer the question: <em>How reproducible is my gene signature when the training set is perturbed via cross-validation?</em>.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For component 1</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>stable.comp1 <span class="ot">&lt;-</span> perf.splsda.srbct<span class="sc">$</span>features<span class="sc">$</span>stable<span class="sc">$</span>comp1</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(stable.comp1, <span class="at">xlab =</span> <span class="st">&#39;variables selected across CV folds&#39;</span>, </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&#39;Stability frequency&#39;</span>,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&#39;Feature stability for comp = 1&#39;</span>)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co"># For component 2</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>stable.comp2 <span class="ot">&lt;-</span> perf.splsda.srbct<span class="sc">$</span>features<span class="sc">$</span>stable<span class="sc">$</span>comp2</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(stable.comp2, <span class="at">xlab =</span> <span class="st">&#39;variables selected across CV folds&#39;</span>, </span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&#39;Stability frequency&#39;</span>,</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&#39;Feature stability for comp = 2&#39;</span>)</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-splsda-stab"></span>
<img src="Figures/PLSDA/05-splsda-stab-1.png" alt="Stability of variable selection from the sPLS-DA on the SRBCT gene expression data. We use a by-product from perf() to assess how often the same variables are selected for a given keepX value in the final sPLS-DA model. The barplot represents the frequency of selection across repeated CV folds for each selected gene for component 1 and 2. The genes are ranked according to decreasing frequency." width="70%"  />
<p class="caption">
Figure 5.6: <strong>Stability of variable selection from the sPLS-DA on the SRBCT gene expression data.</strong> We use a by-product from <code>perf()</code> to assess how often the same variables are selected for a given <code>keepX</code> value in the final sPLS-DA model. The barplot represents the frequency of selection across repeated CV folds for each selected gene for component 1 and 2. The genes are ranked according to decreasing frequency.
</p>
</div>

<p>Figure <a href="#fig:05-splsda-stab">5.6</a> shows that the genes selected on component 1 are moderately stable (frequency &lt; 0.5) whereas those selected on component 2 are more stable (frequency &lt; 0.7). This can be explained as there are various combinations of genes that are discriminative on component 1, whereas the number of combinations decreases as we move to component 2 which attempts to refine the classification.</p>
<p>The function <code>selectVar()</code> outputs the variables selected for a given component and their loading values (ranked in decreasing absolute value). We concatenate those results with the feature stability, as shown here for variables selected on component 1:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First extract the name of selected var:</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>select.name <span class="ot">&lt;-</span> <span class="fu">selectVar</span>(splsda.srbct, <span class="at">comp =</span> <span class="dv">1</span>)<span class="sc">$</span>name</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then extract the stability values from perf:</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>stability <span class="ot">&lt;-</span> perf.splsda.srbct<span class="sc">$</span>features<span class="sc">$</span>stable<span class="sc">$</span>comp1[select.name]</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Just the head of the stability of the selected var:</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cbind</span>(<span class="fu">selectVar</span>(splsda.srbct, <span class="at">comp =</span> <span class="dv">1</span>)<span class="sc">$</span>value, stability))</span></code></pre></div>
<pre><code>##        value.var  Var1 Freq
## g123  0.82019919  g123 0.46
## g846  0.48384321  g846 0.46
## g335  0.18883438  g335 0.22
## g1606 0.17786558 g1606 0.24
## g836  0.14246204  g836 0.36
## g783  0.07469278  g783 0.20</code></pre>
<p>As we hinted previously, the genes selected on the first component are not necessarily the most stable, suggesting that different combinations can lead to the same discriminative ability of the model. The stability increases in the following components, as the classification task becomes more refined.</p>
<p>Note:</p>
<ul>
<li><em>You can also apply the <code>vip()</code> function on <code>splsda.srbct</code>.</em></li>
</ul>
</div>
<div id="sample-visualisation" class="section level3" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> Sample visualisation</h3>
<p>Previously, we showed the ellipse plots displayed for each class. Here we also use the star argument (<code>star = TRUE</code>), which displays arrows starting from each group centroid towards each individual sample (Figure <a href="#fig:05-splsda-sample-plots">5.7</a>).</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(splsda.srbct, <span class="at">comp =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">ind.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">ellipse =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">star =</span> <span class="cn">TRUE</span>,</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;SRBCT, sPLS-DA comp 1 - 2&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(splsda.srbct, <span class="at">comp =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">ind.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">ellipse =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">star =</span> <span class="cn">TRUE</span>,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;SRBCT, sPLS-DA comp 2 - 3&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-splsda-sample-plots"></span>
<img src="Figures/PLSDA/05-splsda-sample-plot-nc12-1.png" alt="Sample plots from the sPLS-DA performed on the SRBCT gene expression data. Samples are projected into the space spanned by the first three components. The plots represent 95% ellipse confidence intervals around each sample class. The start of each arrow represents the centroid of each class in the space spanned by the components. (a) Components 1 and 2 and (b) Components 2 and 3. Samples are coloured by their tumour subtype. Component 1 discriminates BL vs. the rest, component 2 discriminates EWS vs. the rest, while component 3 further discriminates NB vs. RMS vs. the rest. The combination of all three components enables us to discriminate all classes." width="50%"  /><img src="Figures/PLSDA/05-splsda-sample-plot-nc23-1.png" alt="Sample plots from the sPLS-DA performed on the SRBCT gene expression data. Samples are projected into the space spanned by the first three components. The plots represent 95% ellipse confidence intervals around each sample class. The start of each arrow represents the centroid of each class in the space spanned by the components. (a) Components 1 and 2 and (b) Components 2 and 3. Samples are coloured by their tumour subtype. Component 1 discriminates BL vs. the rest, component 2 discriminates EWS vs. the rest, while component 3 further discriminates NB vs. RMS vs. the rest. The combination of all three components enables us to discriminate all classes." width="50%"  />
<p class="caption">
Figure 5.7: <strong>Sample plots from the sPLS-DA performed on the <code>SRBCT</code> gene expression data</strong>. Samples are projected into the space spanned by the first three components. The plots represent 95% ellipse confidence intervals around each sample class. The start of each arrow represents the centroid of each class in the space spanned by the components. (a) Components 1 and 2 and (b) Components 2 and 3. Samples are coloured by their tumour subtype. Component 1 discriminates <span style="color: #F68B33;">BL</span> vs. the rest, component 2 discriminates <span style="color: #388ECC;">EWS</span> vs. the rest, while component 3 further discriminates <span style="color: #585858;">NB</span> vs. <span style="color: #009E73;">RMS</span> vs. the rest. The combination of all three components enables us to discriminate all classes.
</p>
</div>

<p>The sample plots are different from PLS-DA (Figure <a href="#fig:05-plsda-sample-plots">5.3</a>) with an overlap of specific classes (i.e. <span style="color: #585858;">NB</span> + <span style="color: #009E73;">RMS</span> on component 1 and 2), that are then further separated on component 3, thus showing how the genes selected on each component discriminate particular sets of sample groups.</p>
</div>
<div id="id_05:varplot" class="section level3" number="5.3.5">
<h3><span class="header-section-number">5.3.5</span> Variable visualisation</h3>
<p>We represent the genes selected with sPLS-DA on the correlation circle plot. Here to increase interpretation, we specify the argument <code>var.names</code> as the first 10 characters of the gene names (Figure <a href="#fig:05-splsda-variable-plot">5.8</a>). We also reduce the size of the font with the argument <code>cex</code>.</p>
<p>Note:</p>
<ul>
<li><em>We can store the <code>plotvar()</code> as an object to output the coordinates and variable names if the plot is too cluttered.</em></li>
</ul>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>var.name.short <span class="ot">&lt;-</span> <span class="fu">substr</span>(srbct<span class="sc">$</span>gene.name[, <span class="dv">2</span>], <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(splsda.srbct, <span class="at">comp =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.names =</span> <span class="fu">list</span>(var.name.short), <span class="at">cex =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-splsda-variable-plot"></span>
<img src="Figures/PLSDA/05-splsda-variable-plot-1.png" alt="Correlation circle plot representing the genes selected by sPLS-DA performed on the SRBCT gene expression data. Gene names are truncated to the first 10 characters. Only the genes selected by sPLS-DA are shown in components 1 and 2. We observe three groups of genes (positively associated with component 1, and positively or negatively associated with component 2). This graphic should be interpreted in conjunction with the sample plot." width="70%"  />
<p class="caption">
Figure 5.8: <strong>Correlation circle plot representing the genes selected by sPLS-DA performed on the <code>SRBCT</code> gene expression data</strong>. Gene names are truncated to the first 10 characters. Only the genes selected by sPLS-DA are shown in components 1 and 2. We observe three groups of genes (positively associated with component 1, and positively or negatively associated with component 2). This graphic should be interpreted in conjunction with the sample plot.
</p>
</div>

<p>By considering both the correlation circle plot (Figure <a href="#fig:05-splsda-variable-plot">5.8</a>) and the sample plot in Figure <a href="#fig:05-splsda-sample-plots">5.7</a>, we observe that a group of genes with a positive correlation with component 1 (‘EH domain’, ‘proteasome’ etc.) are associated with the <span style="color: #F68B33;">BL</span> samples. We also observe two groups of genes either positively or negatively correlated with component 2. These genes are likely to characterise either the <span style="color: #585858;">NB</span> + <span style="color: #009E73;">RMS</span> classes, or the <span style="color: #388ECC;">EWS</span> class. This interpretation can be further examined with the <code>plotLoadings()</code> function.</p>
<p>In this plot, the loading weights of each selected variable on each component are represented (see Module 2). The colours indicate the group in which the expression of the selected gene is maximal based on the mean (<code>method = 'median'</code> is also available for skewed data). For example on component 1:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLoadings</span>(splsda.srbct, <span class="at">comp =</span> <span class="dv">1</span>, <span class="at">method =</span> <span class="st">&#39;mean&#39;</span>, <span class="at">contrib =</span> <span class="st">&#39;max&#39;</span>, </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">name.var =</span> var.name.short)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-splsda-loading-plot"></span>
<img src="Figures/PLSDA/05-splsda-loading-plot-1.png" alt="Loading plot of the genes selected by sPLS-DA on component 1 on the SRBCT gene expression data. Genes are ranked according to their loading weight (most important at the bottom to least important at the top), represented as a barplot. Colours indicate the class for which a particular gene is maximally expressed, on average, in this particular class. The plot helps to further characterise the gene signature and should be interpreted jointly with the sample plot (Figure 5.7)." width="70%"  />
<p class="caption">
Figure 5.9: <strong>Loading plot of the genes selected by sPLS-DA on component 1 on the <code>SRBCT</code> gene expression data</strong>. Genes are ranked according to their loading weight (most important at the bottom to least important at the top), represented as a barplot. Colours indicate the class for which a particular gene is maximally expressed, on average, in this particular class. The plot helps to further characterise the gene signature and should be interpreted jointly with the sample plot (Figure <a href="#fig:05-splsda-sample-plots">5.7</a>).
</p>
</div>

<p>Here all genes are associated with <span style="color: #F68B33;">BL</span> (on average, their expression levels are higher in this class than in the other classes).</p>
<p>Notes:</p>
<ul>
<li><em>Consider using the argument <code>ndisplay</code> to only display the top selected genes if the signature is too large.</em></li>
<li><em>Consider using the argument <code>contrib = 'min'</code> to interpret the inverse trend of the signature (i.e. which genes have the smallest expression in which class, here a mix of <span style="color: #585858;">NB</span> and <span style="color: #009E73;">RMS</span> samples).</em></li>
</ul>
<p>To complete the visualisation, the CIM in this special case is a simple hierarchical heatmap (see <code>?cim</code>) representing the expression levels of the genes selected across all three components with respect to each sample. Here we use an Euclidean distance with Complete agglomeration method, and we specify the argument <code>row.sideColors</code> to colour the samples according to their tumour type (Figure <a href="#fig:05-splsda-cim">5.10</a>).</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cim</span>(splsda.srbct, <span class="at">row.sideColors =</span> <span class="fu">color.mixo</span>(Y))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-splsda-cim"></span>
<img src="Figures/PLSDA/05-splsda-cim-1.png" alt="Clustered Image Map of the genes selected by sPLS-DA on the SRBCT gene expression data across all 3 components. A hierarchical clustering based on the gene expression levels of the selected genes, with samples in rows coloured according to their tumour subtype (using Euclidean distance with Complete agglomeration method). As expected, we observe a separation of all different tumour types, which are characterised by different levels of expression." width="70%"  />
<p class="caption">
Figure 5.10: <strong>Clustered Image Map of the genes selected by sPLS-DA on the <code>SRBCT</code> gene expression data across all 3 components</strong>. A hierarchical clustering based on the gene expression levels of the selected genes, with samples in rows coloured according to their tumour subtype (using Euclidean distance with Complete agglomeration method). As expected, we observe a separation of all different tumour types, which are characterised by different levels of expression.
</p>
</div>

<p>The heatmap shows the level of expression of the genes selected by sPLS-DA across all three components, and the overall ability of the gene signature to discriminate the tumour subtypes.</p>
<p>Note:</p>
<ul>
<li><em>You can change the argument <code>comp</code> if you wish to visualise a specific set of components in <code>cim()</code>.</em></li>
</ul>
</div>
</div>
<div id="id_05:splsda-predict" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Take a detour: prediction</h2>
<p>In this section, we artificially create an ‘external’ test set on which we want to predict the class membership to illustrate the prediction process in sPLS-DA (see Extra Reading material). We randomly select 50 samples from the <code>srbct</code> study as part of the training set, and the remainder as part of the test set:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">33</span>) <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(X), <span class="dv">50</span>)    <span class="co"># Randomly select 50 samples in training</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(X), train) <span class="co"># Rest is part of the test set</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Store matrices into training and test set:</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>X.train <span class="ot">&lt;-</span> X[train, ]</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>X.test <span class="ot">&lt;-</span> X[test,]</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>Y.train <span class="ot">&lt;-</span> Y[train]</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>Y.test <span class="ot">&lt;-</span> Y[test]</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check dimensions are OK:</span></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X.train); <span class="fu">dim</span>(X.test)</span></code></pre></div>
<pre><code>## [1]   50 2308
## [1]   13 2308</code></pre>
<p>Here we assume that the tuning step was performed on the training set <em>only</em> (it is <em>really important</em> to tune only on the training step to avoid overfitting), and that the optimal <code>keepX</code> values are, for example, <code>keepX = c(20,30,40)</code> on three components. The final model on the training data is:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>train.splsda.srbct <span class="ot">&lt;-</span> <span class="fu">splsda</span>(X.train, Y.train, <span class="at">ncomp =</span> <span class="dv">3</span>, <span class="at">keepX =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>))</span></code></pre></div>
<p>We now apply the trained model on the test set <code>X.test</code> and we specify the prediction distance, for example <code>mahalanobis.dist</code> (see also <code>?predict.splsda</code>):</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>predict.splsda.srbct <span class="ot">&lt;-</span> <span class="fu">predict</span>(train.splsda.srbct, X.test, </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">dist =</span> <span class="st">&quot;mahalanobis.dist&quot;</span>)</span></code></pre></div>
<p>The <code>$class</code> output of our object <code>predict.splsda.srbct</code> gives the predicted classes of the test samples.</p>
<p>First we concatenate the prediction for each of the three components (conditionally on the previous component) and the real class - in a real application case you may not know the true class.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just the head:</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(predict.splsda.srbct<span class="sc">$</span>class, <span class="at">Truth =</span> Y.test))</span></code></pre></div>
<pre><code>##         mahalanobis.dist.comp1 mahalanobis.dist.comp2 mahalanobis.dist.comp3 Truth
## EWS.T7                     EWS                    EWS                    EWS   EWS
## EWS.T15                    EWS                    EWS                    EWS   EWS
## EWS.C8                     EWS                    EWS                    EWS   EWS
## EWS.C10                    EWS                    EWS                    EWS   EWS
## BL.C8                       BL                     BL                     BL    BL
## NB.C6                       NB                     NB                     NB    NB</code></pre>
<p>If we only look at the final prediction on component 2, compared to the real class:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare prediction on the second component and change as factor</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>predict.comp2 <span class="ot">&lt;-</span> predict.splsda.srbct<span class="sc">$</span>class<span class="sc">$</span>mahalanobis.dist[,<span class="dv">2</span>]</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">factor</span>(predict.comp2, <span class="at">levels =</span> <span class="fu">levels</span>(Y)), Y.test)</span></code></pre></div>
<pre><code>##      Y.test
##       EWS BL NB RMS
##   EWS   4  0  0   0
##   BL    0  1  0   0
##   NB    0  0  1   1
##   RMS   0  0  0   6</code></pre>
<p>And on the third compnent:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare prediction on the third component and change as factor</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>predict.comp3 <span class="ot">&lt;-</span> predict.splsda.srbct<span class="sc">$</span>class<span class="sc">$</span>mahalanobis.dist[,<span class="dv">3</span>]</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">factor</span>(predict.comp3, <span class="at">levels =</span> <span class="fu">levels</span>(Y)), Y.test)</span></code></pre></div>
<pre><code>##      Y.test
##       EWS BL NB RMS
##   EWS   4  0  0   0
##   BL    0  1  0   0
##   NB    0  0  1   0
##   RMS   0  0  0   7</code></pre>
<p>The prediction is better on the third component, compared to a 2-component model.</p>
<p>Next, we look at the output <code>$predict</code>, which gives the predicted dummy scores assigned for each test sample and each class level for a given component (as explained in Extra Reading material). Each column represents a class category:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On component 3, just the head:</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict.splsda.srbct<span class="sc">$</span>predict[, , <span class="dv">3</span>])</span></code></pre></div>
<pre><code>##                EWS          BL          NB          RMS
## EWS.T7  1.26848551 -0.05273773 -0.24070902  0.024961232
## EWS.T15 1.15058424 -0.02222145 -0.11877994 -0.009582845
## EWS.C8  1.25628411  0.05481026 -0.16500118 -0.146093198
## EWS.C10 0.83995956  0.10871106  0.16452934 -0.113199949
## BL.C8   0.02431262  0.90877176  0.01775304  0.049162580
## NB.C6   0.06738230  0.05086884  0.86247360  0.019275265</code></pre>
<p>In PLS-DA and sPLS-DA, the final prediction call is given based on this matrix on which a pre-specified distance (such as <code>mahalanobis.dist</code> here) is applied. From this output, we can understand the link between the dummy matrix <span class="math inline">\(\boldsymbol Y\)</span>, the prediction, and the importance of choosing the prediction distance. More details are provided in Extra Reading material.</p>
</div>
<div id="id_05:splsda-auroc" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> AUROC outputs complement performance evaluation</h2>
<p>As PLS-DA acts as a classifier, we can plot the AUC (Area Under The Curve) ROC (Receiver Operating Characteristics) to complement the sPLS-DA classification performance results. The AUC is calculated from training cross-validation sets and averaged. The ROC curve is displayed in Figure <a href="#fig:05-splsda-auroc">5.11</a>. In a multiclass setting, each curve represents one class vs. the others and the AUC is indicated in the legend, and also in the numerical output:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>auc.srbct <span class="ot">&lt;-</span> <span class="fu">auroc</span>(splsda.srbct)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:05-splsda-auroc"></span>
<img src="Figures/PLSDA/05-splsda-auroc-1.png" alt="ROC curve and AUC from sPLS-DA on the SRBCT gene expression data on component 1 averaged across one-vs.-all comparisons. Numerical outputs include the AUC and a Wilcoxon test p-value for each ‘one vs. other’ class comparisons that are performed per component. This output complements the sPLS-DA performance evaluation but should not be used for tuning (as the prediction process in sPLS-DA is based on prediction distances, not a cutoff that maximises specificity and sensitivity as in ROC). The plot suggests that the sPLS-DA model can distinguish BL subjects from the other groups with a high true positive and low false positive rate, while the model is less well able to distinguish samples from other classes on component 1." width="70%"  />
<p class="caption">
Figure 5.11: <strong>ROC curve and AUC from sPLS-DA on the <code>SRBCT</code> gene expression data on component 1</strong> averaged across one-vs.-all comparisons. Numerical outputs include the AUC and a Wilcoxon test p-value for each ‘one vs. other’ class comparisons that are performed per component. This output complements the sPLS-DA performance evaluation but <em>should not be used for tuning</em> (as the prediction process in sPLS-DA is based on prediction distances, not a cutoff that maximises specificity and sensitivity as in ROC). The plot suggests that the sPLS-DA model can distinguish <span style="color: #CC0000;">BL</span> subjects from the other groups with a high true positive and low false positive rate, while the model is less well able to distinguish samples from other classes on component 1.
</p>
</div>
<pre><code>## $Comp1
##                    AUC   p-value
## EWS vs Other(s) 0.4163 2.717e-01
## BL vs Other(s)  1.0000 5.586e-06
## NB vs Other(s)  0.8448 2.214e-04
## RMS vs Other(s) 0.6000 2.041e-01
## 
## $Comp2
##                    AUC   p-value
## EWS vs Other(s) 1.0000 5.135e-11
## BL vs Other(s)  1.0000 5.586e-06
## NB vs Other(s)  0.9020 1.663e-05
## RMS vs Other(s) 0.7895 2.363e-04
## 
## $Comp3
##                 AUC   p-value
## EWS vs Other(s)   1 5.135e-11
## BL vs Other(s)    1 5.586e-06
## NB vs Other(s)    1 8.505e-08
## RMS vs Other(s)   1 2.164e-10</code></pre>

<p>The ideal ROC curve should be along the top left corner, indicating a high true positive rate (sensitivity on the y-axis) and a high true negative rate (or low 100 - specificity on the x-axis), with an AUC close to 1. This is the case for <span style="color: #CC0000;">BL</span> vs. the others on component 1. The numerical output shows a perfect classification on component 3.</p>
<p><em>Note:</em></p>
<ul>
<li><em>A word of caution when using the ROC and AUC in s/PLS-DA: these criteria may not be particularly insightful, or may not be in full agreement with the s/PLS-DA performance, as the prediction threshold in PLS-DA is based on a specified distance as we described earlier in this section and in Extra Reading material related to PLS-DA. Thus, such a result complements the sPLS-DA performance we have calculated earlier.</em></li>
</ul>

</div>
</div>
<div id="id_06" class="section level1" number="6">
<h1><span class="header-section-number"> 6</span> N-Integration</h1>
<p>N-Integration is the framework of having multiple datasets which measure different aspects of the same samples. For example, you may have transcriptomic, genetic and proteomic data for the same set of cells. N-integrative methods are built to use the information in all three of these dataframes simultaenously.</p>
<p>DIABLO is a novel <code>mixOmics</code> framework for the integration of multiple data sets while explaining their relationship with a categorical outcome variable. DIABLO stands for <strong>D</strong>ata <strong>I</strong>ntegration <strong>A</strong>nalysis for <strong>B</strong>iomarker discovery using <strong>L</strong>atent variable approaches for <strong>O</strong>mics studies. It can also be referred to as Multiblock (s)PLS-DA.</p>
<div id="id_06:diablo" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Block sPLS-DA on the TCGA case study</h2>
<p>Human breast cancer is a heterogeneous disease in terms of molecular alterations, cellular composition, and clinical outcome. Breast tumours can be classified into several subtypes, according to their levels of mRNA expression <span class="citation">(<a href="#ref-Sor01" role="doc-biblioref">Sørlie et al. 2001</a>)</span>. Here we consider a subset of data generated by The Cancer Genome Atlas Network <span class="citation">(<a href="#ref-TCGA12" role="doc-biblioref">Cancer Genome Atlas Network et al. 2012</a>)</span>. For the package, data were normalised, and then drastically prefiltered for illustrative purposes.</p>
<p>The data were divided into a <em>training set</em> with a subset of 150 samples from the mRNA, miRNA and proteomics data, and a <em>test set</em> including 70 samples, but only with mRNA and miRNA data (the proteomics data are missing). The aim of this integrative analysis is to identify a highly correlated multi-omics signature discriminating the breast cancer subtypes Basal, Her2 and LumA.</p>
<p>The <code>breast.TCGA</code> (more details can be found in <code>?breast.TCGA</code>) is a list containing training and test sets of omics data <code>data.train</code> and <code>data.test</code> which include:</p>
<ul>
<li><code>$miRNA</code>: A data frame with 150 (70) rows and 184 columns in the training (test) data set for the miRNA expression levels,</li>
<li><code>$mRNA</code>: A data frame with 150 (70) rows and 520 columns in the training (test) data set for the mRNA expression levels,</li>
<li><code>$protein</code>: A data frame with 150 rows and 142 columns in the training data set for the protein abundance (there are no proteomics in the test set),</li>
<li><code>$subtype</code>: A factor indicating the breast cancer subtypes in the training (for 150 samples) and test sets (for 70 samples).</li>
</ul>
<p>This case study covers an interesting scenario where one omic data set is missing in the test set, but because the method generates a set of components per training data set, we can still assess the prediction or performance evaluation using majority or weighted prediction vote.</p>
</div>
<div id="id_06:diablo-load-data" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Load the data</h2>
<p>To illustrate the multiblock sPLS-DA approach, we will integrate the expression levels of miRNA, mRNA and the abundance of proteins while discriminating the subtypes of breast cancer, then predict the subtypes of the samples in the test set.</p>
<p>The input data is first set up as a list of <span class="math inline">\(Q\)</span> matrices <span class="math inline">\(\boldsymbol X_1, \dots, \boldsymbol X_Q\)</span> and a factor indicating the class membership of each sample <span class="math inline">\(\boldsymbol Y\)</span>. Each data frame in <span class="math inline">\(\boldsymbol X\)</span> <em>should be named</em> as we will match these names with the <code>keepX</code> parameter for the sparse method.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(breast.TCGA)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract training data and name each data frame</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Store as list</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mRNA =</span> breast.TCGA<span class="sc">$</span>data.train<span class="sc">$</span>mrna, </span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">miRNA =</span> breast.TCGA<span class="sc">$</span>data.train<span class="sc">$</span>mirna, </span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">protein =</span> breast.TCGA<span class="sc">$</span>data.train<span class="sc">$</span>protein)</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> breast.TCGA<span class="sc">$</span>data.train<span class="sc">$</span>subtype</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Y)</span></code></pre></div>
<pre><code>## Basal  Her2  LumA 
##    45    30    75</code></pre>
</div>
<div id="id_06:diablo-params" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Parameter choice</h2>
<div id="id_06:diablo-design" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Design matrix</h3>
<p>The choice of the design can be motivated by different aspects, including:</p>
<ul>
<li><p>Biological apriori knowledge: Should we expect <code>mRNA</code> and <code>miRNA</code> to be highly correlated?</p></li>
<li><p>Analytical aims: As further developed in <span class="citation">Singh et al. (<a href="#ref-Sin19" role="doc-biblioref">2019</a>)</span>, a compromise needs to be achieved between a classification and prediction task, and extracting the correlation structure of the data sets. A full design with weights = 1 will favour the latter, but at the expense of classification accuracy, whereas a design with small weights will lead to a highly predictive signature. This pertains to the complexity of the analytical task involved as several constraints are included in the optimisation procedure. For example, here we choose a 0.1 weighted model as we are interested in predicting test samples later in this case study.</p></li>
</ul>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fl">0.1</span>, <span class="at">ncol =</span> <span class="fu">length</span>(X), <span class="at">nrow =</span> <span class="fu">length</span>(X), </span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">names</span>(X), <span class="fu">names</span>(X)))</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(design) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>design </span></code></pre></div>
<pre><code>##         mRNA miRNA protein
## mRNA     0.0   0.1     0.1
## miRNA    0.1   0.0     0.1
## protein  0.1   0.1     0.0</code></pre>
<p>Note however that even with this design, we will still unravel a correlated signature as we require all data sets to explain the same outcome <span class="math inline">\(\boldsymbol y\)</span>, as well as maximising pairs of covariances between data sets.</p>
<ul>
<li>Data-driven option: we could perform regression analyses with PLS to further understand the correlation between data sets. Here for example, we run PLS with one component and calculate the cross-correlations between components associated to each data set:</li>
</ul>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>res1.pls.tcga <span class="ot">&lt;-</span> <span class="fu">pls</span>(X<span class="sc">$</span>mRNA, X<span class="sc">$</span>protein, <span class="at">ncomp =</span> <span class="dv">1</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(res1.pls.tcga<span class="sc">$</span>variates<span class="sc">$</span>X, res1.pls.tcga<span class="sc">$</span>variates<span class="sc">$</span>Y)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>res2.pls.tcga <span class="ot">&lt;-</span> <span class="fu">pls</span>(X<span class="sc">$</span>mRNA, X<span class="sc">$</span>miRNA, <span class="at">ncomp =</span> <span class="dv">1</span>)</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(res2.pls.tcga<span class="sc">$</span>variates<span class="sc">$</span>X, res2.pls.tcga<span class="sc">$</span>variates<span class="sc">$</span>Y)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>res3.pls.tcga <span class="ot">&lt;-</span> <span class="fu">pls</span>(X<span class="sc">$</span>protein, X<span class="sc">$</span>miRNA, <span class="at">ncomp =</span> <span class="dv">1</span>)</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(res3.pls.tcga<span class="sc">$</span>variates<span class="sc">$</span>X, res3.pls.tcga<span class="sc">$</span>variates<span class="sc">$</span>Y)</span></code></pre></div>
<pre><code>##           comp1
## comp1 0.9031761
##           comp1
## comp1 0.8456299
##           comp1
## comp1 0.7982008</code></pre>
<p>The data sets taken in a pairwise manner are highly correlated, indicating that a design with weights <span class="math inline">\(\sim 0.8 - 0.9\)</span> could be chosen.</p>
</div>
<div id="id_06:diablo-ncomp" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Number of components</h3>
<p>As in the PLS-DA framework presented in Module 3, we first fit a <code>block.plsda</code> model without variable selection to assess the global performance of the model and choose the number of components. We run <code>perf()</code> with 10-fold cross validation repeated 10 times for up to 5 components and with our specified design matrix. Similar to PLS-DA, we obtain the performance of the model with respect to the different prediction distances (Figure <a href="#fig:06-ncomp">6.1</a>):</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>diablo.tcga <span class="ot">&lt;-</span> <span class="fu">block.plsda</span>(X, Y, <span class="at">ncomp =</span> <span class="dv">5</span>, <span class="at">design =</span> design)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># For reproducibility, remove for your analyses</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>perf.diablo.tcga <span class="ot">=</span> <span class="fu">perf</span>(diablo.tcga, <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, <span class="at">folds =</span> <span class="dv">10</span>, <span class="at">nrepeat =</span> <span class="dv">10</span>)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co">#perf.diablo.tcga$error.rate  # Lists the different types of error rates</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot of the error rates based on weighted vote</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf.diablo.tcga)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-ncomp"></span>
<img src="Figures/DIABLO/06-ncomp-1.png" alt="Choosing the number of components in block.plsda using perf() with 10 x 10-fold CV function in the breast.TCGA study. Classification error rates (overall and balanced, see Module 2) are represented on the y-axis with respect to the number of components on the x-axis for each prediction distance presented in PLS-DA in Seciton 3.4 and detailed in Extra reading material 3 from Module 3. Bars show the standard deviation across the 10 repeated folds. The plot shows that the error rate reaches a minimum from 2 to 3 dimensions." width="70%"  />
<p class="caption">
Figure 6.1: <strong>Choosing the number of components in <code>block.plsda</code> using <code>perf()</code> with 10 x 10-fold CV function in the <code>breast.TCGA</code> study</strong>. Classification error rates (overall and balanced, see Module 2) are represented on the y-axis with respect to the number of components on the x-axis for each prediction distance presented in PLS-DA in Seciton 3.4 and detailed in Extra reading material 3 from Module 3. Bars show the standard deviation across the 10 repeated folds. The plot shows that the error rate reaches a minimum from 2 to 3 dimensions.
</p>
</div>

<p>The performance plot indicates that two components should be sufficient in the final model, and that the centroids distance might lead to better prediction. A balanced error rate (BER) should be considered for further analysis.</p>
<p>The following outputs the optimal number of components according to the prediction distance and type of error rate (overall or balanced), as well as a prediction weighting scheme illustrated further below.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>perf.diablo.tcga<span class="sc">$</span>choice.ncomp<span class="sc">$</span>WeightedVote</span></code></pre></div>
<pre><code>##             max.dist centroids.dist mahalanobis.dist
## Overall.ER         3              2                3
## Overall.BER        3              2                3</code></pre>
<p>Thus, here we choose our final <code>ncomp</code> value:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>ncomp <span class="ot">&lt;-</span> perf.diablo.tcga<span class="sc">$</span>choice.ncomp<span class="sc">$</span>WeightedVote[<span class="st">&quot;Overall.BER&quot;</span>, <span class="st">&quot;centroids.dist&quot;</span>]</span></code></pre></div>
</div>
<div id="id_06:diablo-tuning" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Number of variables to select</h3>
<p>We then choose the optimal number of variables to select in each data set using the <code>tune.block.splsda</code> function. The function <code>tune()</code> is run with 10-fold cross validation, but repeated only once (<code>nrepeat = 1</code>) for illustrative and computational reasons here. For a thorough tuning process, we advise increasing the <code>nrepeat</code> argument to 10-50, or more.</p>
<p>We choose a <code>keepX</code> grid that is relatively fine at the start, then coarse. If the data sets are easy to classify, the tuning step may indicate the smallest number of variables to separate the sample groups. Hence, we start our grid at the value <code>5</code> to avoid a too small signature that may preclude biological interpretation.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk takes about 2 min to run</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># for reproducibility</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>test.keepX <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mRNA =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>, <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">5</span>)),</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">miRNA =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>, <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">2</span>)),</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">proteomics =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">25</span>, <span class="dv">5</span>)))</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>tune.diablo.tcga <span class="ot">&lt;-</span> <span class="fu">tune.block.splsda</span>(X, Y, <span class="at">ncomp =</span> <span class="dv">2</span>, </span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">test.keepX =</span> test.keepX, <span class="at">design =</span> design,</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, <span class="at">folds =</span> <span class="dv">10</span>, <span class="at">nrepeat =</span> <span class="dv">1</span>, </span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">BPPARAM =</span> BiocParallel<span class="sc">::</span><span class="fu">SnowParam</span>(<span class="at">workers =</span> <span class="dv">2</span>),</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">dist =</span> <span class="st">&quot;centroids.dist&quot;</span>)</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>list.keepX <span class="ot">&lt;-</span> tune.diablo.tcga<span class="sc">$</span>choice.keepX</span></code></pre></div>
<p>Note:</p>
<ul>
<li><em>For fast computation, we can use parallel computing here - this option is also enabled on a laptop or workstation, see <code>?tune.block.splsda</code>.</em></li>
</ul>
<p>The number of features to select on each component is returned and stored for the final model:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>list.keepX</span></code></pre></div>
<pre><code>## $mRNA
## [1]  8 25
## 
## $miRNA
## [1] 14  5
## 
## $protein
## [1] 10  5</code></pre>
<p>Note:</p>
<ul>
<li><em>You can skip any of the tuning steps above, and hard code your chosen <code>ncomp</code> and <code>keepX</code> parameters (as a list for the latter, as shown below).</em></li>
</ul>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>list.keepX <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">mRNA =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">25</span>), <span class="at">miRNA =</span> <span class="fu">c</span>(<span class="dv">14</span>,<span class="dv">5</span>), <span class="at">protein =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span></code></pre></div>
</div>
</div>
<div id="id_06:diablo-final" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Final model</h2>
<p>The final multiblock sPLS-DA model includes the tuned parameters and is run as:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>diablo.tcga <span class="ot">&lt;-</span> <span class="fu">block.splsda</span>(X, Y, <span class="at">ncomp =</span> ncomp, </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">keepX =</span> list.keepX, <span class="at">design =</span> design)</span></code></pre></div>
<pre><code>## Design matrix has changed to include Y; each block will be
##             linked to Y.</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">#06.tcga   # Lists the different functions of interest related to that object</span></span></code></pre></div>
<p>A warning message informs us that the outcome <span class="math inline">\(\boldsymbol Y\)</span> has been included automatically in the design, so that the covariance between each block’s component and the outcome is maximised, as shown in the final design output:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>diablo.tcga<span class="sc">$</span>design</span></code></pre></div>
<pre><code>##         mRNA miRNA protein Y
## mRNA     0.0   0.1     0.1 1
## miRNA    0.1   0.0     0.1 1
## protein  0.1   0.1     0.0 1
## Y        1.0   1.0     1.0 0</code></pre>
<p>The selected variables can be extracted with the function <code>selectVar()</code>, for example in the mRNA block, along with their loading weights (not output here):</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mRNA variables selected on component 1</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">selectVar</span>(diablo.tcga, <span class="at">block =</span> <span class="st">&#39;mRNA&#39;</span>, <span class="at">comp =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><em>Note:</em></p>
<ul>
<li><em>The stability of the selected variables can be extracted from the <code>perf()</code> function, similar to the example given in the PLS-DA analysis (Module 3).</em></li>
</ul>
</div>
<div id="id_06:diablo-sample-plots" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Sample plots</h2>
<div id="plotdiablo" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> <code>plotDiablo</code></h3>
<p><code>plotDiablo()</code> is a diagnostic plot to check whether the correlations between components from each data set were maximised as specified in the design matrix. We specify the dimension to be assessed with the <code>ncomp</code> argument (Figure <a href="#fig:06-diablo-plot">6.2</a>).</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDiablo</span>(diablo.tcga, <span class="at">ncomp =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-diablo-plot"></span>
<img src="Figures/DIABLO/06-diablo-plot-1.png" alt="Diagnostic plot from multiblock sPLS-DA applied on the breast.TCGA study. Samples are represented based on the specified component (here ncomp = 1) for each data set (mRNA, miRNA and protein). Samples are coloured by breast cancer subtype (Basal, Her2 and LumA) and 95% confidence ellipse plots are represented. The bottom left numbers indicate the correlation coefficients between the first components from each data set. In this example, mRNA expression and protein concentration are highly correlated on the first dimension." width="70%"  />
<p class="caption">
Figure 6.2: <strong>Diagnostic plot from multiblock sPLS-DA applied on the <code>breast.TCGA</code> study.</strong> Samples are represented based on the specified component (here <code>ncomp = 1</code>) for each data set (mRNA, miRNA and protein). Samples are coloured by breast cancer subtype (<span style="color: #388ECC;">Basal</span>, <span style="color: #F68B33;">Her2</span> and <span style="color: #585858;">LumA</span>) and 95% confidence ellipse plots are represented. The bottom left numbers indicate the correlation coefficients between the first components from each data set. In this example, mRNA expression and protein concentration are highly correlated on the first dimension.
</p>
</div>

<p>The plot indicates that the first components from all data sets are highly correlated. The colours and ellipses represent the sample subtypes and indicate the discriminative power of each component to separate the different tumour subtypes. Thus, multiblock sPLS-DA is able to extract a strong correlation structure between data sets, as well as discriminate the breast cancer subtypes on the first component.</p>
</div>
<div id="plotindiv" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> <code>plotIndiv</code></h3>
<p>The sample plot with the <code>plotIndiv()</code> function projects each sample into the space spanned by the components from <em>each</em> block, resulting in a series of graphs corresponding to each data set (Figure <a href="#fig:06-sample-plot">6.3</a>). The optional argument <code>blocks</code> can output a specific data set. Ellipse plots are also available (argument <code>ellipse = TRUE</code>).</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(diablo.tcga, <span class="at">ind.names =</span> <span class="cn">FALSE</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>, </span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;TCGA, DIABLO comp 1 - 2&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-sample-plot"></span>
<img src="Figures/DIABLO/06-sample-plot-1.png" alt="Sample plot from multiblock sPLS-DA performed on the breast.TCGA study. The samples are plotted according to their scores on the first 2 components for each data set. Samples are coloured by cancer subtype and are classified into three classes: Basal, Her2 and LumA. The plot shows the degree of agreement between the different data sets and the discriminative ability of each data set." width="70%"  />
<p class="caption">
Figure 6.3: <strong>Sample plot from multiblock sPLS-DA performed on the <code>breast.TCGA</code> study.</strong> The samples are plotted according to their scores on the first 2 components for each data set. Samples are coloured by cancer subtype and are classified into three classes: <span style="color: #388ECC;">Basal</span>, <span style="color: #F68B33;">Her2</span> and <span style="color: #585858;">LumA</span>. The plot shows the degree of agreement between the different data sets and the discriminative ability of each data set.
</p>
</div>

<p>This type of graphic allows us to better understand the information extracted from each data set and its discriminative ability. Here we can see that the <span style="color: #585858;">LumA</span> group can be difficult to classify in the miRNA data.</p>
<p>Note:</p>
<ul>
<li><em>Additional variants include the argument <code>block = 'average'</code> that averages the components from all blocks to produce a single plot. The argument <code>block='weighted.average'</code> is a weighted average of the components according to their correlation with the components associated with the outcome</em>.</li>
</ul>
</div>
<div id="plotarrow" class="section level3" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> <code>plotArrow</code></h3>
<p>In the arrow plot in Figure <a href="#fig:06-arrow-plot">6.4</a>, the start of the arrow indicates the centroid between all data sets for a given sample and the tip of the arrow the location of that same sample but in each block. Such graphics highlight the agreement between all data sets at the sample level when modelled with multiblock sPLS-DA.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotArrow</span>(diablo.tcga, <span class="at">ind.names =</span> <span class="cn">FALSE</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>, </span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;TCGA, DIABLO comp 1 - 2&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-arrow-plot"></span>
<img src="Figures/DIABLO/06-arrow-plot-1.png" alt="Arrow plot from multiblock sPLS-DA performed on the breast.TCGA study. The samples are projected into the space spanned by the first two components for each data set then overlaid across data sets. The start of the arrow indicates the centroid between all data sets for a given sample and the tip of the arrow the location of the same sample in each block. Arrows further from their centroid indicate some disagreement between the data sets. Samples are coloured by cancer subtype (Basal, Her2 and LumA)." width="70%"  />
<p class="caption">
Figure 6.4: <strong>Arrow plot from multiblock sPLS-DA performed on the <code>breast.TCGA</code> study.</strong> The samples are projected into the space spanned by the first two components for each data set then overlaid across data sets. The start of the arrow indicates the centroid between all data sets for a given sample and the tip of the arrow the location of the same sample in each block. Arrows further from their centroid indicate some disagreement between the data sets. Samples are coloured by cancer subtype (<span style="color: #388ECC;">Basal</span>, <span style="color: #F68B33;">Her2</span> and <span style="color: #585858;">LumA</span>).
</p>
</div>

<p>This plot shows that globally, the discrimination of all breast cancer subtypes can be extracted from all data sets, however, there are some dissimilarities at the samples level across data sets (the common information cannot be extracted in the same way across data sets).</p>
</div>
</div>
<div id="id_06:diablo-variable-plots" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Variable plots</h2>
<p>The visualisation of the selected variables is crucial to mine their associations in multiblock sPLS-DA. Here we revisit existing outputs presented in Module 2 with further developments for multiple data set integration. All the plots presented provide complementary information for interpreting the results.</p>
<div id="plotvar" class="section level3" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> <code>plotVar</code></h3>
<p>The correlation circle plot highlights the contribution of each selected variable to each component. Important variables should be close to the large circle (see Module 2). Here, only the variables selected on components 1 and 2 are depicted (across all blocks), see Figure <a href="#fig:06-correlation-plot">6.5</a>. Clusters of points indicate a strong correlation between variables. For better visibility we chose to hide the variable names.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(diablo.tcga, <span class="at">var.names =</span> <span class="cn">FALSE</span>, <span class="at">style =</span> <span class="st">&#39;graphics&#39;</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>, </span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">15</span>), <span class="at">cex =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>), </span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;darkorchid&#39;</span>, <span class="st">&#39;brown1&#39;</span>, <span class="st">&#39;lightgreen&#39;</span>),</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;TCGA, DIABLO comp 1 - 2&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-correlation-plot"></span>
<img src="Figures/DIABLO/06-correlation-plot-1.png" alt="Correlation circle plot from multiblock sPLS-DA performed on the breast.TCGA study. The variable coordinates are defined according to their correlation with the first and second components for each data set. Variable types are indicated with different symbols and colours, and are overlaid on the same plot. The plot highlights the potential associations within and between different variable types when they are important in defining their own component." width="70%"  />
<p class="caption">
Figure 6.5: <strong>Correlation circle plot from multiblock sPLS-DA performed on the <code>breast.TCGA</code> study.</strong> The variable coordinates are defined according to their correlation with the first and second components for each data set. Variable types are indicated with different symbols and colours, and are overlaid on the same plot. The plot highlights the potential associations within and between different variable types when they are important in defining their own component.
</p>
</div>

<p>The correlation circle plot shows some positive correlations (between selected <span style="color: black;">miRNA</span> and <span style="color: black;">proteins</span>, between selected <span style="color: black;">proteins</span> and <span style="color: black;">mRNA</span>) and negative correlations between <span style="color: black;">mRNA</span>and <span style="color: black;">miRNA</span> on component 1. The correlation structure is less obvious on component 2, but we observe some key selected features (<span style="color: black;">proteins</span> and <span style="color: black;">miRNA</span>) that seem to highly contribute to component 2.</p>
<p>Note:</p>
<ul>
<li><p><em>These results can be further investigated by showing the variable names on this plot (or extracting their coordinates available from the plot saved into an object, see <code>?plotVar</code>), and looking at various outputs from <code>selectVar()</code> and <code>plotLoadings()</code>.</em></p></li>
<li><p><em>You can choose to only show specific variable type names, e.g. <code>var.names = c(FALSE, FALSE, TRUE)</code> (where each argument is assigned to a data set in <span class="math inline">\(\boldsymbol X\)</span>). Here for example, the protein names only would be output.</em></p></li>
</ul>
</div>
<div id="circosplot" class="section level3" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> <code>circosPlot</code></h3>
<p>The circos plot represents the correlations between variables of different types, represented on the side quadrants. Several display options are possible, to show within and between connections between blocks, and expression levels of each variable according to each class (argument <code>line = TRUE</code>). The circos plot is built based on a similarity matrix, which was extended to the case of multiple data sets from <span class="citation">González et al. (<a href="#ref-Gon12" role="doc-biblioref">2012</a>)</span> (see also Module 2 and Extra Reading material from that module). A <code>cutoff</code> argument can be further included to visualise correlation coefficients above this threshold in the multi-omics signature (Figure <a href="#fig:06-circos-plot">6.6</a>). The colours for the blocks and correlation lines can be chosen with <code>color.blocks</code> and <code>color.cor</code> respectively:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">circosPlot</span>(diablo.tcga, <span class="at">cutoff =</span> <span class="fl">0.7</span>, <span class="at">line =</span> <span class="cn">TRUE</span>, </span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">color.blocks =</span> <span class="fu">c</span>(<span class="st">&#39;darkorchid&#39;</span>, <span class="st">&#39;brown1&#39;</span>, <span class="st">&#39;lightgreen&#39;</span>),</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">color.cor =</span> <span class="fu">c</span>(<span class="st">&quot;chocolate3&quot;</span>,<span class="st">&quot;grey20&quot;</span>), <span class="at">size.labels =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-circos-plot"></span>
<img src="Figures/DIABLO/06-circos-plot-1.png" alt="Circos plot from multiblock sPLS-DA performed on the breast.TCGA study. The plot represents the correlations greater than 0.7 between variables of different types, represented on the side quadrants. The internal connecting lines show the positive (negative) correlations. The outer lines show the expression levels of each variable in each sample group (Basal, Her2 and LumA)." width="70%"  />
<p class="caption">
Figure 6.6: <strong>Circos plot from multiblock sPLS-DA performed on the <code>breast.TCGA</code> study.</strong> The plot represents the correlations greater than 0.7 between variables of different types, represented on the side quadrants. The internal connecting lines show the <span style="color: black;">positive</span> (<span style="color: #585858;">negative</span>) correlations. The outer lines show the expression levels of each variable in each sample group (<span style="color: #388ECC;">Basal</span>, <span style="color: #F68B33;">Her2</span> and <span style="color: #585858;">LumA</span>).
</p>
</div>

<p>The circos plot enables us to visualise cross-correlations between data types, and the nature of these correlations (<span style="color: black;">positive</span> or negative). Here we observe that correlations &gt; 0.7 are between a few <span style="color: black;">mRNA</span>and some <span style="color: #009E73;">Proteins</span>, whereas the majority of strong (negative) correlations are observed between <span style="color: #CC0000;">miRNA</span> and <span style="color: black;">mRNA</span>or <span style="color: #009E73;">Proteins</span>. The lines indicating the average expression levels per breast cancer subtype indicate that the selected features are able to discriminate the sample groups.</p>
</div>
<div id="network" class="section level3" number="6.6.3">
<h3><span class="header-section-number">6.6.3</span> <code>network</code></h3>
<p>Relevance networks, which are also built on the similarity matrix, can also visualise the correlations between the different types of variables. Each colour represents a type of variable. A threshold can also be set using the argument <code>cutoff</code> (Figure <a href="#fig:06-network">6.7</a>). By default the network includes only variables selected on component 1, unless specified in <code>comp</code>.</p>
<p>Note that sometimes the output may not show with Rstudio due to margin issues. We can either use <code>X11()</code> to open a new window, or save the plot as an image using the arguments <code>save</code> and <code>name.save</code>, as we show below. An <code>interactive</code> argument is also available for the <code>cutoff</code> argument, see details in <code>?network</code>.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># X11()   # Opens a new window</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">network</span>(diablo.tcga, <span class="at">blocks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">cutoff =</span> <span class="fl">0.4</span>,</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">color.node =</span> <span class="fu">c</span>(<span class="st">&#39;darkorchid&#39;</span>, <span class="st">&#39;brown1&#39;</span>, <span class="st">&#39;lightgreen&#39;</span>),</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># To save the plot, uncomment below line</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">#save = &#39;png&#39;, name.save = &#39;diablo-network&#39;</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-network"></span>
<img src="Figures/DIABLO/06-network-1.png" alt="Relevance network for the variables selected by multiblock sPLS-DA performed on the breast.TCGA study on component 1. Each node represents a selected variable with colours indicating their type. The colour of the edges represent positive or negative correlations. Further tweaking of this plot can be obtained, see the help file ?network." width="70%"  />
<p class="caption">
Figure 6.7: <strong>Relevance network for the variables selected by multiblock sPLS-DA performed on the <code>breast.TCGA</code> study on component 1.</strong> Each node represents a selected variable with colours indicating their type. The colour of the edges represent positive or negative correlations. Further tweaking of this plot can be obtained, see the help file <code>?network</code>.
</p>
</div>

<p>The relevance network in Figure <a href="#fig:06-network">6.7</a> shows two groups of features of different types. Within each group we observe positive and negative correlations. The visualisation of this plot could be further improved by changing the names of the original features.</p>
<p>Note that the network can be saved in a .gml format to be input into the software Cytoscape, using the R package <code>igraph</code> <span class="citation">(<a href="#ref-csa06" role="doc-biblioref">Csardi, Nepusz, et al. 2006</a>)</span>:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Not run</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>myNetwork <span class="ot">&lt;-</span> <span class="fu">network</span>(diablo.tcga, <span class="at">blocks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">cutoff =</span> <span class="fl">0.4</span>)</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.graph</span>(myNetwork<span class="sc">$</span>gR, <span class="at">file =</span> <span class="st">&quot;myNetwork.gml&quot;</span>, <span class="at">format =</span> <span class="st">&quot;gml&quot;</span>)</span></code></pre></div>
</div>
<div id="plotloadings" class="section level3" number="6.6.4">
<h3><span class="header-section-number">6.6.4</span> <code>plotLoadings</code></h3>
<p><code>plotLoadings()</code> visualises the loading weights of each selected variable on each component and each data set. The colour indicates the class in which the variable has the maximum level of expression (<code>contrib = 'max'</code>) or minimum (<code>contrib = 'min'</code>), on average (<code>method = 'mean'</code>) or using the median (<code>method = 'median'</code>).</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLoadings</span>(diablo.tcga, <span class="at">comp =</span> <span class="dv">1</span>, <span class="at">contrib =</span> <span class="st">&#39;max&#39;</span>, <span class="at">method =</span> <span class="st">&#39;median&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-loading-plot"></span>
<img src="Figures/DIABLO/06-loading-plot-1.png" alt="Loading plot for the variables selected by multiblock sPLS-DA performed on the breast.TCGA study on component 1. The most important variables (according to the absolute value of their coefficients) are ordered from bottom to top. As this is a supervised analysis, colours indicate the class for which the median expression value is the highest for each feature (variables selected characterise Basal and LumA)." width="70%"  />
<p class="caption">
Figure 6.8: <strong>Loading plot for the variables selected by multiblock sPLS-DA performed on the <code>breast.TCGA</code> study on component 1.</strong> The most important variables (according to the absolute value of their coefficients) are ordered from bottom to top. As this is a supervised analysis, colours indicate the class for which the median expression value is the highest for each feature (variables selected characterise <span style="color: #388ECC;">Basal</span> and <span style="color: #585858;">LumA</span>).
</p>
</div>

<p>The loading plot shows the multi-omics signature selected on component 1, where each panel represents one data type. The importance of each variable is visualised by the length of the bar (i.e. its loading coefficient value). The combination of the sign of the coefficient (positive / negative) and the colours indicate that component 1 discriminates primarily the <span style="color: #388ECC;">Basal</span> samples vs. the <span style="color: #585858;">LumA</span> samples (see the sample plots also). The features selected are highly expressed in one of these two subtypes. One could also plot the second component that discriminates the <span style="color: #F68B33;">Her2</span> samples.</p>
</div>
<div id="cimdiablo" class="section level3" number="6.6.5">
<h3><span class="header-section-number">6.6.5</span> <code>cimDiablo</code></h3>
<p>The <code>cimDiablo()</code> function is a clustered image map specifically implemented to represent the multi-omics molecular signature expression for each sample. It is very similar to a classical hierarchical clustering (Figure <a href="#fig:06-cim">6.9</a>).</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cimDiablo</span>(diablo.tcga, <span class="at">color.blocks =</span> <span class="fu">c</span>(<span class="st">&#39;darkorchid&#39;</span>, <span class="st">&#39;brown1&#39;</span>, <span class="st">&#39;lightgreen&#39;</span>),</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">comp =</span> <span class="dv">1</span>, <span class="at">margin=</span><span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">20</span>), <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<pre><code>## 
## trimming values to [-3, 3] range for cim visualisation. See &#39;trim&#39; arg in ?cimDiablo</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-cim"></span>
<img src="Figures/DIABLO/06-cim-1.png" alt="Clustered Image Map for the variables selected by multiblock sPLS-DA performed on the breast.TCGA study on component 1. By default, Euclidean distance and Complete linkage methods are used. The CIM represents samples in rows (indicated by their breast cancer subtype on the left hand side of the plot) and selected features in columns (indicated by their data type at the top of the plot)." width="70%"  />
<p class="caption">
Figure 6.9: <strong>Clustered Image Map for the variables selected by multiblock sPLS-DA performed on the <code>breast.TCGA</code> study on component 1.</strong> By default, Euclidean distance and Complete linkage methods are used. The CIM represents samples in rows (indicated by their breast cancer subtype on the left hand side of the plot) and selected features in columns (indicated by their data type at the top of the plot).
</p>
</div>

<p>According to the CIM, component 1 seems to primarily classify the <span style="color: #388ECC;">Basal</span> samples, with a group of overexpressed <span style="color: black;">miRNA</span> and underexpressed <span style="color: black;">mRNA</span>and <span style="color: black;">proteins</span>. A group of <span style="color: #585858;">LumA</span> samples can also be identified due to the overexpression of the same <span style="color: black;">mRNA</span>and <span style="color: black;">proteins</span>. <span style="color: #F68B33;">Her2</span> samples remain quite mixed with the other <span style="color: #585858;">LumA</span> samples.</p>
</div>
</div>
<div id="id_06:diablo-perf" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Model performance and prediction</h2>
<p>We assess the performance of the model using 10-fold cross-validation repeated 10 times with the function <code>perf()</code>. The method runs a <code>block.splsda()</code> model on the pre-specified arguments input from our final object <code>diablo.tcga</code> but on cross-validated samples. We then assess the accuracy of the prediction on the left out samples. Since the <code>tune()</code> function was used with the <code>centroid.dist</code> argument, we examine the outputs of the <code>perf()</code> function for that same distance:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># For reproducibility with this handbook, remove otherwise</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>perf.diablo.tcga <span class="ot">&lt;-</span> <span class="fu">perf</span>(diablo.tcga,  <span class="at">validation =</span> <span class="st">&#39;Mfold&#39;</span>, <span class="at">folds =</span> <span class="dv">10</span>, </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">nrepeat =</span> <span class="dv">10</span>, <span class="at">dist =</span> <span class="st">&#39;centroids.dist&#39;</span>)</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="co">#perf.diablo.tcga  # Lists the different outputs</span></span></code></pre></div>
<p>We can extract the (balanced) classification error rates globally or overall with
<code>perf.diablo.tcga$error.rate.per.class</code>, the predicted components associated to <span class="math inline">\(\boldsymbol Y\)</span>, or the stability of the selected features with <code>perf.diablo.tcga$features</code>.</p>
<p>Here we look at the different performance assessment schemes specific to multiple data set integration.</p>
<p>First, we output the performance with the majority vote, that is, since the prediction is based on the components associated to their own data set, we can then weight those predictions across data sets according to a majority vote scheme. Based on the predicted classes, we then extract the classification error rate per class and per component:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance with Majority vote</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>perf.diablo.tcga<span class="sc">$</span>MajorityVote.error.rate</span></code></pre></div>
<pre><code>## $centroids.dist
##                  comp1      comp2
## Basal       0.02666667 0.04444444
## Her2        0.20666667 0.12333333
## LumA        0.04533333 0.00800000
## Overall.ER  0.07200000 0.04200000
## Overall.BER 0.09288889 0.05859259</code></pre>
<p>The output shows that with the exception of the Basal samples, the classification improves with the addition of the second component.</p>
<p>Another prediction scheme is to weight the classification error rate from each data set according to the correlation between the predicted components and the <span class="math inline">\(\boldsymbol Y\)</span> outcome.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance with Weighted vote</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>perf.diablo.tcga<span class="sc">$</span>WeightedVote.error.rate</span></code></pre></div>
<pre><code>## $centroids.dist
##                   comp1      comp2
## Basal       0.006666667 0.04444444
## Her2        0.140000000 0.10666667
## LumA        0.045333333 0.00800000
## Overall.ER  0.052666667 0.03866667
## Overall.BER 0.064000000 0.05303704</code></pre>
<p>Compared to the previous majority vote output, we can see that the classification accuracy is slightly better on component 2 for the subtype Her2.</p>
<p>An AUC plot <em>per block</em> is plotted using the function <code>auroc()</code>. We have already mentioned in Module 3 for PLS-DA, the interpretation of this output may not be particularly insightful in relation to the performance evaluation of our methods, but can complement the statistical analysis. For example, here for the miRNA data set once we have reached component 2 (Figure <a href="#fig:06-auroc">6.10</a>):</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>auc.diablo.tcga <span class="ot">&lt;-</span> <span class="fu">auroc</span>(diablo.tcga, <span class="at">roc.block =</span> <span class="st">&quot;miRNA&quot;</span>, <span class="at">roc.comp =</span> <span class="dv">2</span>,</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">print =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:06-auroc"></span>
<img src="Figures/DIABLO/06-auroc-1.png" alt="ROC and AUC based on multiblock sPLS-DA performed on the breast.TCGA study for the miRNA data set after 2 components. The function calculates the ROC curve and AUC for one class vs. the others. If we set print = TRUE, the Wilcoxon test p-value that assesses the differences between the predicted components from one class vs. the others is output." width="70%"  />
<p class="caption">
Figure 6.10: <strong>ROC and AUC based on multiblock sPLS-DA performed on the <code>breast.TCGA</code> study for the miRNA data set after 2 components.</strong> The function calculates the ROC curve and AUC for one class vs. the others. If we set <code>print = TRUE</code>, the Wilcoxon test p-value that assesses the differences between the predicted components from one class vs. the others is output.
</p>
</div>

<p>Figure <a href="#fig:06-auroc">6.10</a> shows that the Her2 subtype is the most difficult to classify with multiblock sPLS-DA compared to the other subtypes.</p>
<p>The <code>predict()</code> function associated with a <code>block.splsda()</code> object predicts the class of samples from an external test set. In our specific case, one data set is missing in the test set but the method can still be applied. We need to ensure the names of the blocks correspond exactly to those from the training set:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare test set data: here one block (proteins) is missing</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>data.test.tcga <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mRNA =</span> breast.TCGA<span class="sc">$</span>data.test<span class="sc">$</span>mrna, </span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">miRNA =</span> breast.TCGA<span class="sc">$</span>data.test<span class="sc">$</span>mirna)</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>predict.diablo.tcga <span class="ot">&lt;-</span> <span class="fu">predict</span>(diablo.tcga, <span class="at">newdata =</span> data.test.tcga)</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The warning message will inform us that one block is missing</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="co">#predict.diablo # List the different outputs</span></span></code></pre></div>
<p>The following output is a confusion matrix that compares the real subtypes with the predicted subtypes for a 2 component model, for the distance of interest <code>centroids.dist</code> and the prediction scheme <code>WeightedVote</code>:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>confusion.mat.tcga <span class="ot">&lt;-</span> <span class="fu">get.confusion_matrix</span>(<span class="at">truth =</span> breast.TCGA<span class="sc">$</span>data.test<span class="sc">$</span>subtype, </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">predicted =</span> predict.diablo.tcga<span class="sc">$</span>WeightedVote<span class="sc">$</span>centroids.dist[,<span class="dv">2</span>])</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>confusion.mat.tcga</span></code></pre></div>
<pre><code>##       predicted.as.Basal predicted.as.Her2 predicted.as.LumA
## Basal                 20                 1                 0
## Her2                   0                13                 1
## LumA                   0                 3                32</code></pre>
<p>From this table, we see that one Basal and one Her2 sample are wrongly predicted as Her2 and Lum A respectively, and 3 LumA samples are wrongly predicted as Her2. The balanced prediction error rate can be obtained as:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get.BER</span>(confusion.mat.tcga)</span></code></pre></div>
<pre><code>## [1] 0.06825397</code></pre>
<p>It would be worthwhile at this stage to revisit the chosen design of the multiblock sPLS-DA model to assess the influence of the design on the prediction performance on this test set - even though this back and forth analysis is a biased criterion to choose the design!</p>

</div>
</div>
<div id="id_07" class="section level1" number="7">
<h1><span class="header-section-number"> 7</span> P-Integration</h1>
<div id="id_07:mint" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> MINT on the stem cell case study</h2>
<p>We integrate four transcriptomics studies of microarray stem cells (125 samples in total). The original data set from the Stemformatics database<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> <span class="citation">(<a href="#ref-Well13" role="doc-biblioref">Wells et al. 2013</a>)</span> was reduced to fit into the package, and includes a randomly-chosen subset of the expression levels of 400 genes. The aim is to classify three types of human cells: human fibroblasts (Fib) and human induced Pluripotent Stem Cells (hiPSC &amp; hESC).</p>
<p>There is a biological hierarchy among the three cell types. On one hand, differences between pluripotent (hiPSC and hESC) and non-pluripotent cells (Fib) are well-characterised and are expected to contribute to the main biological variation. On the other hand, hiPSC are genetically reprogrammed to behave like hESC and both cell types are commonly assumed to be alike. However, differences have been reported in the literature (<span class="citation">Chin et al. (<a href="#ref-Chi09" role="doc-biblioref">2009</a>)</span>, <span class="citation">Newman and Cooper (<a href="#ref-New10" role="doc-biblioref">2010</a>)</span>). We illustrate the use of MINT to address sub-classification problems in a single analysis.</p>
</div>
<div id="id_07:load-data" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Load the data</h2>
<p>We first load the data from the package and set up the categorical outcome <span class="math inline">\(\boldsymbol Y\)</span> and the <code>study</code> membership:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(stemcells)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The combined data set X</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> stemcells<span class="sc">$</span>gene</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X)</span></code></pre></div>
<pre><code>## [1] 125 400</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The outcome vector Y:  </span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> stemcells<span class="sc">$</span>celltype </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(Y) </span></code></pre></div>
<pre><code>## [1] 125</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Y)</span></code></pre></div>
<pre><code>## Fibroblast       hESC      hiPSC 
##         30         37         58</code></pre>
<p>We then store the vector indicating the sample membership of each independent study:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>study <span class="ot">&lt;-</span> stemcells<span class="sc">$</span>study</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of samples per study:</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(study)</span></code></pre></div>
<pre><code>##  1  2  3  4 
## 38 51 21 15</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Experimental design</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Y,study)</span></code></pre></div>
<pre><code>##             study
## Y             1  2  3  4
##   Fibroblast  6 18  3  3
##   hESC       20  3  8  6
##   hiPSC      12 30 10  6</code></pre>
</div>
<div id="id_07:plsda" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Example: MINT PLS-DA</h2>
<p>We first perform a MINT PLS-DA with all variables included in the model and <code>ncomp = 5</code> components. The <code>perf()</code> function is used to estimate the performance of the model using LOGOCV, and to choose the optimal number of components for our final model (see Fig <a href="#fig:07-plsda-perf">7.1</a>).</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>mint.plsda.stem <span class="ot">&lt;-</span> <span class="fu">mint.plsda</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y, <span class="at">study =</span> study, <span class="at">ncomp =</span> <span class="dv">5</span>)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2543</span>) <span class="co"># For reproducible results here, remove for your own analyses</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>perf.mint.plsda.stem <span class="ot">&lt;-</span> <span class="fu">perf</span>(mint.plsda.stem) </span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf.mint.plsda.stem)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-plsda-perf"></span>
<img src="Figures/MINT/07-plsda-perf-1.png" alt="Choosing the number of components in mint.plsda using perf() with LOGOCV in the stemcells study. Classification error rates (overall and balanced, see Module 2) are represented on the y-axis with respect to the number of components on the x-axis for each prediction distance (see Module 3 and Extra Reading material ‘PLS-DA appendix’). The plot shows that the error rate reaches a minimum from 1 component with the BER and centroids distance." width="70%"  />
<p class="caption">
Figure 7.1: <strong>Choosing the number of components in <code>mint.plsda</code> using <code>perf()</code> with LOGOCV in the <code>stemcells</code> study</strong>. Classification error rates (overall and balanced, see Module 2) are represented on the y-axis with respect to the number of components on the x-axis for each prediction distance (see Module 3 and Extra Reading material ‘PLS-DA appendix’). The plot shows that the error rate reaches a minimum from 1 component with the BER and centroids distance.
</p>
</div>

<p>Based on the performance plot (Figure <a href="#fig:07-plsda-perf">7.1</a>), <code>ncomp = 2</code> seems to achieve the best performance for the centroid distance, and <code>ncomp = 1</code> for the Mahalanobis distance in terms of BER. Additional numerical outputs such as the BER and overall error rates per component, and the error rates per class and per prediction distance, can be output:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>perf.mint.plsda.stem<span class="sc">$</span>global.error<span class="sc">$</span>BER</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Type also:</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="co"># perf.mint.plsda.stem$global.error</span></span></code></pre></div>
<pre><code>##        max.dist centroids.dist mahalanobis.dist
## comp1 0.3803556      0.3333333        0.3333333
## comp2 0.3519556      0.3320000        0.3725111
## comp3 0.3499556      0.3384000        0.3232889
## comp4 0.3541111      0.3427778        0.3898000
## comp5 0.3353778      0.3268667        0.3097111</code></pre>
<p>While we may want to focus our interpretation on the first component, we run a final MINT PLS-DA model for <code>ncomp = 2</code> to obtain 2D graphical outputs (Figure <a href="#fig:07-plsda-sample-plot1">7.2</a>):</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>final.mint.plsda.stem <span class="ot">&lt;-</span> <span class="fu">mint.plsda</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y, <span class="at">study =</span> study, <span class="at">ncomp =</span> <span class="dv">2</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="co">#final.mint.plsda.stem # Lists the different functions</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.mint.plsda.stem, <span class="at">legend =</span> <span class="cn">TRUE</span>, <span class="at">title =</span> <span class="st">&#39;MINT PLS-DA&#39;</span>, </span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">&#39;stem cell study&#39;</span>, <span class="at">ellipse =</span> T)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-plsda-sample-plot1"></span>
<img src="Figures/MINT/07-plsda-sample-plot1-1.png" alt="Sample plot from the MINT PLS-DA performed on the stemcells gene expression data. Samples are projected into the space spanned by the first two components. Samples are coloured by their cell types and symbols indicate the study membership. Component 1 discriminates fibroblast vs. the others, while component 2 discriminates some of the hiPSC vs. hESC." width="70%"  />
<p class="caption">
Figure 7.2: <strong>Sample plot from the MINT PLS-DA performed on the <code>stemcells</code> gene expression data</strong>. Samples are projected into the space spanned by the first two components. Samples are coloured by their cell types and symbols indicate the study membership. Component 1 discriminates <span style="color: #388ECC;">fibroblast</span> vs. the others, while component 2 discriminates some of the <span style="color: #585858;">hiPSC</span> vs. <span style="color: #F68B33;">hESC</span>.
</p>
</div>

<p>The sample plot (Fig <a href="#fig:07-plsda-sample-plot1">7.2</a>) shows that <span style="color: #388ECC;">fibroblast</span> are separated on the first component. We observe that while deemed not crucial for an optimal discrimination, the second component seems to help separate <span style="color: #F68B33;">hESC</span> and <span style="color: #585858;">hiPSC</span> further. The effect of study after MINT modelling is not strong.</p>
<p>We can compare this output to a classical PLS-DA to visualise the study effect (Figure <a href="#fig:07-plsda-sample-plot2">7.3</a>):</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>plsda.stem <span class="ot">&lt;-</span> <span class="fu">plsda</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y, <span class="at">ncomp =</span> <span class="dv">2</span>)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(plsda.stem, <span class="at">pch =</span> study,</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="cn">TRUE</span>, <span class="at">title =</span> <span class="st">&#39;Classic PLS-DA&#39;</span>,</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="st">&#39;Cell type&#39;</span>, <span class="at">legend.title.pch =</span> <span class="st">&#39;Study&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-plsda-sample-plot2"></span>
<img src="Figures/MINT/07-plsda-sample-plot2-1.png" alt="Sample plot from a classic PLS-DA performed on the stemcells gene expression data that highlights the study effect (indicated by symbols). Samples are projected into the space spanned by the first two components. We still do observe some discrimination between the cell types." width="70%"  />
<p class="caption">
Figure 7.3: <strong>Sample plot from a classic PLS-DA performed on the <code>stemcells</code> gene expression data</strong> that highlights the study effect (indicated by symbols). Samples are projected into the space spanned by the first two components. We still do observe some discrimination between the cell types.
</p>
</div>

</div>
<div id="id_07:splsda" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Example: MINT sPLS-DA</h2>
<p>The MINT PLS-DA model shown earlier is built on all 400 genes in <span class="math inline">\(\boldsymbol X\)</span>, many of which may be uninformative to characterise the different classes. Here we aim to identify a small subset of genes that best discriminate the classes.</p>
<div id="id_07:splsda-tuning" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Number of variables to select</h3>
<p>We can choose the <code>keepX</code> parameter using the <code>tune()</code> function for a MINT object. The function performs LOGOCV for different values of <code>test.keepX</code> provided on each component, and no repeat argument is needed. Based on the mean classification error rate (overall error rate or BER) and a centroids distance, we output the optimal number of variables <code>keepX</code> to be included in the final model.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2543</span>)  <span class="co"># For a reproducible result here, remove for your own analyses</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>tune.mint.splsda.stem <span class="ot">&lt;-</span> <span class="fu">tune</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y, <span class="at">study =</span> study, </span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ncomp =</span> <span class="dv">2</span>, <span class="at">test.keepX =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">&#39;mint.splsda&#39;</span>, <span class="co">#Specify the method</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">measure =</span> <span class="st">&#39;BER&#39;</span>,</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dist =</span> <span class="st">&quot;centroids.dist&quot;</span>,</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">nrepeat =</span> <span class="dv">3</span>)</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a><span class="co">#tune.mint.splsda.stem # Lists the different types of outputs</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean error rate per component and per tested keepX value:</span></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a><span class="co">#tune.mint.splsda.stem$error.rate[1:5,]</span></span></code></pre></div>
<p>The optimal number of variables to select on each specified component:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>tune.mint.splsda.stem<span class="sc">$</span>choice.keepX</span></code></pre></div>
<pre><code>## comp1 comp2 
##    24     1</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tune.mint.splsda.stem)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-splsda-tuning-plot"></span>
<img src="Figures/MINT/07-splsda-tuning-plot-1.png" alt="Tuning keepX in MINT sPLS-DA performed on the stemcells gene expression data. Each coloured line represents the balanced error rate (y-axis) per component across all tested keepX values (x-axis). The diamond indicates the optimal keepX value on a particular component which achieves the lowest classification error rate as determined with a one-sided \(t-\)test across the studies." width="70%"  />
<p class="caption">
Figure 7.4: <strong>Tuning <code>keepX</code> in MINT sPLS-DA performed on the <code>stemcells</code> gene expression data.</strong> Each coloured line represents the balanced error rate (y-axis) per component across all tested <code>keepX</code> values (x-axis). The diamond indicates the optimal <code>keepX</code> value on a particular component which achieves the lowest classification error rate as determined with a one-sided <span class="math inline">\(t-\)</span>test across the studies.
</p>
</div>

<p>The tuning plot in Figure <a href="#fig:07-splsda-tuning-plot">7.4</a> indicates the optimal number of variables to select on component 1 (24) and on component 2 (1). In fact, whilst the BER decreases with the addition of component 2, the standard deviation remains large, and thus only one component is optimal. However, the addition of this second component is useful for the graphical outputs, and also to attempt to discriminate the hESC and hiPCS cell types.</p>
<p>Note:</p>
<ul>
<li><em>As shown in the quick start example, the tuning step can be omitted if you prefer to set arbitrary <code>keepX</code> values.</em></li>
</ul>
</div>
<div id="id_07:splsda-final" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Final MINT sPLS-DA model</h3>
<p>Following the tuning results, our final model is as follows (we still choose a model with two components in order to obtain 2D graphics):</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>final.mint.splsda.stem <span class="ot">&lt;-</span> <span class="fu">mint.splsda</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y, <span class="at">study =</span> study, <span class="at">ncomp =</span> <span class="dv">2</span>,  </span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">keepX =</span> tune.mint.splsda.stem<span class="sc">$</span>choice.keepX)</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="co">#mint.splsda.stem.final # Lists useful functions that can be used with a MINT object</span></span></code></pre></div>
</div>
<div id="id_07:splsda-sample-plots" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> Sample plots</h3>
<p>The samples can be projected on the global components or alternatively using the partial components from each study (Fig <a href="#fig:07-splsda-sample-plots">7.5</a>).</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.mint.splsda.stem, <span class="at">study =</span> <span class="st">&#39;global&#39;</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>, </span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;Stem cells, MINT sPLS-DA&#39;</span>, </span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">&#39;Global&#39;</span>, <span class="at">ellipse =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(final.mint.splsda.stem, <span class="at">study =</span> <span class="st">&#39;all.partial&#39;</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>, </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&#39;Stem cells, MINT sPLS-DA&#39;</span>, </span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Study&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-splsda-sample-plots"></span>
<img src="Figures/MINT/07-splsda-sample-plot1-1.png" alt="Sample plots from the MINT sPLS-DA performed on the stemcells gene expression data. Samples are projected into the space spanned by the first two components. Samples are coloured by their cell types and symbols indicate study membership. (a) Global components from the model with 95% ellipse confidence intervals around each sample class. (b) Partial components per study show a good agreement across studies. Component 1 discriminates fibroblast vs. the rest, component 2 discriminates further hESC vs. hiPSC." width="50%"  /><img src="Figures/MINT/07-splsda-sample-plot2-1.png" alt="Sample plots from the MINT sPLS-DA performed on the stemcells gene expression data. Samples are projected into the space spanned by the first two components. Samples are coloured by their cell types and symbols indicate study membership. (a) Global components from the model with 95% ellipse confidence intervals around each sample class. (b) Partial components per study show a good agreement across studies. Component 1 discriminates fibroblast vs. the rest, component 2 discriminates further hESC vs. hiPSC." width="50%"  />
<p class="caption">
Figure 7.5: <strong>Sample plots from the MINT sPLS-DA performed on the <code>stemcells</code> gene expression data</strong>. Samples are projected into the space spanned by the first two components. Samples are coloured by their cell types and symbols indicate study membership. (a) Global components from the model with 95% ellipse confidence intervals around each sample class. (b) Partial components per study show a good agreement across studies. Component 1 discriminates <span style="color: #388ECC;">fibroblast</span> vs. the rest, component 2 discriminates further <span style="color: #F68B33;">hESC</span> vs. <span style="color: #585858;">hiPSC</span>.
</p>
</div>

<p>The visualisation of the partial components enables us to examine each study individually and check that the model is able to extract a good agreement between studies.</p>
</div>
<div id="id_07:splsda-variable-plots" class="section level3" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> Variable plots</h3>
<div id="id_07:splsda-correlation-plot" class="section level4" number="7.4.4.1">
<h4><span class="header-section-number">7.4.4.1</span> Correlation circle plot</h4>
<p>We can examine our molecular signature selected with MINT sPLS-DA. The correlation circle plot, presented in Module 2, highlights the contribution of each selected transcript to each component (close to the large circle), and their correlation (clusters of variables) in Figure <a href="#fig:07-splsda-correlation-plot2">7.6</a>:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVar</span>(final.mint.splsda.stem)</span></code></pre></div>
<p><img src="Figures/MINT/07-splsda-correlation-plot1-1.png" width="70%"  style="display: block; margin: auto;" /></p>
<!-- Code below to highlight specific genes -->
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-splsda-correlation-plot2"></span>
<img src="Figures/MINT/07-splsda-correlation-plot2-1.png" alt="Correlation circle plot representing the genes selected by MINT sPLS-DA performed on the stemcells gene expression data to examine the association of the genes selected on the first two components. We mainly observe two groups of genes, either positively or negatively associated with component 1 along the x-axis. This graphic should be interpreted in conjunction with the sample plot." width="70%"  />
<p class="caption">
Figure 7.6: <strong>Correlation circle plot representing the genes selected by MINT sPLS-DA performed on the <code>stemcells</code> gene expression data</strong> to examine the association of the genes selected on the first two components. We mainly observe two groups of genes, either <span style="color: #009E73;">positively</span> or <span style="color: #CC79A7;">negatively</span> associated with component 1 along the x-axis. This graphic should be interpreted in conjunction with the sample plot.
</p>
</div>

<p>We observe a <span style="color: #CC79A7;">subset of genes that are strongly correlated and negatively</span> associated to component 1 (negative values on the x-axis), which are likely to characterise the groups of samples hiPSC and hESC, and a <span style="color: #009E73;">subset of genes positively</span> associated to component 1 that may characterise the fibroblast samples (and are negatively correlated to the previous group of genes).</p>
<p>Note:</p>
<ul>
<li><em>We can use the <code>var.name</code> argument to show gene name ID, as shown in Module 3 for PLS-DA.</em></li>
</ul>
</div>
<div id="id_07:splsda-cim" class="section level4" number="7.4.4.2">
<h4><span class="header-section-number">7.4.4.2</span> Clustered Image Maps</h4>
<p>The Clustered Image Map represents the expression levels of the gene signature per sample, similar to a PLS-DA object (see Module 3). Here we use the default Euclidean distance and Complete linkage in Figure <a href="#fig:07-splsda-cim">7.7</a> for a specific component (here 1):</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If facing margin issues, use either X11() or save the plot using the</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="co"># arguments save and name.save</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cim</span>(final.mint.splsda.stem, <span class="at">comp =</span> <span class="dv">1</span>, <span class="at">margins=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">5</span>), </span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.sideColors =</span> <span class="fu">color.mixo</span>(<span class="fu">as.numeric</span>(Y)), <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;MINT sPLS-DA, component 1&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-splsda-cim"></span>
<img src="Figures/MINT/07-splsda-cim-1.png" alt="Clustered Image Map of the genes selected by MINT sPLS-DA on the stemcells gene expression data for component 1 only. A hierarchical clustering based on the gene expression levels of the selected genes on component 1, with samples in rows coloured according to cell type showing a separation of the fibroblast vs. the other cell types." width="70%"  />
<p class="caption">
Figure 7.7: <strong>Clustered Image Map of the genes selected by MINT sPLS-DA on the <code>stemcells</code> gene expression data for component 1 only</strong>. A hierarchical clustering based on the gene expression levels of the selected genes on component 1, with samples in rows coloured according to cell type showing a separation of the <span style="color: #388ECC;">fibroblast</span> vs. the other cell types.
</p>
</div>

<p>As expected and observed from the sample plot Figure <a href="#fig:07-splsda-sample-plots">7.5</a>, we observe in the CIM that the expression of the genes selected on component 1 discriminates primarily the <span style="color: #388ECC;">fibroblast</span> vs. the other cell types.</p>
</div>
<div id="id_07:splsda-network" class="section level4" number="7.4.4.3">
<h4><span class="header-section-number">7.4.4.3</span> Relevance networks</h4>
<p>Relevance networks can also be plotted for a PLS-DA object, but would only show the association between the selected genes and the cell type (dummy variable in <span class="math inline">\(\boldsymbol Y\)</span> as an outcome category) as shown in Figure <a href="#fig:07-splsda-network">7.8</a>. Only the variables selected on component 1 are shown (<code>comp = 1</code>):</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If facing margin issues, use either X11() or save the plot using the</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="co"># arguments save and name.save</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="fu">network</span>(final.mint.splsda.stem, <span class="at">comp =</span> <span class="dv">1</span>,</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">color.node =</span> <span class="fu">c</span>(<span class="fu">color.mixo</span>(<span class="dv">1</span>), <span class="fu">color.mixo</span>(<span class="dv">2</span>)), </span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">shape.node =</span> <span class="fu">c</span>(<span class="st">&quot;rectangle&quot;</span>, <span class="st">&quot;circle&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-splsda-network"></span>
<img src="Figures/MINT/07-splsda-network-1.png" alt="Relevance network of the genes selected by MINT sPLS-DA performed on the stemcells gene expression data for component 1 only. Associations between variables from \(\boldsymbol X\) and the dummy matrix \(\boldsymbol Y\) are calculated as detailed in Extra Reading material from Module 2. Edges indicate high or low association between the genes and the different cell types." width="70%"  />
<p class="caption">
Figure 7.8: <strong>Relevance network of the genes selected by MINT sPLS-DA performed on the <code>stemcells</code> gene expression data for component 1 only</strong>. Associations between variables from <span class="math inline">\(\boldsymbol X\)</span> and the dummy matrix <span class="math inline">\(\boldsymbol Y\)</span> are calculated as detailed in Extra Reading material from Module 2. Edges indicate <span style="color: #CC0000;">high</span> or <span style="color: #009E73;">low</span> association between the genes and the different cell types.
</p>
</div>

</div>
<div id="id_07:splsda-loading-plot" class="section level4" number="7.4.4.4">
<h4><span class="header-section-number">7.4.4.4</span> Variable selection and loading plots</h4>
<p>The <code>selectVar()</code> function outputs the selected transcripts on the first component along with their loading weight values. We consider variables as important in the model when their absolute loading weight value is high. In addition to this output, we can compare the stability of the selected features across studies using the <code>perf()</code> function, as shown in PLS-DA in Module 3.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just a head</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">selectVar</span>(final.mint.plsda.stem, <span class="at">comp =</span> <span class="dv">1</span>)<span class="sc">$</span>value)</span></code></pre></div>
<pre><code>##                   value.var
## ENSG00000181449 -0.09764220
## ENSG00000123080  0.09606034
## ENSG00000110721 -0.09595070
## ENSG00000176485 -0.09457383
## ENSG00000184697 -0.09387322
## ENSG00000102935 -0.09370298</code></pre>
<p>The <code>plotLoadings()</code> function displays the coefficient weight of each selected variable in each study and shows the agreement of the gene signature across studies (Figure <a href="#fig:07-splsda-loading-plot">7.9</a>). Colours indicate the class in which the mean expression value of each selected gene is maximal. For component 1, we obtain:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLoadings</span>(final.mint.splsda.stem, <span class="at">contrib =</span> <span class="st">&quot;max&quot;</span>, <span class="at">method =</span> <span class="st">&#39;mean&#39;</span>, <span class="at">comp=</span><span class="dv">1</span>, </span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">study=</span><span class="st">&quot;all.partial&quot;</span>, <span class="at">title=</span><span class="st">&quot;Contribution on comp 1&quot;</span>, </span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Study&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-splsda-loading-plot"></span>
<img src="Figures/MINT/07-splsda-loading-plot-1.png" alt="Loading plots of the genes selected by the MINT sPLS-DA performed on the stemcells data, on component 1 per study. Each plot represents one study, and the variables are coloured according to the cell type they are maximally expressed in, on average. The length of the bars indicate the loading coefficient values that define the component. Several genes distinguish between fibroblast and the other cell types, and are consistently overexpressed in these samples across all studies. We observe slightly more variability in whether the expression levels of the other genes are more indicative of hiPSC or hESC cell types." width="70%"  />
<p class="caption">
Figure 7.9: <strong>Loading plots of the genes selected by the MINT sPLS-DA performed on the <code>stemcells</code> data, on component 1 per study</strong>. Each plot represents one study, and the variables are coloured according to the cell type they are maximally expressed in, on average. The length of the bars indicate the loading coefficient values that define the component. Several <span style="color: #388ECC;">genes</span> distinguish between <span style="color: #388ECC;">fibroblast</span> and the other cell types, and are consistently overexpressed in these samples across all studies. We observe slightly more variability in whether the expression levels of the other genes are more indicative of <span style="color: #585858;">hiPSC</span> or <span style="color: #F68B33;">hESC</span> cell types.
</p>
</div>

<p>Several <span style="color: #388ECC;">genes</span> are consistently over-expressed on average in the <span style="color: #388ECC;">fibroblast</span> samples in each of the studies, however, we observe a less consistent pattern for the other genes that characterise <span style="color: #585858;">hiPSC</span>} and <span style="color: #F68B33;">hESC</span>. This can be explained as the discrimination between both classes is challenging on component 1 (see sample plot in Figure <a href="#fig:07-splsda-sample-plots">7.5</a>).</p>
</div>
</div>
<div id="id_07:splsda-perf" class="section level3" number="7.4.5">
<h3><span class="header-section-number">7.4.5</span> Classification performance</h3>
<p>We assess the performance of the MINT sPLS-DA model with the <code>perf()</code> function. Since the previous tuning was conducted with the distance <code>centroids.dist</code>, the same distance is used to assess the performance of the final model. We do not need to specify the argument <code>nrepeat</code> as we use LOGOCV in the function.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducible results here, remove for your own study</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>perf.mint.splsda.stem.final <span class="ot">&lt;-</span> <span class="fu">perf</span>(final.mint.plsda.stem, <span class="at">dist =</span> <span class="st">&#39;centroids.dist&#39;</span>)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>perf.mint.splsda.stem.final<span class="sc">$</span>global.error</span></code></pre></div>
<pre><code>## $BER
##       centroids.dist
## comp1      0.3333333
## comp2      0.3320000
## 
## $overall
##       centroids.dist
## comp1          0.456
## comp2          0.392
## 
## $error.rate.class
## $error.rate.class$centroids.dist
##                comp1     comp2
## Fibroblast 0.0000000 0.0000000
## hESC       0.1891892 0.4594595
## hiPSC      0.8620690 0.5517241</code></pre>
<p>The classification error rate per class is particularly insightful to understand which cell types are difficult to classify, hESC and hiPS - whose mixture can be explained for biological reasons.</p>
</div>
</div>
<div id="id_07:splsda-auroc" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Take a detour</h2>
<div id="auc" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> AUC</h3>
<p>An AUC plot for the integrated data can be obtained using the function <code>auroc()</code> (Fig <a href="#fig:07-splsda-auroc-plots">7.10</a>).</p>
<p>Remember that the AUC incorporates measures of sensitivity and specificity for every possible cut-off of the predicted dummy variables. However, our PLS-based models rely on prediction distances, which can be seen as a determined optimal cut-off. Therefore, the ROC and AUC criteria may not be particularly insightful in relation to the performance evaluation of our supervised multivariate methods, but can complement the statistical analysis (from <span class="citation">Rohart, Gautier, Singh, and Lê Cao (<a href="#ref-Roh17" role="doc-biblioref">2017</a>)</span>).</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auroc</span>(final.mint.splsda.stem, <span class="at">roc.comp =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>We can also obtain an AUC plot per study by specifying the argument <code>roc.study</code>:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auroc</span>(final.mint.splsda.stem, <span class="at">roc.comp =</span> <span class="dv">1</span>, <span class="at">roc.study =</span> <span class="st">&#39;2&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:07-splsda-auroc-plots"></span>
<img src="Figures/MINT/07-splsda-auroc1-1.png" alt="ROC curve and AUC from the MINT sPLS-DA performed on the stemcells gene expression data for global and specific studies, averaged across one-vs-all comparisons. Numerical outputs include the AUC and a Wilcoxon test \(p-\)value for each ‘one vs. other’ class comparison that are performed per component. This output complements the sPLS-DA performance evaluation but should not be used for tuning (as the prediction process in sPLS-DA is based on prediction distances, not a cutoff that maximises specificity and sensitivity as in ROC). The plot suggests that the selected features are more accurate in classifying fibroblasts versus the other cell types, and less accurate in distinguishing hESC versus the other cell types or hiPSC versus the other cell types." width="50%"  /><img src="Figures/MINT/07-splsda-auroc2-1.png" alt="ROC curve and AUC from the MINT sPLS-DA performed on the stemcells gene expression data for global and specific studies, averaged across one-vs-all comparisons. Numerical outputs include the AUC and a Wilcoxon test \(p-\)value for each ‘one vs. other’ class comparison that are performed per component. This output complements the sPLS-DA performance evaluation but should not be used for tuning (as the prediction process in sPLS-DA is based on prediction distances, not a cutoff that maximises specificity and sensitivity as in ROC). The plot suggests that the selected features are more accurate in classifying fibroblasts versus the other cell types, and less accurate in distinguishing hESC versus the other cell types or hiPSC versus the other cell types." width="50%"  />
<p class="caption">
Figure 7.10: <strong>ROC curve and AUC from the MINT sPLS-DA performed on the <code>stemcells</code> gene expression data for global and specific studies</strong>, averaged across one-vs-all comparisons. Numerical outputs include the AUC and a Wilcoxon test <span class="math inline">\(p-\)</span>value for each ‘one vs. other’ class comparison that are performed per component. This output complements the sPLS-DA performance evaluation but <em>should not be used for tuning</em> (as the prediction process in sPLS-DA is based on prediction distances, not a cutoff that maximises specificity and sensitivity as in ROC). The plot suggests that the selected features are more accurate in classifying <span style="color: #CC0000;">fibroblasts versus the other cell types</span>, and less accurate in distinguishing <span style="color: #009E73;">hESC versus the other cell types</span> or <span style="color: #388ECC;">hiPSC versus the other cell types</span>.
</p>
</div>

</div>
<div id="id_07:splsda-predict" class="section level3" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Prediction on an external study</h3>
<p>We use the <code>predict()</code> function to predict the class membership of new test samples from an external study. We provide an example where we set aside a particular study, train the MINT model on the remaining three studies, then predict on the test study. This process exactly reflects the inner workings of the <code>tune()</code> and <code>perf()</code> functions using LOGOCV.</p>
<p>Here during our model training on the three studies only, we assume we have performed the tuning steps described in this case study to choose <code>ncomp</code> and <code>keepX</code> (here set to arbitrary values to avoid overfitting):</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We predict on study 3</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>indiv.test <span class="ot">&lt;-</span> <span class="fu">which</span>(study <span class="sc">==</span> <span class="st">&quot;3&quot;</span>)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We train on the remaining studies, with pre-tuned parameters</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>mint.splsda.stem2 <span class="ot">&lt;-</span> <span class="fu">mint.splsda</span>(<span class="at">X =</span> X[<span class="sc">-</span><span class="fu">c</span>(indiv.test), ], </span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">Y =</span> Y[<span class="sc">-</span><span class="fu">c</span>(indiv.test)], </span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">study =</span> <span class="fu">droplevels</span>(study[<span class="sc">-</span><span class="fu">c</span>(indiv.test)]), </span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ncomp =</span> <span class="dv">1</span>,  </span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">keepX =</span> <span class="dv">30</span>)</span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>mint.predict.stem <span class="ot">&lt;-</span> <span class="fu">predict</span>(mint.splsda.stem2, <span class="at">newdata =</span> X[indiv.test, ], </span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dist =</span> <span class="st">&quot;centroids.dist&quot;</span>,</span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">study.test =</span> <span class="fu">factor</span>(study[indiv.test]))</span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Store class prediction with a model with 1 comp</span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a>indiv.prediction <span class="ot">&lt;-</span> mint.predict.stem<span class="sc">$</span>class<span class="sc">$</span>centroids.dist[, <span class="dv">1</span>]</span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a><span class="co"># The confusion matrix compares the real subtypes with the predicted subtypes</span></span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a>conf.mat <span class="ot">&lt;-</span> <span class="fu">get.confusion_matrix</span>(<span class="at">truth =</span> Y[indiv.test],</span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">predicted =</span> indiv.prediction)</span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a>conf.mat</span></code></pre></div>
<pre><code>##            predicted.as.Fibroblast predicted.as.hESC predicted.as.hiPSC
## Fibroblast                       3                 0                  0
## hESC                             0                 4                  4
## hiPSC                            2                 2                  6</code></pre>
<p>Here we have considered a trained model with one component, and compared the cell type prediction for the test study 3 with the known cell types. The classification error rate is relatively high, but potentially could be improved with a proper tuning, and a larger number of studies in the training set.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction error rate</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(conf.mat) <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(conf.mat)))<span class="sc">/</span><span class="fu">sum</span>(conf.mat)</span></code></pre></div>
<pre><code>## [1] 0.3809524</code></pre>

</div>
</div>
</div>
<div id="id_08" class="section level1" number="8">
<h1><span class="header-section-number"> 8</span> Session Information</h1>
<div id="id_08:mixomics-ver" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> mixOmics version</h2>
<pre><code>## [1] &#39;6.23.3&#39;</code></pre>
</div>
<div id="id_08:session-info" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Session info</h2>
<pre><code>## R Under development (unstable) (2022-10-11 r83083 ucrt)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 19044)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_Australia.utf8  LC_CTYPE=English_Australia.utf8    LC_MONETARY=English_Australia.utf8
## [4] LC_NUMERIC=C                       LC_TIME=English_Australia.utf8    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] mixOmics_6.23.3  testthat_3.1.6   kableExtra_1.3.4 ggplot2_3.4.0    lattice_0.20-45  MASS_7.3-58.1    knitr_1.41      
## [8] bookdown_0.31   
## 
## loaded via a namespace (and not attached):
##  [1] tidyselect_1.2.0    viridisLite_0.4.1   dplyr_1.0.10        farver_2.1.1        fastmap_1.1.0       promises_1.2.0.1   
##  [7] digest_0.6.30       mime_0.12           lifecycle_1.0.3     ellipsis_0.3.2      processx_3.8.0      magrittr_2.0.3     
## [13] compiler_4.3.0      rlang_1.0.6         sass_0.4.4          tools_4.3.0         igraph_1.3.5        utf8_1.2.2         
## [19] yaml_2.3.6          prettyunits_1.1.1   labeling_0.4.2      rARPACK_0.11-0      htmlwidgets_1.6.1   pkgbuild_1.4.0     
## [25] xml2_1.3.3          plyr_1.8.8          RColorBrewer_1.1-3  rsconnect_0.8.29    pkgload_1.3.2       BiocParallel_1.33.0
## [31] miniUI_0.1.1.1      withr_2.5.0         purrr_0.3.5         desc_1.4.2          grid_4.3.0          fansi_1.0.3        
## [37] urlchecker_1.0.1    profvis_0.3.7       xtable_1.8-4        colorspace_2.0-3    scales_1.2.1        cli_3.4.1          
## [43] ellipse_0.4.3       rmarkdown_2.19      crayon_1.5.2        generics_0.1.3      remotes_2.4.2       rstudioapi_0.14    
## [49] RSpectra_0.16-1     httr_1.4.4          reshape2_1.4.4      sessioninfo_1.2.2   DBI_1.1.3           cachem_1.0.6       
## [55] stringr_1.5.0       rvest_1.0.3         assertthat_0.2.1    parallel_4.3.0      matrixStats_0.63.0  vctrs_0.5.1        
## [61] devtools_2.4.5      webshot_0.5.4       Matrix_1.5-3        jsonlite_1.8.4      callr_3.7.3         ggrepel_0.9.2      
## [67] systemfonts_1.0.4   jquerylib_0.1.4     tidyr_1.2.1         snow_0.4-4          glue_1.6.2          codetools_0.2-18   
## [73] ps_1.7.2            stringi_1.7.8       gtable_0.3.1        later_1.3.0         munsell_0.5.0       tibble_3.1.8       
## [79] pillar_1.8.1        brio_1.1.3          htmltools_0.5.4     R6_2.5.1            rprojroot_2.0.3     evaluate_0.19      
## [85] shiny_1.7.4         highr_0.10          memoise_2.0.1       corpcor_1.6.10      httpuv_1.6.6        bslib_0.4.2        
## [91] Rcpp_1.0.9          svglite_2.1.0       gridExtra_2.3       xfun_0.35           fs_1.5.2            usethis_2.1.6      
## [97] pkgconfig_2.0.3</code></pre>

</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>

<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bus07" class="csl-entry">
Bushel, Pierre R, Russell D Wolfinger, and Greg Gibson. 2007. <span>“Simultaneous Clustering of Gene Expression Data with Clinical Chemistry and Pathological Evaluatio Ns Reveals Phenotypic Prototypes.”</span> <em>BMC Systems Biology</em> 1 (1): 15.
</div>
<div id="ref-TCGA12" class="csl-entry">
Cancer Genome Atlas Network et al. 2012. <span>“Comprehensive Molecular Portraits of Human Breast Tumours.”</span> <em>Nature</em> 490 (7418): 61–70.
</div>
<div id="ref-Chi09" class="csl-entry">
Chin, Mark H, Mike J Mason, Wei Xie, Stefano Volinia, Mike Singer, Cory Peterson, Gayane Ambartsumyan, et al. 2009. <span>“Induced Pluripotent Stem Cells and Embryonic Stem Cells Are Distinguished by Gene Expression Signatures.”</span> <em>Cell Stem Cell</em> 5 (1): 111–23.
</div>
<div id="ref-csa06" class="csl-entry">
Csardi, Gabor, Tamas Nepusz, et al. 2006. <span>“The Igraph Software Package for Complex Network Research.”</span> <em>InterJournal, Complex Systems</em> 1695 (5): 1–9.
</div>
<div id="ref-Esl14b" class="csl-entry">
Eslami, A, EM Qannari, A Kohler, and S Bougeard. 2014. <span>“Two-Block Multi-Group Data Analysis. Application to Epidemiology.”</span> In <em>New Perspectives in Partial Least Squares and Related Methods</em>. Springer Verlag.
</div>
<div id="ref-Gon08" class="csl-entry">
González, Ignacio, Sébastien Déjean, Pascal GP Martin, and Alain Baccini. 2008. <span>“<span>CCA</span>: An <span>R</span> Package to Extend Canonical Correlation Analysis.”</span> <em>Journal of Statistical Software</em> 23 (12): 1–14.
</div>
<div id="ref-Gon12" class="csl-entry">
González, Ignacio, Kim-Anh Lê Cao, Melissa J Davis, Sébastien Déjean, et al. 2012. <span>“Visualising Associations Between Paired ’Omics’ Data Sets.”</span> <em>BioData Mining</em> 5 (1): 19.
</div>
<div id="ref-Kha01" class="csl-entry">
Khan, Javed, Jun S Wei, Markus Ringner, Lao H Saal, Marc Ladanyi, Frank Westermann, Frank Berthold, et al. 2001. <span>“Classification and Diagnostic Prediction of Cancers Using Gene Expression Profiling and Artificial Neural Networks.”</span> <em>Nature Medicine</em> 7 (6): 673–79.
</div>
<div id="ref-Lec16" class="csl-entry">
Lê Cao, Kim-Anh, Mary-Ellen Costello, Xin-Yi Chua, Rémi Brazeilles, and Pascale Rondeau. 2016. <span>“MixMC: Multivariate Insights into Microbial Communities.”</span> <em>PloS One</em> 11 (8): e0160169.
</div>
<div id="ref-New10" class="csl-entry">
Newman, Aaron M, and James B Cooper. 2010. <span>“Lab-Specific Gene Expression Signatures in Pluripotent Stem Cells.”</span> <em>Cell Stem Cell</em> 7 (2): 258–62.
</div>
<div id="ref-mixomics" class="csl-entry">
Rohart, Florian, Benoit Gautier, Amrit Singh, and Kim-Anh Le Cao. 2017. <span>“mixOmics: An r Package for ‘Omics Feature Selection and Multiple Data Integration.”</span> <em>PLoS Computational Biology</em>.
</div>
<div id="ref-Roh17" class="csl-entry">
Rohart, Florian, Benoit Gautier, Amrit Singh, and Kim-Anh Lê Cao. 2017. <span>“mixOmics: An r Package for ‘Omics Feature Selection and Multiple Data Integration.”</span> <em>PLoS Computational Biology</em> 13 (11): e1005752.
</div>
<div id="ref-Sin19" class="csl-entry">
Singh, Amrit, Casey P Shannon, Benoı̂t Gautier, Florian Rohart, Michaël Vacher, Scott J Tebbutt, and Kim-Anh Lê Cao. 2019. <span>“DIABLO: An Integrative Approach for Identifying Key Molecular Drivers from Multi-Omics Assays.”</span> <em>Bioinformatics</em> 35 (17): 3055–62.
</div>
<div id="ref-Sor01" class="csl-entry">
Sørlie, Therese, Charles M Perou, Robert Tibshirani, Turid Aas, Stephanie Geisler, Hilde Johnsen, Trevor Hastie, et al. 2001. <span>“Gene Expression Patterns of Breast Carcinomas Distinguish Tumor Subclasses with Clinical Implications.”</span> <em>Proceedings of the National Academy of Sciences</em> 98 (19): 10869–74.
</div>
<div id="ref-Sza04" class="csl-entry">
Szakács, Gergely, Jean-Philippe Annereau, Samir Lababidi, Uma Shankavaram, Angela Arciello, Kimberly J Bussey, William Reinhold, et al. 2004. <span>“Predicting Drug Sensitivity and Resistance: Profiling ABC Transporter Genes in Cancer Cells.”</span> <em>Cancer Cell</em> 6 (2): 129–37.
</div>
<div id="ref-Ten11" class="csl-entry">
Tenenhaus, Arthur, and Michel Tenenhaus. 2011. <span>“Regularized Generalized Canonical Correlation Analysis.”</span> <em>Psychometrika</em> 76 (2): 257–84.
</div>
<div id="ref-Ten16" class="csl-entry">
Teng, Mingxiang, Michael I Love, Carrie A Davis, Sarah Djebali, Alexander Dobin, Brenton R Graveley, Sheng Li, et al. 2016. <span>“A Benchmark for RNA-Seq Quantification Pipelines.”</span> <em>Genome Biology</em> 17 (1): 74.
</div>
<div id="ref-Well13" class="csl-entry">
Wells, Christine A, Rowland Mosbergen, Othmar Korn, Jarny Choi, Nick Seidenman, Nicholas A Matigian, Alejandra M Vitale, and Jill Shepherd. 2013. <span>“Stemformatics: Visualisation and Sharing of Stem Cell Gene Expression.”</span> <em>Stem Cell Research</em> 10 (3): 387–95.
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>www.stemformatics.org<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<p style="text-align: center;">
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
